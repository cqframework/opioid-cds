{
  "resourceType": "Library",
  "id": "library-OpioidCDSCommon",
  "extension": [ {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  } ],
  "url": "http://fhir.org/guides/cdc/opioid-cds/Library/OpioidCDSCommon",
  "version": "2.0.1",
  "name": "OpioidCDSCommon",
  "relatedArtifact": [ {
    "type": "depends-on",
    "display": "FHIR model information"
  }, {
    "type": "depends-on",
    "display": "Library FHIRHelpers"
  }, {
    "type": "depends-on",
    "display": "Library OMTKLogic"
  }, {
    "type": "depends-on",
    "display": "Library Config"
  }, {
    "type": "depends-on",
    "display": "Code system LOINC"
  }, {
    "type": "depends-on",
    "display": "Code system SNOMED"
  }, {
    "type": "depends-on",
    "display": "Value set Opioid analgesics with ambulatory misuse potential"
  }, {
    "type": "depends-on",
    "display": "Value set Extended release opioid with ambulatory misuse potential"
  }, {
    "type": "depends-on",
    "display": "Value set Buprenorphine and methadone medications"
  }, {
    "type": "depends-on",
    "display": "Value set Limited life expectancy conditions"
  }, {
    "type": "depends-on",
    "display": "Value set Therapies indicating end of life care"
  }, {
    "type": "depends-on",
    "display": "Value set Conditions likely terminal for opioid prescribing"
  }, {
    "type": "depends-on",
    "display": "Value set CDC malignant cancer conditions"
  }, {
    "type": "depends-on",
    "display": "Value set Oncology specialty designations (NUCC)"
  }, {
    "type": "depends-on",
    "display": "Value set Opioid misuse disorders"
  }, {
    "type": "depends-on",
    "display": "Value set Substance misuse behavioral counseling"
  }, {
    "type": "depends-on",
    "display": "Value set Conditions documenting substance misuse"
  }, {
    "type": "depends-on",
    "display": "Value set Office Visit"
  }, {
    "type": "depends-on",
    "display": "Value set Opioid counseling procedure"
  }, {
    "type": "depends-on",
    "display": "Value set Benzodiazepine medications"
  }, {
    "type": "depends-on",
    "display": "Value set Non-opioid drug urine screening"
  }, {
    "type": "depends-on",
    "display": "Value set Naloxone medications"
  }, {
    "type": "depends-on",
    "display": "Value set Opioid misuse assessment procedure"
  }, {
    "type": "depends-on",
    "display": "Value set Opioid drug urine screening"
  }, {
    "type": "depends-on",
    "display": "Value set Hospice Disposition"
  }, {
    "type": "depends-on",
    "display": "Value set Hospice Finding Codes"
  }, {
    "type": "depends-on",
    "display": "Value set Hospice Procedure Codes"
  }, {
    "type": "depends-on",
    "display": "Value set Observation Category Laboratory"
  }, {
    "type": "depends-on",
    "display": "Value set Observation Category Procedure"
  }, {
    "type": "depends-on",
    "display": "Value set Pain treatment plan"
  }, {
    "type": "depends-on",
    "display": "Value set Pain management procedure"
  }, {
    "type": "depends-on",
    "display": "Value set PDMP review procedure"
  }, {
    "type": "depends-on",
    "display": "Value set PDMP data reviewed finding"
  }, {
    "type": "depends-on",
    "display": "Value set Cocaine Urine Tests"
  }, {
    "type": "depends-on",
    "display": "Value set PCP Urine Tests"
  }, {
    "type": "depends-on",
    "display": "Value set Community"
  }, {
    "type": "depends-on",
    "display": "Value set Active Condition"
  }, {
    "type": "depends-on",
    "display": "Value set Active MedicationRequest"
  }, {
    "type": "depends-on",
    "display": "Value set Encounter Diagnosis Condition Category"
  }, {
    "type": "depends-on",
    "display": "Value set Problem List Condition Category"
  }, {
    "type": "depends-on",
    "display": "Value set US Core Health Concern Condition Category"
  } ],
  "parameter": [ {
    "name": "Patient",
    "use": "out",
    "min": 0,
    "max": "1",
    "type": "Patient"
  }, {
    "name": "Active Ambulatory Opioid Rx",
    "use": "out",
    "min": 0,
    "max": "*",
    "type": "MedicationRequest"
  }, {
    "name": "Active Ambulatory Benzodiazepine Rx",
    "use": "out",
    "min": 0,
    "max": "*",
    "type": "MedicationRequest"
  }, {
    "name": "Active Ambulatory Naloxone Rx",
    "use": "out",
    "min": 0,
    "max": "*",
    "type": "MedicationRequest"
  }, {
    "name": "US Core-Categorized Conditions",
    "use": "out",
    "min": 0,
    "max": "*",
    "type": "Condition"
  }, {
    "name": "Conditions Indicating End of Life or With Limited Life Expectancy",
    "use": "out",
    "min": 0,
    "max": "*",
    "type": "Condition"
  }, {
    "name": "Admitted/Referred/Discharged to Hospice Care",
    "use": "out",
    "min": 0,
    "max": "*",
    "type": "Any"
  }, {
    "name": "End of Life Assessment",
    "use": "out",
    "min": 0,
    "max": "1",
    "type": "boolean"
  }, {
    "name": "Previous 10 Days Interval",
    "use": "out",
    "min": 0,
    "max": "1",
    "type": "Period"
  }, {
    "name": "First Month",
    "use": "out",
    "min": 0,
    "max": "1",
    "type": "Period"
  }, {
    "name": "Second Month",
    "use": "out",
    "min": 0,
    "max": "1",
    "type": "Period"
  }, {
    "name": "Third Month",
    "use": "out",
    "min": 0,
    "max": "1",
    "type": "Period"
  }, {
    "name": "Prescribed Opioids for 21 or more of 30 Days for each of the past 3 Months",
    "use": "out",
    "min": 0,
    "max": "1",
    "type": "boolean"
  } ],
  "dataRequirement": [ {
    "type": "Patient",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/Patient" ]
  }, {
    "type": "MedicationRequest",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/MedicationRequest" ],
    "mustSupport": [ "status" ],
    "codeFilter": [ {
      "path": "status"
    } ]
  }, {
    "type": "MedicationRequest",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/MedicationRequest" ],
    "mustSupport": [ "recorder", "dosageInstruction", "authoredOn", "dispenseRequest", "subject", "medication.reference", "medication", "id", "category", "intent", "status" ],
    "codeFilter": [ {
      "path": "status"
    } ]
  }, {
    "type": "Medication",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/Medication" ],
    "mustSupport": [ "id" ],
    "codeFilter": [ {
      "path": "id"
    } ]
  }, {
    "type": "MedicationRequest",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/MedicationRequest" ],
    "mustSupport": [ "recorder", "dosageInstruction", "authoredOn", "dispenseRequest", "subject", "medication.reference", "medication", "id", "category", "intent", "status" ],
    "codeFilter": [ {
      "path": "status"
    } ]
  }, {
    "type": "MedicationRequest",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/MedicationRequest" ],
    "mustSupport": [ "status" ],
    "codeFilter": [ {
      "path": "status"
    } ]
  }, {
    "type": "MedicationRequest",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/MedicationRequest" ],
    "mustSupport": [ "recorder", "dosageInstruction", "authoredOn", "dispenseRequest", "subject", "medication.reference", "medication", "id", "category", "intent", "status" ],
    "codeFilter": [ {
      "path": "status"
    } ]
  }, {
    "type": "Medication",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/Medication" ],
    "mustSupport": [ "id" ],
    "codeFilter": [ {
      "path": "id"
    } ]
  }, {
    "type": "MedicationRequest",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/MedicationRequest" ],
    "mustSupport": [ "recorder", "dosageInstruction", "authoredOn", "dispenseRequest", "subject", "medication.reference", "medication", "id", "category", "intent", "status" ],
    "codeFilter": [ {
      "path": "status"
    } ]
  }, {
    "type": "MedicationRequest",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/MedicationRequest" ],
    "mustSupport": [ "status" ],
    "codeFilter": [ {
      "path": "status"
    } ]
  }, {
    "type": "MedicationRequest",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/MedicationRequest" ],
    "mustSupport": [ "recorder", "dosageInstruction", "authoredOn", "dispenseRequest", "subject", "medication.reference", "medication", "id", "category", "intent", "status" ],
    "codeFilter": [ {
      "path": "status"
    } ]
  }, {
    "type": "Medication",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/Medication" ],
    "mustSupport": [ "id" ],
    "codeFilter": [ {
      "path": "id"
    } ]
  }, {
    "type": "MedicationRequest",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/MedicationRequest" ],
    "mustSupport": [ "recorder", "dosageInstruction", "authoredOn", "dispenseRequest", "subject", "medication.reference", "medication", "id", "category", "intent", "status" ],
    "codeFilter": [ {
      "path": "status"
    } ]
  }, {
    "type": "Medication",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/Medication" ],
    "mustSupport": [ "id" ],
    "codeFilter": [ {
      "path": "id"
    } ]
  }, {
    "type": "Medication",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/Medication" ],
    "mustSupport": [ "id" ],
    "codeFilter": [ {
      "path": "id"
    } ]
  }, {
    "type": "Condition",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/Condition" ],
    "mustSupport": [ "category" ],
    "codeFilter": [ {
      "path": "category"
    } ]
  }, {
    "type": "Condition",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/Condition" ],
    "mustSupport": [ "category" ],
    "codeFilter": [ {
      "path": "category"
    } ]
  }, {
    "type": "Condition",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/Condition" ],
    "mustSupport": [ "category" ],
    "codeFilter": [ {
      "path": "category"
    } ]
  }, {
    "type": "Procedure",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/Procedure" ],
    "mustSupport": [ "code", "status.value", "status" ],
    "codeFilter": [ {
      "path": "code"
    } ]
  }, {
    "type": "ServiceRequest",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/ServiceRequest" ],
    "mustSupport": [ "code", "status.value", "status" ],
    "codeFilter": [ {
      "path": "code"
    } ]
  }, {
    "type": "Encounter",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/Encounter" ],
    "mustSupport": [ "period.start", "period", "status.value", "status" ]
  }, {
    "type": "MedicationRequest",
    "profile": [ "http://hl7.org/fhir/StructureDefinition/MedicationRequest" ],
    "mustSupport": [ "medication" ],
    "codeFilter": [ {
      "path": "medication"
    } ]
  } ],
  "content": [ {
    "contentType": "text/cql",
    "data": "bGlicmFyeSBPcGlvaWRDRFNDb21tb24gdmVyc2lvbiAnMS4yLjMnCgp1c2luZyBGSElSIHZlcnNpb24gJzMuMC4wJwoKaW5jbHVkZSBGSElSSGVscGVycyB2ZXJzaW9uICczLjAuMCcgY2FsbGVkIEZISVJIZWxwZXJzCmluY2x1ZGUgT01US0xvZ2ljQ1FMIHZlcnNpb24gJzEuMi4zJyBjYWxsZWQgT01US0xvZ2ljCmluY2x1ZGUgT3Bpb2lkQ0RTQ29tbW9uQ29uZmlnIHZlcnNpb24gJzEuMi4zJyBjYWxsZWQgQ29uZmlnCgpjb2Rlc3lzdGVtICJMT0lOQyI6ICdodHRwOi8vbG9pbmMub3JnJwpjb2Rlc3lzdGVtICJTTk9NRUQiOiAnaHR0cDovL3Nub21lZC5pbmZvL3NjdCcKCi8vIEV4cHJlc3Npb24tYmFzZWQKdmFsdWVzZXQgIk9waW9pZCBhbmFsZ2VzaWNzIHdpdGggYW1idWxhdG9yeSBtaXN1c2UgcG90ZW50aWFsIjogJ2h0dHA6Ly9maGlyLm9yZy9ndWlkZXMvY2RjL29waW9pZC1jZHMvVmFsdWVTZXQvb3Bpb2lkLWFuYWxnZXNpY3Mtd2l0aC1hbWJ1bGF0b3J5LW1pc3VzZS1wb3RlbnRpYWwnCnZhbHVlc2V0ICJFeHRlbmRlZCByZWxlYXNlIG9waW9pZCBhbmFsZ2VzaWNzIHdpdGggYW1idWxhdG9yeSBtaXN1c2UgcG90ZW50aWFsIjogJ2h0dHA6Ly9maGlyLm9yZy9ndWlkZXMvY2RjL29waW9pZC1jZHMvVmFsdWVTZXQvZXh0ZW5kZWQtcmVsZWFzZS1vcGlvaWQtd2l0aC1hbWJ1bGF0b3J5LW1pc3VzZS1wb3RlbnRpYWwnCnZhbHVlc2V0ICJCdXByZW5vcnBoaW5lIGFuZCBtZXRoYWRvbmUgbWVkaWNhdGlvbnMiOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9idXByZW5vcnBoaW5lLWFuZC1tZXRoYWRvbmUtbWVkaWNhdGlvbnMnCgovLyBFbnVtZXJhdGVkLWNvbXBvc2UKdmFsdWVzZXQgIkxpbWl0ZWQgbGlmZSBleHBlY3RhbmN5IGNvbmRpdGlvbnMiOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9saW1pdGVkLWxpZmUtZXhwZWN0YW5jeS1jb25kaXRpb25zJwp2YWx1ZXNldCAiVGhlcmFwaWVzIGluZGljYXRpbmcgZW5kIG9mIGxpZmUgY2FyZSI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L3RoZXJhcGllcy1pbmRpY2F0aW5nLWVuZC1vZi1saWZlLWNhcmUnCnZhbHVlc2V0ICJDb25kaXRpb25zIGxpa2VseSB0ZXJtaW5hbCBmb3Igb3Bpb2lkIHByZXNjcmliaW5nIjogJ2h0dHA6Ly9maGlyLm9yZy9ndWlkZXMvY2RjL29waW9pZC1jZHMvVmFsdWVTZXQvY29uZGl0aW9ucy1saWtlbHktdGVybWluYWwtZm9yLW9waW9pZC1wcmVzY3JpYmluZycKdmFsdWVzZXQgIkNEQyBtYWxpZ25hbnQgY2FuY2VyIGNvbmRpdGlvbnMiOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9jZGMtbWFsaWduYW50LWNhbmNlci1jb25kaXRpb25zJwp2YWx1ZXNldCAiT25jb2xvZ3kgc3BlY2lhbHR5IGRlc2lnbmF0aW9ucyAoTlVDQykiOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9vbmNvbG9neS1zcGVjaWFsdHktZGVzaWduYXRpb25zJwp2YWx1ZXNldCAiT3Bpb2lkIG1pc3VzZSBkaXNvcmRlcnMiOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9vcGlvaWQtbWlzdXNlLWRpc29yZGVycycKdmFsdWVzZXQgIlN1YnN0YW5jZSBtaXN1c2UgYmVoYXZpb3JhbCBjb3Vuc2VsaW5nIjogJ2h0dHA6Ly9maGlyLm9yZy9ndWlkZXMvY2RjL29waW9pZC1jZHMvVmFsdWVTZXQvc3Vic3RhbmNlLW1pc3VzZS1iZWhhdmlvcmFsLWNvdW5zZWxpbmcnCnZhbHVlc2V0ICJDb25kaXRpb25zIGRvY3VtZW50aW5nIHN1YnN0YW5jZSBtaXN1c2UiOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9jb25kaXRpb25zLWRvY3VtZW50aW5nLXN1YnN0YW5jZS1taXN1c2UnCi8vIEhhcnZlc3RlZCBmcm9tIFZTQUMgLSBPSUQ6IDIuMTYuODQwLjEuMTEzODgzLjMuNDY0LjEwMDMuMTAxLjEyLjEwMDEKLy8gUmV2aWV3ZWQgd2l0aCBUZXJtaW5vbG9neSwgMjAyMC0wMi0wNSAtIFZhbHVlIHNldCBuYW1lIGluIFZTQUMgaXMgIk9mZmljZSBWaXNpdCIsIG5lZWQgdG8gdmVyaWZ5IHN1aXRhYmlsaXR5CnZhbHVlc2V0ICJPZmZpY2UgVmlzaXQiOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9vZmZpY2UtdmlzaXQnCnZhbHVlc2V0ICJPcGlvaWQgY291bnNlbGluZyBwcm9jZWR1cmUiOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9vcGlvaWQtY291bnNlbGluZy1wcm9jZWR1cmUnCi8qIEV4aXN0aW5nIHNldHMgZm9yIGZpcnN0IHNpeCByZWNzICovCnZhbHVlc2V0ICJCZW56b2RpYXplcGluZSBtZWRpY2F0aW9ucyI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L2JlbnpvZGlhemVwaW5lLW1lZGljYXRpb25zJwp2YWx1ZXNldCAiTm9uLW9waW9pZCBkcnVnIHVyaW5lIHNjcmVlbmluZyI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L25vbi1vcGlvaWQtZHJ1Zy11cmluZS1zY3JlZW5pbmcnCnZhbHVlc2V0ICJOYWxveG9uZSBtZWRpY2F0aW9ucyI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L25hbG94b25lLW1lZGljYXRpb25zJwp2YWx1ZXNldCAiT3Bpb2lkIG1pc3VzZSBhc3Nlc3NtZW50IHByb2NlZHVyZSI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L29waW9pZC1taXN1c2UtYXNzZXNzbWVudC1wcm9jZWR1cmUnCnZhbHVlc2V0ICJPcGlvaWQgZHJ1ZyB1cmluZSBzY3JlZW5pbmciOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9vcGlvaWQtZHJ1Zy11cmluZS1zY3JlZW5pbmcnCnZhbHVlc2V0ICJIb3NwaWNlIERpc3Bvc2l0aW9uIjogJ2h0dHA6Ly9maGlyLm9yZy9ndWlkZXMvY2RjL29waW9pZC1jZHMvVmFsdWVTZXQvaG9zcGljZS1kaXNwb3NpdGlvbicgLy8gSGFydmVzdGVkIGZyb20gVlNBQyAtIE9JRDogMi4xNi44NDAuMS4xMTM3NjIuMS40LjExMDguMTUKdmFsdWVzZXQgIkhvc3BpY2UgRmluZGluZyBDb2RlcyI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L2hvc3BpY2UtZmluZGluZycKdmFsdWVzZXQgIkhvc3BpY2UgUHJvY2VkdXJlIENvZGVzIjogJ2h0dHA6Ly9maGlyLm9yZy9ndWlkZXMvY2RjL29waW9pZC1jZHMvVmFsdWVTZXQvaG9zcGljZS1wcm9jZWR1cmUnCnZhbHVlc2V0ICJPYnNlcnZhdGlvbiBDYXRlZ29yeSBMYWJvcmF0b3J5IjogJ2h0dHA6Ly9maGlyLm9yZy9ndWlkZXMvY2RjL29waW9pZC1jZHMvVmFsdWVTZXQvb2JzZXJ2YXRpb24tY2F0ZWdvcnktbGFib3JhdG9yeScKdmFsdWVzZXQgIk9ic2VydmF0aW9uIENhdGVnb3J5IFByb2NlZHVyZSI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L29ic2VydmF0aW9uLWNhdGVnb3J5LXByb2NlZHVyZScKdmFsdWVzZXQgIlBhaW4gdHJlYXRtZW50IHBsYW4iOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9wYWluLXRyZWF0bWVudC1wbGFuJwp2YWx1ZXNldCAiUGFpbiBtYW5hZ2VtZW50IHByb2NlZHVyZSI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L3BhaW4tbWFuYWdlbWVudC1wcm9jZWR1cmUnCnZhbHVlc2V0ICJQRE1QIHJldmlldyBwcm9jZWR1cmUiOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9wZG1wLXJldmlldy1wcm9jZWR1cmUnCnZhbHVlc2V0ICJQRE1QIGRhdGEgcmV2aWV3ZWQgZmluZGluZyI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L3BkbXAtZGF0YS1yZXZpZXdlZC1maW5kaW5nJwp2YWx1ZXNldCAiQ29jYWluZSBVcmluZSBUZXN0cyI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L2NvY2FpbmUtdXJpbmUtZHJ1Zy1zY3JlZW5pbmctdGVzdHMnCnZhbHVlc2V0ICJQQ1AgVXJpbmUgVGVzdHMiOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9waGVuY3ljbGlkaW5lLXVyaW5lLWRydWctc2NyZWVuaW5nLXRlc3RzJwoKdmFsdWVzZXQgIkNvbW11bml0eSI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L21lZGljYXRpb25yZXF1ZXN0LWNhdGVnb3J5LWNvbW11bml0eScKdmFsdWVzZXQgIkFjdGl2ZSBDb25kaXRpb24iOiAnaHR0cDovL2ZoaXIub3JnL2d1aWRlcy9jZGMvb3Bpb2lkLWNkcy9WYWx1ZVNldC9jb25kaXRpb24tY2xpbmljYWwtc3RhdHVzLWFjdGl2ZScKdmFsdWVzZXQgIkFjdGl2ZSBNZWRpY2F0aW9uUmVxdWVzdCI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L21lZGljYXRpb25yZXF1ZXN0LXN0YXR1cy1hY3RpdmUnCi8qIHZhbHVlc2V0ICJVUyBDb3JlIENvbmRpdGlvbiBDYXRlZ29yaWVzIjogJ2h0dHA6Ly9maGlyLm9yZy9ndWlkZXMvY2RjL29waW9pZC1jZHMvVmFsdWVTZXQvY29uZGl0aW9uLWNhdGVnb3JpZXMnICovCnZhbHVlc2V0ICJFbmNvdW50ZXIgRGlhZ25vc2lzIENvbmRpdGlvbiBDYXRlZ29yeSI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L2NvbmRpdGlvbi1jYXRlZ29yeS1lbmNvdW50ZXItZGlhZ25vc2lzJwp2YWx1ZXNldCAiUHJvYmxlbSBMaXN0IENvbmRpdGlvbiBDYXRlZ29yeSI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L2NvbmRpdGlvbi1wcm9ibGVtLWxpc3QtY2F0ZWdvcnknCnZhbHVlc2V0ICJVUyBDb3JlIEhlYWx0aCBDb25jZXJuIENvbmRpdGlvbiBDYXRlZ29yeSI6ICdodHRwOi8vZmhpci5vcmcvZ3VpZGVzL2NkYy9vcGlvaWQtY2RzL1ZhbHVlU2V0L2NvbmRpdGlvbi11cy1jb3JlLWhlYWx0aC1jb25jZXJuLWNhdGVnb3J5JwoKY29udGV4dCBQYXRpZW50CgovLyBUT0RPOiBjb2RlICJOb25waGFybWFjb2xvZ2ljIHRoZXJhcHkgYW5kIG5vbm9waW9pZCBwaGFybW9jb2xvZ2ljIjogJ1RPRE8nIGZyb20gIlRPRE8iCgovLyBUT0RPOiBDYXB0dXJlIHByb2Nlc3MgZGVjaXNpb25zIGZvciBsb25nLXRlcm0gb3Bpb2lkIHVzZQoKZGVmaW5lICJBY3RpdmUgQW1idWxhdG9yeSBPcGlvaWQgUngiOgogICgKICAgIFtNZWRpY2F0aW9uUmVxdWVzdDogc3RhdHVzIGluICJBY3RpdmUgTWVkaWNhdGlvblJlcXVlc3QiXSBNUgogICAgICB3aGVyZSBkYXRlIGZyb20gTVIuYXV0aG9yZWRPbiAyIHllYXJzIG9yIGxlc3Mgb24gb3IgYmVmb3JlIFRvZGF5KCkKICAgICAgICBhbmQgTVIubWVkaWNhdGlvbiBpcyBSZWZlcmVuY2Ugb3IgTVIubWVkaWNhdGlvbiBpbiAiT3Bpb2lkIGFuYWxnZXNpY3Mgd2l0aCBhbWJ1bGF0b3J5IG1pc3VzZSBwb3RlbnRpYWwiCiAgICAgICAgYW5kIE1SLmNhdGVnb3J5IGluICJDb21tdW5pdHkiCiAgKSBSeAogICAgbGV0IE1lZDogW01lZGljYXRpb246IGlkIGluIChMYXN0KFNwbGl0KChSeC5tZWRpY2F0aW9uIGFzIEZISVIuUmVmZXJlbmNlKS5yZWZlcmVuY2UsICcvJykpKV0KICAgIHdoZXJlIG5vdChSeC5tZWRpY2F0aW9uIGlzIFJlZmVyZW5jZSkgb3IgTWVkLmNvZGUgaW4gIk9waW9pZCBhbmFsZ2VzaWNzIHdpdGggYW1idWxhdG9yeSBtaXN1c2UgcG90ZW50aWFsIgogICAgICByZXR1cm4KICAgICAgICBNZWRpY2F0aW9uUmVxdWVzdCB7CiAgICAgICAgICBpZDogUnguaWQsCiAgICAgICAgICBzdGF0dXM6IFJ4LnN0YXR1cywKICAgICAgICAgIGludGVudDogUnguaW50ZW50LAogICAgICAgICAgY2F0ZWdvcnk6IFJ4LmNhdGVnb3J5LAogICAgICAgICAgbWVkaWNhdGlvbjogaWYgUngubWVkaWNhdGlvbiBpcyBSZWZlcmVuY2UgdGhlbiBGaXJzdChNZWQuY29kZSkgZWxzZSBSeC5tZWRpY2F0aW9uIGFzIENvZGVhYmxlQ29uY2VwdCwKICAgICAgICAgIHN1YmplY3Q6IFJ4LnN1YmplY3QsCiAgICAgICAgICByZWNvcmRlcjogUngucmVjb3JkZXIsCiAgICAgICAgICBkb3NhZ2VJbnN0cnVjdGlvbjogUnguZG9zYWdlSW5zdHJ1Y3Rpb24sCiAgICAgICAgICBkaXNwZW5zZVJlcXVlc3Q6IFJ4LmRpc3BlbnNlUmVxdWVzdAogICAgICAgIH0KCmRlZmluZSAiQWN0aXZlIEFtYnVsYXRvcnkgQmVuem9kaWF6ZXBpbmUgUngiOgogICgKICAgIFtNZWRpY2F0aW9uUmVxdWVzdDogc3RhdHVzIGluICJBY3RpdmUgTWVkaWNhdGlvblJlcXVlc3QiXSBNUgogICAgICB3aGVyZSBkYXRlIGZyb20gTVIuYXV0aG9yZWRPbiAyIHllYXJzIG9yIGxlc3Mgb24gb3IgYmVmb3JlIFRvZGF5KCkKICAgICAgICBhbmQgTVIubWVkaWNhdGlvbiBpcyBSZWZlcmVuY2Ugb3IgTVIubWVkaWNhdGlvbiBpbiAiQmVuem9kaWF6ZXBpbmUgbWVkaWNhdGlvbnMiCiAgICAgICAgYW5kIE1SLmNhdGVnb3J5IGluICJDb21tdW5pdHkiCiAgKSBSeAogICAgbGV0IE1lZDogW01lZGljYXRpb246IGlkIGluIChMYXN0KFNwbGl0KChSeC5tZWRpY2F0aW9uIGFzIEZISVIuUmVmZXJlbmNlKS5yZWZlcmVuY2UsICcvJykpKV0KICAgIHdoZXJlIG5vdChSeC5tZWRpY2F0aW9uIGlzIFJlZmVyZW5jZSkgb3IgTWVkLmNvZGUgaW4gIkJlbnpvZGlhemVwaW5lIG1lZGljYXRpb25zIgogICAgICByZXR1cm4KICAgICAgICBNZWRpY2F0aW9uUmVxdWVzdCB7CiAgICAgICAgICBpZDogUnguaWQsCiAgICAgICAgICBzdGF0dXM6IFJ4LnN0YXR1cywKICAgICAgICAgIGludGVudDogUnguaW50ZW50LAogICAgICAgICAgY2F0ZWdvcnk6IFJ4LmNhdGVnb3J5LAogICAgICAgICAgbWVkaWNhdGlvbjogaWYgUngubWVkaWNhdGlvbiBpcyBSZWZlcmVuY2UgdGhlbiBGaXJzdChNZWQuY29kZSkgZWxzZSBSeC5tZWRpY2F0aW9uIGFzIENvZGVhYmxlQ29uY2VwdCwKICAgICAgICAgIHN1YmplY3Q6IFJ4LnN1YmplY3QsCiAgICAgICAgICByZWNvcmRlcjogUngucmVjb3JkZXIsCiAgICAgICAgICBkb3NhZ2VJbnN0cnVjdGlvbjogUnguZG9zYWdlSW5zdHJ1Y3Rpb24sCiAgICAgICAgICBkaXNwZW5zZVJlcXVlc3Q6IFJ4LmRpc3BlbnNlUmVxdWVzdAogICAgICAgIH0KCmRlZmluZSAiQWN0aXZlIEFtYnVsYXRvcnkgTmFsb3hvbmUgUngiOgogICgKICAgIFtNZWRpY2F0aW9uUmVxdWVzdDogc3RhdHVzIGluICJBY3RpdmUgTWVkaWNhdGlvblJlcXVlc3QiXSBNUgogICAgICB3aGVyZSBkYXRlIGZyb20gTVIuYXV0aG9yZWRPbiAyIHllYXJzIG9yIGxlc3Mgb24gb3IgYmVmb3JlIFRvZGF5KCkKICAgICAgICBhbmQgTVIubWVkaWNhdGlvbiBpcyBSZWZlcmVuY2Ugb3IgTVIubWVkaWNhdGlvbiBpbiAiTmFsb3hvbmUgbWVkaWNhdGlvbnMiCiAgICAgICAgYW5kIE1SLmNhdGVnb3J5IGluICJDb21tdW5pdHkiCiAgKSBSeAogICAgbGV0IE1lZDogW01lZGljYXRpb246IGlkIGluIChMYXN0KFNwbGl0KChSeC5tZWRpY2F0aW9uIGFzIEZISVIuUmVmZXJlbmNlKS5yZWZlcmVuY2UsICcvJykpKV0KICAgIHdoZXJlIG5vdChSeC5tZWRpY2F0aW9uIGlzIFJlZmVyZW5jZSkgb3IgTWVkLmNvZGUgaW4gIk5hbG94b25lIG1lZGljYXRpb25zIgogICAgICByZXR1cm4KICAgICAgICBNZWRpY2F0aW9uUmVxdWVzdCB7CiAgICAgICAgICBpZDogUnguaWQsCiAgICAgICAgICBzdGF0dXM6IFJ4LnN0YXR1cywKICAgICAgICAgIGludGVudDogUnguaW50ZW50LAogICAgICAgICAgY2F0ZWdvcnk6IFJ4LmNhdGVnb3J5LAogICAgICAgICAgbWVkaWNhdGlvbjogaWYgUngubWVkaWNhdGlvbiBpcyBSZWZlcmVuY2UgdGhlbiBGaXJzdChNZWQuY29kZSkgZWxzZSBSeC5tZWRpY2F0aW9uIGFzIENvZGVhYmxlQ29uY2VwdCwKICAgICAgICAgIHN1YmplY3Q6IFJ4LnN1YmplY3QsCiAgICAgICAgICByZWNvcmRlcjogUngucmVjb3JkZXIsCiAgICAgICAgICBkb3NhZ2VJbnN0cnVjdGlvbjogUnguZG9zYWdlSW5zdHJ1Y3Rpb24sCiAgICAgICAgICBkaXNwZW5zZVJlcXVlc3Q6IFJ4LmRpc3BlbnNlUmVxdWVzdAogICAgICAgIH0KCmRlZmluZSBmdW5jdGlvbiAiSXMgT3Bpb2lkIEFuYWxnZXNpYyB3aXRoIEFtYnVsYXRvcnkgTWlzdXNlIFBvdGVudGlhbD8iKHZhbHVlIExpc3Q8TWVkaWNhdGlvblJlcXVlc3Q+KToKICB2YWx1ZSBSeAogICAgbGV0IE1lZDogW01lZGljYXRpb246IGlkIGluIChMYXN0KFNwbGl0KChSeC5tZWRpY2F0aW9uIGFzIEZISVIuUmVmZXJlbmNlKS5yZWZlcmVuY2UsICcvJykpKV0KICAgIHdoZXJlIG5vdChSeC5tZWRpY2F0aW9uIGlzIFJlZmVyZW5jZSkgb3IgTWVkLmNvZGUgaW4gIk9waW9pZCBhbmFsZ2VzaWNzIHdpdGggYW1idWxhdG9yeSBtaXN1c2UgcG90ZW50aWFsIgogICAgICBhbmQgUnguY2F0ZWdvcnkgaW4gIkNvbW11bml0eSIKICAgIHJldHVybgogICAgICBNZWRpY2F0aW9uUmVxdWVzdCB7CiAgICAgICAgaWQ6IFJ4LmlkLAogICAgICAgIHN0YXR1czogUnguc3RhdHVzLAogICAgICAgIGludGVudDogUnguaW50ZW50LAogICAgICAgIGNhdGVnb3J5OiBSeC5jYXRlZ29yeSwKICAgICAgICBtZWRpY2F0aW9uOiBpZiBSeC5tZWRpY2F0aW9uIGlzIFJlZmVyZW5jZSB0aGVuIEZpcnN0KE1lZC5jb2RlKSBlbHNlIFJ4Lm1lZGljYXRpb24gYXMgQ29kZWFibGVDb25jZXB0LAogICAgICAgIHN1YmplY3Q6IFJ4LnN1YmplY3QsCiAgICAgICAgYXV0aG9yZWRPbjogUnguYXV0aG9yZWRPbiwKICAgICAgICByZWNvcmRlcjogUngucmVjb3JkZXIsCiAgICAgICAgZG9zYWdlSW5zdHJ1Y3Rpb246IFJ4LmRvc2FnZUluc3RydWN0aW9uLAogICAgICAgIGRpc3BlbnNlUmVxdWVzdDogUnguZGlzcGVuc2VSZXF1ZXN0CiAgICAgIH0KCmRlZmluZSBmdW5jdGlvbiAiSXMgQmVuem9kaWF6ZXBpbmU/Iih2YWx1ZSBMaXN0PE1lZGljYXRpb25SZXF1ZXN0Pik6CiAgdmFsdWUgUngKICAgIGxldCBNZWQ6IFtNZWRpY2F0aW9uOiBpZCBpbiAoTGFzdChTcGxpdCgoUngubWVkaWNhdGlvbiBhcyBGSElSLlJlZmVyZW5jZSkucmVmZXJlbmNlLCAnLycpKSldCiAgICB3aGVyZSBub3QoUngubWVkaWNhdGlvbiBpcyBSZWZlcmVuY2UpIG9yIE1lZC5jb2RlIGluICJCZW56b2RpYXplcGluZSBtZWRpY2F0aW9ucyIKICAgICAgYW5kIFJ4LmNhdGVnb3J5IGluICJDb21tdW5pdHkiCiAgICByZXR1cm4KICAgICAgICAgIE1lZGljYXRpb25SZXF1ZXN0IHsKICAgICAgICAgICAgaWQ6IFJ4LmlkLAogICAgICAgICAgICBzdGF0dXM6IFJ4LnN0YXR1cywKICAgICAgICAgICAgaW50ZW50OiBSeC5pbnRlbnQsCiAgICAgICAgICAgIGNhdGVnb3J5OiBSeC5jYXRlZ29yeSwKICAgICAgICAgICAgbWVkaWNhdGlvbjogaWYgUngubWVkaWNhdGlvbiBpcyBSZWZlcmVuY2UgdGhlbiBGaXJzdChNZWQuY29kZSkgZWxzZSBSeC5tZWRpY2F0aW9uIGFzIENvZGVhYmxlQ29uY2VwdCwKICAgICAgICAgICAgc3ViamVjdDogUnguc3ViamVjdCwKICAgICAgICAgICAgYXV0aG9yZWRPbjogUnguYXV0aG9yZWRPbiwKICAgICAgICAgICAgcmVjb3JkZXI6IFJ4LnJlY29yZGVyLAogICAgICAgICAgICBkb3NhZ2VJbnN0cnVjdGlvbjogUnguZG9zYWdlSW5zdHJ1Y3Rpb24sCiAgICAgICAgICAgIGRpc3BlbnNlUmVxdWVzdDogUnguZGlzcGVuc2VSZXF1ZXN0CiAgICAgICAgICB9CgpkZWZpbmUgIkVuZCBvZiBMaWZlIEFzc2Vzc21lbnQiOgogICAgLy8gMS4gQ29uZGl0aW9ucyBpbmRpY2F0aW5nIGVuZCBvZiBsaWZlIG9yIHdpdGggbGltaXRlZCBsaWZlIGV4cGVjdGFuY3kKICAgIGV4aXN0cyAoCiAgICAgICJDb25kaXRpb25zIEluZGljYXRpbmcgRW5kIG9mIExpZmUgb3IgV2l0aCBMaW1pdGVkIExpZmUgRXhwZWN0YW5jeSIKICAgICkKICAgIC8vIDIuIEFkbWl0dGVkL3JlZmVycmVkL2Rpc2NoYXJnZWQgdG8gaG9zcGljZSBjYXJlCiAgICBvciBleGlzdHMgKAogICAgICAiQWRtaXR0ZWQvUmVmZXJyZWQvRGlzY2hhcmdlZCB0byBIb3NwaWNlIENhcmUiCiAgICApCiAgICAvLyAzLiBNZWRpY2F0aW9ucyBpbmRpY2F0aW5nIGVuZCBvZiBsaWZlCiAgICAvKiBvciBleGlzdHMgKAogICAgICAiTWVkaWNhdGlvbnMgSW5kaWNhdGluZyBFbmQgb2YgTGlmZSIKICAgICkgKi8KCmRlZmluZSAiVVMgQ29yZS1DYXRlZ29yaXplZCBDb25kaXRpb25zIjoKICBbQ29uZGl0aW9uOiBjYXRlZ29yeSBpbiAiRW5jb3VudGVyIERpYWdub3NpcyBDb25kaXRpb24gQ2F0ZWdvcnkiXQogICAgdW5pb24gW0NvbmRpdGlvbjogY2F0ZWdvcnkgaW4gIlByb2JsZW0gTGlzdCBDb25kaXRpb24gQ2F0ZWdvcnkiXQogICAgdW5pb24gW0NvbmRpdGlvbjogY2F0ZWdvcnkgaW4gIlVTIENvcmUgSGVhbHRoIENvbmNlcm4gQ29uZGl0aW9uIENhdGVnb3J5Il0KCmRlZmluZSAiQ29uZGl0aW9ucyBJbmRpY2F0aW5nIEVuZCBvZiBMaWZlIG9yIFdpdGggTGltaXRlZCBMaWZlIEV4cGVjdGFuY3kiOgogICgKICAgICJVUyBDb3JlLUNhdGVnb3JpemVkIENvbmRpdGlvbnMiIEMKICAgICAgd2hlcmUgQy5jb2RlIGluICJDb25kaXRpb25zIGxpa2VseSB0ZXJtaW5hbCBmb3Igb3Bpb2lkIHByZXNjcmliaW5nIgogICAgICAgIGFuZCBDLmNsaW5pY2FsU3RhdHVzIGluICJBY3RpdmUgQ29uZGl0aW9uIgogICkKICB1bmlvbgogICgKICAgICJVUyBDb3JlLUNhdGVnb3JpemVkIENvbmRpdGlvbnMiIEMKICAgICAgd2hlcmUgQy5jb2RlIGluICJMaW1pdGVkIGxpZmUgZXhwZWN0YW5jeSBjb25kaXRpb25zIgogICAgICAgIGFuZCBDLmNsaW5pY2FsU3RhdHVzIGluICJBY3RpdmUgQ29uZGl0aW9uIgogICkKCmRlZmluZSAiQWRtaXR0ZWQvUmVmZXJyZWQvRGlzY2hhcmdlZCB0byBIb3NwaWNlIENhcmUiOgogICgKICAgIFtQcm9jZWR1cmU6IGNvZGUgaW4gIkhvc3BpY2UgUHJvY2VkdXJlIENvZGVzIl0gUAogICAgICB3aGVyZSBQLnN0YXR1cy52YWx1ZSBpbiB7ICdpbi1wcm9ncmVzcycsICdjb21wbGV0ZWQnIH0KICApCiAgLy8gTk9URTogRGlzYWJsZWQgZHVlIHRvIEZISVIuQWxsVHlwZXMgbm90IHN1cHBvcnRpbmcgUHJvY2VkdXJlUmVxdWVzdAogIC8qIHVuaW9uCiAgKAogICAgW1Byb2NlZHVyZVJlcXVlc3Q6IGNvZGUgaW4gIkhvc3BpY2UgUHJvY2VkdXJlIENvZGVzIl0gRQogICAgICB3aGVyZSBFLnN0YXR1cy52YWx1ZSBpbiB7ICdhY3RpdmUnLCAnY29tcGxldGVkJywgJ3N1c3BlbmRlZCcgfQogICkgKi8KICB1bmlvbgogICgKICAgIGlmIChDb25maWcuIkhvc3BpY2UgRmluZGluZ3MgRXhjbHVzaW9uIEVuYWJsZWQiKSB0aGVuCiAgICAgIFtPYnNlcnZhdGlvbjogY29kZSBpbiAiSG9zcGljZSBGaW5kaW5nIENvZGVzIl0gTwogICAgICAgIHdoZXJlIG5vdCAoTy5zdGF0dXMudmFsdWUgaW4geyAndW5rbm93bicsICdlbnRlcmVkLWluLWVycm9yJywgJ2NhbmNlbGxlZCcgfSkKICAgIGVsc2UKICAgICAge30KICApCiAgdW5pb24KICAoCiAgICBbRW5jb3VudGVyXSBFCiAgICAgIHdoZXJlIGRhdGUgZnJvbSBFLnBlcmlvZC5zdGFydCAxIHllYXIgb3IgbGVzcyBvbiBvciBiZWZvcmUgVG9kYXkoKQogICAgICAgIGFuZCAoCiAgICAgICAgICBpZiBFLmhvc3BpdGFsaXphdGlvbi5kaXNjaGFyZ2VEaXNwb3NpdGlvbi5jb2RpbmcgaXMgbnVsbAogICAgICAgICAgICAgIG9yIG5vdCBleGlzdHMgKEUuaG9zcGl0YWxpemF0aW9uLmRpc2NoYXJnZURpc3Bvc2l0aW9uLmNvZGluZykKICAgICAgICAgICAgdGhlbiBmYWxzZQogICAgICAgICAgZWxzZSBFLmhvc3BpdGFsaXphdGlvbi5kaXNjaGFyZ2VEaXNwb3NpdGlvbiBpbiAiSG9zcGljZSBEaXNwb3NpdGlvbiIKICAgICAgICApCiAgICAgICAgYW5kIEUuc3RhdHVzLnZhbHVlIGluIHsgJ3BsYW5uZWQnLCAnYXJyaXZlZCcsICdpbi1wcm9ncmVzcycsICdmaW5pc2hlZCcsICdvbmxlYXZlJyB9CiAgKQoKLyoKZGVmaW5lICJNZWRpY2F0aW9ucyBJbmRpY2F0aW5nIEVuZCBvZiBMaWZlIjoKICAoCiAgICBbTWVkaWNhdGlvbkFkbWluaXN0cmF0aW9uOiAiRW5kIE9mIExpZmUgT3Bpb2lkcyJdIE1BCiAgICAgIHdoZXJlIE1BLnN0YXR1cyBpbiB7ICdpbi1wcm9ncmVzcycsICdvbi1ob2xkJywgJ2NvbXBsZXRlZCcgfQogICkKICB1bmlvbgogICgKICAgIFtNZWRpY2F0aW9uRGlzcGVuc2U6ICJFbmQgT2YgTGlmZSBPcGlvaWRzIl0gTUQKICAgICAgd2hlcmUgTUQuc3RhdHVzIGluIHsgJ3ByZXBhcmF0aW9uJywgJ2luLXByb2dyZXNzJywgJ29uLWhvbGQnLCAnY29tcGxldGVkJyB9CiAgKQogIHVuaW9uCiAgKAogICAgW01lZGljYXRpb25SZXF1ZXN0OiAiRW5kIE9mIExpZmUgT3Bpb2lkcyJdIE1SCiAgICAgIHdoZXJlIE1SLnN0YXR1cyBpbiB7ICdhY3RpdmUnLCAnY29tcGxldGVkJyB9CiAgKQogIHVuaW9uCiAgKAogICAgW01lZGljYXRpb25TdGF0ZW1lbnQ6ICJFbmQgT2YgTGlmZSBPcGlvaWRzIl0gTVMKICAgICAgd2hlcmUgTVMuc3RhdHVzIGluIHsgJ2FjdGl2ZScsICdjb21wbGV0ZWQnLCAnaW50ZW5kZWQnIH0KICApCiovCgpkZWZpbmUgIlByZXZpb3VzIDEwIERheXMgSW50ZXJ2YWwiOgpJbnRlcnZhbFtUb2RheSgpIC0gMTAgZGF5cywgVG9kYXkoKV0KCmRlZmluZSAiRmlyc3QgTW9udGgiOgpJbnRlcnZhbFtUb2RheSgpIC0gMyBtb250aHMsIFRvZGF5KCkgLSAyIG1vbnRoc10KCmRlZmluZSAiU2Vjb25kIE1vbnRoIjoKSW50ZXJ2YWxbVG9kYXkoKSAtIDIgbW9udGhzLCBUb2RheSgpIC0gMSBtb250aHNdCgpkZWZpbmUgIlRoaXJkIE1vbnRoIjoKSW50ZXJ2YWxbVG9kYXkoKSAtIDEgbW9udGhzLCBUb2RheSgpXQoKZGVmaW5lICJQcmVzY3JpYmVkIE9waW9pZHMgZm9yIDIxIG9yIG1vcmUgb2YgMzAgRGF5cyBmb3IgZWFjaCBvZiB0aGUgcGFzdCAzIE1vbnRocyI6CiAgIkRheXMgb24gT3Bpb2lkcyBkdXJpbmcgUGVyaW9kIigiRmlyc3QgTW9udGgiKSA+PSAyMQogICAgYW5kICJEYXlzIG9uIE9waW9pZHMgZHVyaW5nIFBlcmlvZCIoIlNlY29uZCBNb250aCIpID49IDIxCiAgICBhbmQgIkRheXMgb24gT3Bpb2lkcyBkdXJpbmcgUGVyaW9kIigiVGhpcmQgTW9udGgiKSA+PSAyMQoKZGVmaW5lIGZ1bmN0aW9uICJQcmVzY3JpcHRpb24gUmVsZXZhbnQgUGVyaW9kIihwcmVzY3JpcHRpb24gRkhJUi5NZWRpY2F0aW9uUmVxdWVzdCk6CiAgaWYgKAogICAgcHJlc2NyaXB0aW9uLmF1dGhvcmVkT24gaXMgbm90IG51bGwgYW5kIHByZXNjcmlwdGlvbi5kaXNwZW5zZVJlcXVlc3QgaXMgbm90IG51bGwKICAgICAgYW5kIHByZXNjcmlwdGlvbi5kaXNwZW5zZVJlcXVlc3QuZXhwZWN0ZWRTdXBwbHlEdXJhdGlvbiBpcyBub3QgbnVsbAogICkKICB0aGVuIEludGVydmFsWwogICAgZGF0ZSBmcm9tIHByZXNjcmlwdGlvbi5hdXRob3JlZE9uLAogICAgZGF0ZSBmcm9tIHByZXNjcmlwdGlvbi5hdXRob3JlZE9uICsgU3lzdGVtLlF1YW50aXR5eyB2YWx1ZTogR2V0RHVyYXRpb25JbkRheXMocHJlc2NyaXB0aW9uLmRpc3BlbnNlUmVxdWVzdC5leHBlY3RlZFN1cHBseUR1cmF0aW9uKSwgdW5pdDogJ2RheXMnIH0KICBdCiAgZWxzZSBudWxsCgpkZWZpbmUgZnVuY3Rpb24gIkRheXMgb24gT3Bpb2lkcyBkdXJpbmcgUGVyaW9kIihwZXJpb2QgSW50ZXJ2YWw8RGF0ZT4pOgogIFN1bSgKICAgICgKICAgICAgY29sbGFwc2UgKAogICAgICAgIFtNZWRpY2F0aW9uUmVxdWVzdDogIk9waW9pZCBhbmFsZ2VzaWNzIHdpdGggYW1idWxhdG9yeSBtaXN1c2UgcG90ZW50aWFsIl0gT3Bpb2lkUHJlc2NyaXB0aW9uCiAgICAgICAgcmV0dXJuICJQcmVzY3JpcHRpb24gUmVsZXZhbnQgUGVyaW9kIiggT3Bpb2lkUHJlc2NyaXB0aW9uICkgaW50ZXJzZWN0IHBlcmlvZAogICAgICApCiAgICApIE9waW9pZFVzZUludGVydmFsCiAgICAgIHJldHVybiBkYXlzIGJldHdlZW4gc3RhcnQgb2YgT3Bpb2lkVXNlSW50ZXJ2YWwgYW5kIGVuZCBvZiBPcGlvaWRVc2VJbnRlcnZhbAogICkKCmRlZmluZSBmdW5jdGlvbiBQcmVzY3JpcHRpb25zKE9yZGVycyBMaXN0PE1lZGljYXRpb25SZXF1ZXN0Pik6CiAgT3JkZXJzIE8KICAgIGxldAogICAgICAvLyBOT1RFOiBBc3N1bWluZyBtZWRpY2F0aW9uIGlzIHNwZWNpZmllZCBhcyBhIENvZGVhYmxlQ29uY2VwdCB3aXRoIGEgc2luZ2xlIFJ4Tm9ybSBjb2RlCiAgICAgIHJ4Tm9ybUNvZGU6IEZISVJIZWxwZXJzLlRvQ29kZSgoTy5tZWRpY2F0aW9uIGFzIEZISVIuQ29kZWFibGVDb25jZXB0KS5jb2RpbmdbMF0pLAogICAgICBtZWRpY2F0aW9uTmFtZTogT01US0xvZ2ljLkdldE1lZGljYXRpb25OYW1lKHJ4Tm9ybUNvZGUpLAogICAgICAvLyBOT1RFOiBBc3N1bWluZyBhIHNpbmdsZSBkb3NhZ2UgaW5zdHJ1Y3Rpb24gZWxlbWVudAogICAgICBkb3NhZ2VJbnN0cnVjdGlvbjogTy5kb3NhZ2VJbnN0cnVjdGlvblswXSwKICAgICAgcmVwZWF0OiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LAogICAgICBmcmVxdWVuY3k6IENvYWxlc2NlKHJlcGVhdC5mcmVxdWVuY3lNYXgudmFsdWUsIHJlcGVhdC5mcmVxdWVuY3kudmFsdWUpLAogICAgICBwZXJpb2Q6IFN5c3RlbS5RdWFudGl0eSB7IHZhbHVlOiByZXBlYXQucGVyaW9kLnZhbHVlLCB1bml0OiByZXBlYXQucGVyaW9kVW5pdC52YWx1ZSB9LAogICAgICBkb3NlRGVzY3JpcHRpb246CiAgICAgICAgQ29hbGVzY2UoCiAgICAgICAgICAvLyBUaGVyZSBzaG91bGQgYmUgYSBjb252ZXJzaW9uIGZyb20gRkhJUi5TaW1wbGVRdWFudGl0eSB0byBTeXN0ZW0uUXVhbnRpdHkKICAgICAgICAgIGlmIGRvc2FnZUluc3RydWN0aW9uLmRvc2UgaXMgRkhJUi5SYW5nZQogICAgICAgICAgICB0aGVuIFRvU3RyaW5nKFRvUXVhbnRpdHkoKGRvc2FnZUluc3RydWN0aW9uLmRvc2UgYXMgRkhJUi5SYW5nZSkubG93KSkKICAgICAgICAgICAgICAgICAgICAgICAgICArICctJyArIFRvU3RyaW5nKFRvUXVhbnRpdHkoKGRvc2FnZUluc3RydWN0aW9uLmRvc2UgYXMgRkhJUi5SYW5nZSkuaGlnaCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgKyAoZG9zYWdlSW5zdHJ1Y3Rpb24uZG9zZSBhcyBGSElSLlJhbmdlKS5oaWdoLnVuaXQudmFsdWUKICAgICAgICAgICAgZWxzZSBUb1N0cmluZyhUb1F1YW50aXR5KGRvc2FnZUluc3RydWN0aW9uLmRvc2UpKSwKICAgICAgICAgICAgJycKICAgICAgICApLAogICAgICBmcmVxdWVuY3lEZXNjcmlwdGlvbjoKICAgICAgICBUb1N0cmluZyhkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LmZyZXF1ZW5jeS52YWx1ZSkgKwogICAgICAgICAgQ29hbGVzY2UoCiAgICAgICAgICAgICctJyArIFRvU3RyaW5nKGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQuZnJlcXVlbmN5TWF4LnZhbHVlKSwKICAgICAgICAgICAgJycKICAgICAgICAgICkKICAgIHJldHVybiB7CiAgICAgIHJ4Tm9ybUNvZGU6IHJ4Tm9ybUNvZGUsCiAgICAgIGlzRHJhZnQ6IE8uc3RhdHVzLnZhbHVlID0gJ2RyYWZ0JywKICAgICAgLy8gTk9URTogQXNzdW1pbmcgYXNOZWVkZWQgaXMgZXhwcmVzc2VkIGFzIGEgYm9vbGVhbgogICAgICBpc1BSTjogZG9zYWdlSW5zdHJ1Y3Rpb24uYXNOZWVkZWQsCiAgICAgIHByZXNjcmlwdGlvbjoKICAgICAgICBpZiBkb3NhZ2VJbnN0cnVjdGlvbi50ZXh0IGlzIG5vdCBudWxsIHRoZW4KICAgICAgICAgIG1lZGljYXRpb25OYW1lICsgJyAnICsgZG9zYWdlSW5zdHJ1Y3Rpb24udGV4dC52YWx1ZQogICAgICAgIGVsc2UKICAgICAgICAgIC8vIFRPRE86IFNob3VsZG4ndCBuZWVkIHRoZSAudmFsdWUgaGVyZSBvbiBhc05lZWRlZEJvb2xlYW4KICAgICAgICAgIG1lZGljYXRpb25OYW1lICsgJyAnICsgZG9zZURlc2NyaXB0aW9uICsgJyBxJyArIGZyZXF1ZW5jeURlc2NyaXB0aW9uICsgKGlmIGRvc2FnZUluc3RydWN0aW9uLmFzTmVlZGVkIHRoZW4gJyBQUk4nIGVsc2UgJycpLAogICAgICAvLyBUT0RPOiBTaG91bGRuJ3QgbmVlZCB0aGUgVG9RdWFudGl0eSBoZXJlLi4uCiAgICAgIGRvc2U6IGlmIGRvc2FnZUluc3RydWN0aW9uLmRvc2UgaXMgRkhJUi5SYW5nZQogICAgICAgICAgICB0aGVuIFRvUXVhbnRpdHkoKGRvc2FnZUluc3RydWN0aW9uLmRvc2UgYXMgRkhJUi5SYW5nZSkuaGlnaCkKICAgICAgICAgICAgZWxzZSBUb1F1YW50aXR5KGRvc2FnZUluc3RydWN0aW9uLmRvc2UpLAogICAgICBkb3Nlc1BlckRheTogQ29hbGVzY2UoT01US0xvZ2ljLlRvRGFpbHkoZnJlcXVlbmN5LCBwZXJpb2QpLCAxLjApCiAgICB9CgpkZWZpbmUgZnVuY3Rpb24gTU1FKHByZXNjcmlwdGlvbnMgTGlzdDxNZWRpY2F0aW9uUmVxdWVzdD4pOgogIChQcmVzY3JpcHRpb25zKHByZXNjcmlwdGlvbnMpKSBQCiAgICBsZXQgbW1lUGVySW5ncmVkaWVudDogT01US0xvZ2ljLkNhbGN1bGF0ZU1NRXMoeyB7IHJ4Tm9ybUNvZGU6IFAucnhOb3JtQ29kZSwgZG9zZVF1YW50aXR5OiBQLmRvc2UsIGRvc2VzUGVyRGF5OiBQLmRvc2VzUGVyRGF5IH0gfSkKICAgIHJldHVybiB7CiAgICAgIHJ4Tm9ybUNvZGU6IFAucnhOb3JtQ29kZSwKICAgICAgaXNEcmFmdDogUC5pc0RyYWZ0LAogICAgICBpc1BSTjogUC5pc1BSTiwKICAgICAgcHJlc2NyaXB0aW9uOiBQLnByZXNjcmlwdGlvbiwKICAgICAgZGFpbHlEb3NlOiBDb21iaW5lKG1tZVBlckluZ3JlZGllbnQgWCByZXR1cm4gWC5kYWlseURvc2VEZXNjcmlwdGlvbiwgJ1xyXG4nKSwKICAgICAgbW1lOiBTdW0obW1lUGVySW5ncmVkaWVudCBYIHJldHVybiBYLm1tZSkKICAgIH0KCmRlZmluZSBmdW5jdGlvbiBUb3RhbE1NRShwcmVzY3JpcHRpb25zIExpc3Q8TWVkaWNhdGlvblJlcXVlc3Q+KToKICBTeXN0ZW0uUXVhbnRpdHkgewogICAgdmFsdWU6IFN1bSgoTU1FKHByZXNjcmlwdGlvbnMpKSBNIHJldHVybiBNLm1tZS52YWx1ZSksCiAgICB1bml0OiAnbWcvZCcKICB9CgpkZWZpbmUgZnVuY3Rpb24gR2V0RHVyYXRpb25JbkRheXModmFsdWUgRkhJUi5EdXJhdGlvbik6CiAgaWYgdmFsdWUgaXMgbnVsbCB0aGVuIG51bGwKICBlbHNlCiAgICBjYXNlCiAgICAgIHdoZW4gdmFsdWUuY29kZS52YWx1ZSB+ICdhJyB0aGVuIHZhbHVlLnZhbHVlLnZhbHVlICogMzY1LjAKICAgICAgd2hlbiB2YWx1ZS5jb2RlLnZhbHVlIH4gJ21vJyB0aGVuIHZhbHVlLnZhbHVlLnZhbHVlICogMzAuMAogICAgICB3aGVuIHZhbHVlLmNvZGUudmFsdWUgfiAnd2snIHRoZW4gdmFsdWUudmFsdWUudmFsdWUgKiA3LjAKICAgICAgd2hlbiB2YWx1ZS5jb2RlLnZhbHVlIH4gJ2QnIHRoZW4gdmFsdWUudmFsdWUudmFsdWUKICAgICAgd2hlbiB2YWx1ZS5jb2RlLnZhbHVlIH4gJ2gnIHRoZW4gdmFsdWUudmFsdWUudmFsdWUgLyAyNC4wCiAgICAgIHdoZW4gdmFsdWUuY29kZS52YWx1ZSB+ICdtaW4nIHRoZW4gdmFsdWUudmFsdWUudmFsdWUgLyA2MC4wIC8gMjQuMAogICAgICB3aGVuIHZhbHVlLmNvZGUudmFsdWUgfiAncycgdGhlbiB2YWx1ZS52YWx1ZS52YWx1ZSAvIDYwLjAgLyA2MC4wIC8gMjQuMAogICAgICB3aGVuIHZhbHVlLmNvZGUudmFsdWUgfiAnbXMnIHRoZW4gdmFsdWUudmFsdWUudmFsdWUgLyA2MC4wIC8gNjAuMCAvIDI0LjAgLyAxMDAwLjAKICAgICAgd2hlbiB2YWx1ZS5jb2RlLnZhbHVlIGlzIG51bGwgdGhlbiBNZXNzYWdlKDEwMDAsIHRydWUsICdVbmRlZmluZWQnLCAnRXJyb3InLCAnRHVyYXRpb24gdW5pdCBjb2RlIGlzIG51bGwnKQogICAgICBlbHNlIE1lc3NhZ2UoMTAwMCwgdHJ1ZSwgJ1VuZGVmaW5lZCcsICdFcnJvcicsICdVbnN1cHBvcnRlZCBkdXJhdGlvbiB1bml0IGNvZGU6ICcgKyB2YWx1ZS5jb2RlLnZhbHVlKQogICAgZW5kCgpkZWZpbmUgZnVuY3Rpb24gR2V0SW5ncmVkaWVudChyeE5vcm1Db2RlIENvZGUpOgogIE9NVEtMb2dpYy5HZXRJbmdyZWRpZW50cyhyeE5vcm1Db2RlKS5pbmdyZWRpZW50TmFtZQoKZGVmaW5lIGZ1bmN0aW9uIEdldEluZ3JlZGllbnRzKHJ4Tm9ybUNvZGVzIExpc3Q8Q29kZT4pOgogIHJ4Tm9ybUNvZGVzIHJuYyByZXR1cm4gR2V0SW5ncmVkaWVudChybmMpCgovKgoqICBDb252ZXJzaW9uIEZ1bmN0aW9ucwoqLwoKZGVmaW5lIGZ1bmN0aW9uIFRvUXVhbnRpdHkocXVhbnRpdHkgRkhJUi5RdWFudGl0eSk6CiAgaWYgcXVhbnRpdHkuY29kZS52YWx1ZSBpcyBub3QgbnVsbAogICAgdGhlbiBTeXN0ZW0uUXVhbnRpdHkgeyB2YWx1ZTogcXVhbnRpdHkudmFsdWUudmFsdWUsIHVuaXQ6IHF1YW50aXR5LmNvZGUudmFsdWUgfQogIGVsc2UgU3lzdGVtLlF1YW50aXR5IHsgdmFsdWU6IHF1YW50aXR5LnZhbHVlLnZhbHVlLCB1bml0OiBxdWFudGl0eS51bml0LnZhbHVlIH0K"
  } ]
}