<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <identifier id="OMTKLogic" version="0.0.1"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
   </usings>
   <includes>
      <def localId="1" localIdentifier="OMTKData" path="OMTKData" version="0.0.2"/>
   </includes>
   <codeSystems>
      <def localId="2" name="RxNorm" id="http://www.nlm.nih.gov/research/umls/rxnorm" accessLevel="Public"/>
   </codeSystems>
   <statements>
      <def localId="23" name="ToUCUM" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="23">
               <a:s>define function ToUCUM(unit </a:s>
               <a:s r="3">
                  <a:s>String</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="22">
                  <a:s r="22">
                     <a:s>case </a:s>
                     <a:s r="4">
                        <a:s>unit</a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="7">
                        <a:s>when </a:s>
                        <a:s r="5">
                           <a:s>'MG'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="6">
                           <a:s>'mg'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="10">
                        <a:s>when </a:s>
                        <a:s r="8">
                           <a:s>'MG/ACTUAT'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="9">
                           <a:s>'mg/{actuat}'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="13">
                        <a:s>when </a:s>
                        <a:s r="11">
                           <a:s>'MG/HR'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="12">
                           <a:s>'mg/h'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="16">
                        <a:s>when </a:s>
                        <a:s r="14">
                           <a:s>'MG/ML'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="15">
                           <a:s>'mg/mL'</a:s>
                        </a:s>
                     </a:s>
                     <a:s> &#xd;
    else </a:s>
                     <a:s r="21">
                        <a:s r="19">
                           <a:s r="17">
                              <a:s>'Error: unknown{'</a:s>
                           </a:s>
                           <a:s> + </a:s>
                           <a:s r="18">
                              <a:s>unit</a:s>
                           </a:s>
                        </a:s>
                        <a:s> + </a:s>
                        <a:s r="20">
                           <a:s>'}'</a:s>
                        </a:s>
                     </a:s>
                     <a:s> &#xd;
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="22" xsi:type="Case">
            <comparand localId="4" name="unit" xsi:type="OperandRef"/>
            <caseItem localId="7">
               <when localId="5" valueType="t:String" value="MG" xsi:type="Literal"/>
               <then localId="6" valueType="t:String" value="mg" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="10">
               <when localId="8" valueType="t:String" value="MG/ACTUAT" xsi:type="Literal"/>
               <then localId="9" valueType="t:String" value="mg/{actuat}" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="13">
               <when localId="11" valueType="t:String" value="MG/HR" xsi:type="Literal"/>
               <then localId="12" valueType="t:String" value="mg/h" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="16">
               <when localId="14" valueType="t:String" value="MG/ML" xsi:type="Literal"/>
               <then localId="15" valueType="t:String" value="mg/mL" xsi:type="Literal"/>
            </caseItem>
            <else localId="21" xsi:type="Concatenate">
               <operand localId="19" xsi:type="Concatenate">
                  <operand localId="17" valueType="t:String" value="Error: unknown{" xsi:type="Literal"/>
                  <operand localId="18" name="unit" xsi:type="OperandRef"/>
               </operand>
               <operand localId="20" valueType="t:String" value="}" xsi:type="Literal"/>
            </else>
         </expression>
         <operand name="unit">
            <operandTypeSpecifier localId="3" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="106" name="ToDaily" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="106">
               <a:s>define function ToDaily(frequency </a:s>
               <a:s r="24">
                  <a:s>Integer</a:s>
               </a:s>
               <a:s>, period </a:s>
               <a:s r="25">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="105">
                  <a:s r="105">
                     <a:s>case </a:s>
                     <a:s r="27">
                        <a:s r="26">
                           <a:s>period</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="27">
                           <a:s>unit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="35">
                        <a:s>when </a:s>
                        <a:s r="28">
                           <a:s>'h'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="34">
                           <a:s r="29">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> * </a:s>
                           <a:s r="33">
                              <a:s>( </a:s>
                              <a:s r="33">
                                 <a:s r="30">24.0 / </a:s>
                                 <a:s r="32">
                                    <a:s r="31">
                                       <a:s>period</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="32">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="45">
                        <a:s>when </a:s>
                        <a:s r="36">
                           <a:s>'min'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="44">
                           <a:s r="42">
                              <a:s r="37">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="41">
                                 <a:s>( </a:s>
                                 <a:s r="41">
                                    <a:s r="38">24.0 / </a:s>
                                    <a:s r="40">
                                       <a:s r="39">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="40">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> )</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="43"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="57">
                        <a:s>when </a:s>
                        <a:s r="46">
                           <a:s>'s'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="56">
                           <a:s r="54">
                              <a:s r="52">
                                 <a:s r="47">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="51">
                                    <a:s>( </a:s>
                                    <a:s r="51">
                                       <a:s r="48">24.0 / </a:s>
                                       <a:s r="50">
                                          <a:s r="49">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="50">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> )</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="53"> * 60</a:s>
                           </a:s>
                           <a:s r="55"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="67">
                        <a:s>when </a:s>
                        <a:s r="58">
                           <a:s>'d'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="66">
                           <a:s r="64">
                              <a:s r="59">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="63">
                                 <a:s>( </a:s>
                                 <a:s r="63">
                                    <a:s r="60">24.0 / </a:s>
                                    <a:s r="62">
                                       <a:s r="61">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="62">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> )</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="65"> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="79">
                        <a:s>when </a:s>
                        <a:s r="68">
                           <a:s>'wk'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="78">
                           <a:s r="74">
                              <a:s r="69">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="73">
                                 <a:s>( </a:s>
                                 <a:s r="73">
                                    <a:s r="70">24.0 / </a:s>
                                    <a:s r="72">
                                       <a:s r="71">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="72">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> )</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="77">
                              <a:s>( </a:s>
                              <a:s r="77">
                                 <a:s r="75">24 * 7</a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="91">
                        <a:s>when </a:s>
                        <a:s r="80">
                           <a:s>'mo'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="90">
                           <a:s r="86">
                              <a:s r="81">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="85">
                                 <a:s>( </a:s>
                                 <a:s r="85">
                                    <a:s r="82">24.0 / </a:s>
                                    <a:s r="84">
                                       <a:s r="83">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="84">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> )</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="89">
                              <a:s>( </a:s>
                              <a:s r="89">
                                 <a:s r="87">24 * 30</a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 30 days in month */&#xd;
    </a:s>
                     <a:s r="103">
                        <a:s>when </a:s>
                        <a:s r="92">
                           <a:s>'a'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="102">
                           <a:s r="98">
                              <a:s r="93">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="97">
                                 <a:s>( </a:s>
                                 <a:s r="97">
                                    <a:s r="94">24.0 / </a:s>
                                    <a:s r="96">
                                       <a:s r="95">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="96">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> )</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="101">
                              <a:s>( </a:s>
                              <a:s r="101">
                                 <a:s r="99">24 * 365</a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s r="104"> /* assuming 365 days in year */ &#xd;
    else null &#xd;
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="105" xsi:type="Case">
            <comparand localId="27" path="unit" xsi:type="Property">
               <source localId="26" name="period" xsi:type="OperandRef"/>
            </comparand>
            <caseItem localId="35">
               <when localId="28" valueType="t:String" value="h" xsi:type="Literal"/>
               <then localId="34" xsi:type="Multiply">
                  <operand xsi:type="ToDecimal">
                     <operand localId="29" name="frequency" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="33" xsi:type="Divide">
                     <operand localId="30" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="32" path="value" xsi:type="Property">
                        <source localId="31" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="45">
               <when localId="36" valueType="t:String" value="min" xsi:type="Literal"/>
               <then localId="44" xsi:type="Multiply">
                  <operand localId="42" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="37" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="41" xsi:type="Divide">
                        <operand localId="38" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="40" path="value" xsi:type="Property">
                           <source localId="39" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="43" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="57">
               <when localId="46" valueType="t:String" value="s" xsi:type="Literal"/>
               <then localId="56" xsi:type="Multiply">
                  <operand localId="54" xsi:type="Multiply">
                     <operand localId="52" xsi:type="Multiply">
                        <operand xsi:type="ToDecimal">
                           <operand localId="47" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand localId="51" xsi:type="Divide">
                           <operand localId="48" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                           <operand localId="50" path="value" xsi:type="Property">
                              <source localId="49" name="period" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <operand localId="53" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="55" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="67">
               <when localId="58" valueType="t:String" value="d" xsi:type="Literal"/>
               <then localId="66" xsi:type="Divide">
                  <operand localId="64" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="59" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="63" xsi:type="Divide">
                        <operand localId="60" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="62" path="value" xsi:type="Property">
                           <source localId="61" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="65" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="79">
               <when localId="68" valueType="t:String" value="wk" xsi:type="Literal"/>
               <then localId="78" xsi:type="Divide">
                  <operand localId="74" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="69" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="73" xsi:type="Divide">
                        <operand localId="70" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="72" path="value" xsi:type="Property">
                           <source localId="71" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="77" xsi:type="Multiply">
                        <operand localId="75" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="76" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="91">
               <when localId="80" valueType="t:String" value="mo" xsi:type="Literal"/>
               <then localId="90" xsi:type="Divide">
                  <operand localId="86" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="81" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="85" xsi:type="Divide">
                        <operand localId="82" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="84" path="value" xsi:type="Property">
                           <source localId="83" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="89" xsi:type="Multiply">
                        <operand localId="87" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="88" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="103">
               <when localId="92" valueType="t:String" value="a" xsi:type="Literal"/>
               <then localId="102" xsi:type="Divide">
                  <operand localId="98" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="93" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="97" xsi:type="Divide">
                        <operand localId="94" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="96" path="value" xsi:type="Property">
                           <source localId="95" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="101" xsi:type="Multiply">
                        <operand localId="99" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="100" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <else asType="t:Decimal" xsi:type="As">
               <operand localId="104" xsi:type="Null"/>
            </else>
         </expression>
         <operand name="frequency">
            <operandTypeSpecifier localId="24" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="period">
            <operandTypeSpecifier localId="25" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="113" name="IsPatch" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="113">
               <a:s>define function IsPatch(doseFormCode </a:s>
               <a:s r="107">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="112">
                  <a:s r="112">
                     <a:s r="110">
                        <a:s>ToInteger(</a:s>
                        <a:s r="109">
                           <a:s r="108">
                              <a:s>doseFormCode</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="109">
                              <a:s>code</a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s r="111">= 316987</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="112" xsi:type="Equal">
            <operand localId="110" xsi:type="ToInteger">
               <operand localId="109" path="code" xsi:type="Property">
                  <source localId="108" name="doseFormCode" xsi:type="OperandRef"/>
               </operand>
            </operand>
            <operand localId="111" valueType="t:Integer" value="316987" xsi:type="Literal"/>
         </expression>
         <operand name="doseFormCode">
            <operandTypeSpecifier localId="107" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="334" name="GetConversionFactor" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="334">
               <a:s>define function GetConversionFactor(ingredientCode </a:s>
               <a:s r="114">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>, dailyDose </a:s>
               <a:s r="115">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>, doseFormCode </a:s>
               <a:s r="116">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="333">
                  <a:s r="333">
                     <a:s>case </a:s>
                     <a:s r="119">
                        <a:s>ToInteger(</a:s>
                        <a:s r="118">
                           <a:s r="117">
                              <a:s>ingredientCode</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="118">
                              <a:s>code</a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="122">
                        <a:s r="120">when 161 then 0</a:s>
                     </a:s>
                     <a:s>  /*   Acetaminophen */&#xd;
    </a:s>
                     <a:s r="125">
                        <a:s r="123">when 1191 then 0</a:s>
                     </a:s>
                     <a:s> /* Aspirin */&#xd;
    </a:s>
                     <a:s r="128">
                        <a:s r="126">when 1223 then 0</a:s>
                     </a:s>
                     <a:s> /* Atropine */&#xd;
    </a:s>
                     <a:s r="131">
                        <a:s r="129">when 1767 then 0</a:s>
                     </a:s>
                     <a:s> /* Brompheniramine */&#xd;
    </a:s>
                     <a:s r="142">
                        <a:s r="132">when 1819 then </a:s>
                        <a:s r="141">
                           <a:s>( /*   Buprenorphine */&#xd;
      </a:s>
                           <a:s r="141">
                              <a:s>case&#xd;
        </a:s>
                              <a:s r="139">
                                 <a:s>when </a:s>
                                 <a:s r="137">
                                    <a:s r="135">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="134">
                                          <a:s r="133">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="134">
                                             <a:s>code</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s r="136">= 316987</a:s>
                                 </a:s>
                                 <a:s r="138"> then 12.6</a:s>
                              </a:s>
                              <a:s r="140"> /* Transdermal system */ &#xd;
        else 30 /* Tablet or Film (or Film in MCG) */ &#xd;
      end</a:s>
                           </a:s>
                           <a:s>&#xd;
    )</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="145">
                        <a:s r="143">when 1841 then 7</a:s>
                     </a:s>
                     <a:s> /* Butorphanol */&#xd;
    </a:s>
                     <a:s r="148">
                        <a:s r="146">when 1886 then 0</a:s>
                     </a:s>
                     <a:s> /* Caffeine */&#xd;
    </a:s>
                     <a:s r="151">
                        <a:s r="149">when 2101 then 0</a:s>
                     </a:s>
                     <a:s> /* Carisoprodol */&#xd;
    </a:s>
                     <a:s r="154">
                        <a:s r="152">when 2354 then 0</a:s>
                     </a:s>
                     <a:s> /* chlorcyclizine */&#xd;
    </a:s>
                     <a:s r="157">
                        <a:s r="155">when 2400 then 0</a:s>
                     </a:s>
                     <a:s> /* Chlorpheniramine */&#xd;
    </a:s>
                     <a:s r="160">
                        <a:s r="158">when 2670 then 0.15</a:s>
                     </a:s>
                     <a:s> /* Codeine */&#xd;
    </a:s>
                     <a:s r="163">
                        <a:s r="161">when 3423 then 4</a:s>
                     </a:s>
                     <a:s> /* Hydromorphone */&#xd;
    </a:s>
                     <a:s r="166">
                        <a:s r="164">when 3498 then 0</a:s>
                     </a:s>
                     <a:s> /* Diphenhydramine */&#xd;
    </a:s>
                     <a:s r="205">
                        <a:s r="167">when 4337 then </a:s>
                        <a:s r="204">
                           <a:s>( /*   Fentanyl */&#xd;
      </a:s>
                           <a:s r="204">
                              <a:s>case&#xd;
        </a:s>
                              <a:s r="177">
                                 <a:s>when </a:s>
                                 <a:s r="175">
                                    <a:s r="170">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="169">
                                          <a:s r="168">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="169">
                                             <a:s>code</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>in </a:s>
                                    <a:s r="174">
                                       <a:s r="171">{ 970789, 317007, 316992 }</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="176"> then 0.13</a:s>
                              </a:s>
                              <a:s> /* Buccal Tablet, Sublingual Tablet, Oral Lozenge */&#xd;
        </a:s>
                              <a:s r="184">
                                 <a:s>when </a:s>
                                 <a:s r="182">
                                    <a:s r="180">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="179">
                                          <a:s r="178">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="179">
                                             <a:s>code</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s r="181">= 346163</a:s>
                                 </a:s>
                                 <a:s r="183"> then 0.18</a:s>
                              </a:s>
                              <a:s> /* Buccal Film */&#xd;
        </a:s>
                              <a:s r="193">
                                 <a:s>when </a:s>
                                 <a:s r="191">
                                    <a:s r="187">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="186">
                                          <a:s r="185">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="186">
                                             <a:s>code</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>in </a:s>
                                    <a:s r="190">
                                       <a:s r="188">{ 126542, 346163 }</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="192"> then 0.16</a:s>
                              </a:s>
                              <a:s> /* Nasal Spray, Mucosal Spray */&#xd;
        </a:s>
                              <a:s r="197">
                                 <a:s>when </a:s>
                                 <a:s r="195">
                                    <a:s>IsPatch(</a:s>
                                    <a:s r="194">
                                       <a:s>doseFormCode</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s r="196">then 2.4</a:s>
                              </a:s>
                              <a:s> /* Transdermal system */ &#xd;
        else </a:s>
                              <a:s r="203">
                                 <a:s r="198">Message(1000, true, </a:s>
                                 <a:s r="200">
                                    <a:s>'Undefined'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="201">
                                    <a:s>'Error'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="202">
                                    <a:s>'The dose form is unexpected'</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>&#xd;
      end</a:s>
                           </a:s>
                           <a:s>&#xd;
    )</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="208">
                        <a:s r="206">when 5032 then 0</a:s>
                     </a:s>
                     <a:s> /* Guaifenesin */&#xd;
    </a:s>
                     <a:s r="211">
                        <a:s r="209">when 5489 then 1</a:s>
                     </a:s>
                     <a:s> /* Hydrocodone */&#xd;
    </a:s>
                     <a:s r="214">
                        <a:s r="212">when 5640 then 0</a:s>
                     </a:s>
                     <a:s> /* Ibuprofen */&#xd;
    </a:s>
                     <a:s r="217">
                        <a:s r="215">when 6102 then 0</a:s>
                     </a:s>
                     <a:s> /* Kaolin */&#xd;
    </a:s>
                     <a:s r="220">
                        <a:s r="218">when 6378 then 11</a:s>
                     </a:s>
                     <a:s> /* Levorphanol (NOTE: Given as Levorphanol tartrate in the CDC conversion table) */&#xd;
    </a:s>
                     <a:s r="223">
                        <a:s r="221">when 6754 then 0.1</a:s>
                     </a:s>
                     <a:s> /* Meperidine */&#xd;
    </a:s>
                     <a:s r="262">
                        <a:s r="224">when 6813 then </a:s>
                        <a:s r="261">
                           <a:s>( /*   Methadone */&#xd;
      </a:s>
                           <a:s r="261">
                              <a:s>case&#xd;
        </a:s>
                              <a:s r="231">
                                 <a:s>when </a:s>
                                 <a:s r="229">
                                    <a:s r="226">
                                       <a:s r="225">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="226">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="227"> between 1 and 20</a:s>
                                 </a:s>
                                 <a:s r="230"> then 4</a:s>
                              </a:s>
                              <a:s>&#xd;
        </a:s>
                              <a:s r="238">
                                 <a:s>when </a:s>
                                 <a:s r="236">
                                    <a:s r="233">
                                       <a:s r="232">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="233">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="234"> between 21 and 40</a:s>
                                 </a:s>
                                 <a:s r="237"> then 8</a:s>
                              </a:s>
                              <a:s>&#xd;
        </a:s>
                              <a:s r="245">
                                 <a:s>when </a:s>
                                 <a:s r="243">
                                    <a:s r="240">
                                       <a:s r="239">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="240">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="241"> between 41 and 60</a:s>
                                 </a:s>
                                 <a:s r="244"> then 10</a:s>
                              </a:s>
                              <a:s>&#xd;
        </a:s>
                              <a:s r="251">
                                 <a:s>when </a:s>
                                 <a:s r="249">
                                    <a:s r="247">
                                       <a:s r="246">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="247">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="248"> >= 61</a:s>
                                 </a:s>
                                 <a:s r="250"> then 12</a:s>
                              </a:s>
                              <a:s> &#xd;
        else </a:s>
                              <a:s r="260">
                                 <a:s r="252">Message(1000, </a:s>
                                 <a:s r="256">
                                    <a:s r="254">
                                       <a:s r="253">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="254">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="255"> &lt; 1</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="257">
                                    <a:s>'Undefined'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="258">
                                    <a:s>'Error'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="259">
                                    <a:s>'The dose range is unexpected'</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>&#xd;
      end</a:s>
                           </a:s>
                           <a:s>&#xd;
    )</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="265">
                        <a:s r="263">when 7052 then 1</a:s>
                     </a:s>
                     <a:s> /* Morphine */&#xd;
    </a:s>
                     <a:s r="268">
                        <a:s r="266">when 7242 then 0</a:s>
                     </a:s>
                     <a:s> /* Naloxone */&#xd;
    </a:s>
                     <a:s r="271">
                        <a:s r="269">when 7243 then 0</a:s>
                     </a:s>
                     <a:s> /* Naltrexone */&#xd;
    </a:s>
                     <a:s r="274">
                        <a:s r="272">when 7804 then 1.5</a:s>
                     </a:s>
                     <a:s> /* Oxycodone */&#xd;
    </a:s>
                     <a:s r="277">
                        <a:s r="275">when 7814 then 3</a:s>
                     </a:s>
                     <a:s> /* Oxymorphone */&#xd;
    </a:s>
                     <a:s r="280">
                        <a:s r="278">when 8001 then 0.37</a:s>
                     </a:s>
                     <a:s> /* Pentazocine */&#xd;
    </a:s>
                     <a:s r="283">
                        <a:s r="281">when 8163 then 0</a:s>
                     </a:s>
                     <a:s> /* Phenylephrine */&#xd;
    </a:s>
                     <a:s r="286">
                        <a:s r="284">when 8175 then 0</a:s>
                     </a:s>
                     <a:s> /* Phenylpropanolamine */&#xd;
    </a:s>
                     <a:s r="289">
                        <a:s r="287">when 8745 then 0</a:s>
                     </a:s>
                     <a:s> /* Promethazine */&#xd;
    </a:s>
                     <a:s r="292">
                        <a:s r="290">when 8896 then 0</a:s>
                     </a:s>
                     <a:s> /* Pseudoephedrine */&#xd;
    </a:s>
                     <a:s r="295">
                        <a:s r="293">when 9009 then 0</a:s>
                     </a:s>
                     <a:s> /* Pyrilamine */&#xd;
    </a:s>
                     <a:s r="298">
                        <a:s r="296">when 10689 then 0.1</a:s>
                     </a:s>
                     <a:s> /* Tramadol */&#xd;
    </a:s>
                     <a:s r="301">
                        <a:s r="299">when 10849 then 0</a:s>
                     </a:s>
                     <a:s> /* Triprolidine */&#xd;
    </a:s>
                     <a:s r="304">
                        <a:s r="302">when 19759 then 0</a:s>
                     </a:s>
                     <a:s> /* bromodiphenhydramine */&#xd;
    </a:s>
                     <a:s r="307">
                        <a:s r="305">when 19860 then 0</a:s>
                     </a:s>
                     <a:s> /* butalbital */&#xd;
    </a:s>
                     <a:s r="310">
                        <a:s r="308">when 22696 then 0</a:s>
                     </a:s>
                     <a:s> /* dexbrompheniramine */&#xd;
    </a:s>
                     <a:s r="313">
                        <a:s r="311">when 22697 then 0</a:s>
                     </a:s>
                     <a:s> /* dexchlorpheniramine */&#xd;
    </a:s>
                     <a:s r="316">
                        <a:s r="314">when 23088 then 0.25</a:s>
                     </a:s>
                     <a:s> /* dihydrocodeine */&#xd;
    </a:s>
                     <a:s r="319">
                        <a:s r="317">when 27084 then 0</a:s>
                     </a:s>
                     <a:s> /* homatropine */&#xd;
    </a:s>
                     <a:s r="322">
                        <a:s r="320">when 35780 then 0</a:s>
                     </a:s>
                     <a:s> /* ropivacaine */&#xd;
    </a:s>
                     <a:s r="325">
                        <a:s r="323">when 237005 then 8</a:s>
                     </a:s>
                     <a:s> /* Levomethadyl (NOTE: given as Levomethadyl acetate in the CDC conversion table) */&#xd;
    </a:s>
                     <a:s r="328">
                        <a:s r="326">when 636827 then 0</a:s>
                     </a:s>
                     <a:s> /* guaiacolsulfonate */&#xd;
    </a:s>
                     <a:s r="331">
                        <a:s r="329">when 787390 then 0.4</a:s>
                     </a:s>
                     <a:s r="332"> /*  tapentadol */ &#xd;
    else 0 &#xd;
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="333" xsi:type="Case">
            <comparand localId="119" xsi:type="ToInteger">
               <operand localId="118" path="code" xsi:type="Property">
                  <source localId="117" name="ingredientCode" xsi:type="OperandRef"/>
               </operand>
            </comparand>
            <caseItem localId="122">
               <when localId="120" valueType="t:Integer" value="161" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="121" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="125">
               <when localId="123" valueType="t:Integer" value="1191" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="124" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="128">
               <when localId="126" valueType="t:Integer" value="1223" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="127" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="131">
               <when localId="129" valueType="t:Integer" value="1767" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="130" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="142">
               <when localId="132" valueType="t:Integer" value="1819" xsi:type="Literal"/>
               <then localId="141" xsi:type="Case">
                  <caseItem localId="139">
                     <when localId="137" xsi:type="Equal">
                        <operand localId="135" xsi:type="ToInteger">
                           <operand localId="134" path="code" xsi:type="Property">
                              <source localId="133" name="doseFormCode" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="136" valueType="t:Integer" value="316987" xsi:type="Literal"/>
                     </when>
                     <then localId="138" valueType="t:Decimal" value="12.6" xsi:type="Literal"/>
                  </caseItem>
                  <else xsi:type="ToDecimal">
                     <operand localId="140" valueType="t:Integer" value="30" xsi:type="Literal"/>
                  </else>
               </then>
            </caseItem>
            <caseItem localId="145">
               <when localId="143" valueType="t:Integer" value="1841" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="144" valueType="t:Integer" value="7" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="148">
               <when localId="146" valueType="t:Integer" value="1886" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="147" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="151">
               <when localId="149" valueType="t:Integer" value="2101" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="150" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="154">
               <when localId="152" valueType="t:Integer" value="2354" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="153" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="157">
               <when localId="155" valueType="t:Integer" value="2400" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="156" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="160">
               <when localId="158" valueType="t:Integer" value="2670" xsi:type="Literal"/>
               <then localId="159" valueType="t:Decimal" value="0.15" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="163">
               <when localId="161" valueType="t:Integer" value="3423" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="162" valueType="t:Integer" value="4" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="166">
               <when localId="164" valueType="t:Integer" value="3498" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="165" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="205">
               <when localId="167" valueType="t:Integer" value="4337" xsi:type="Literal"/>
               <then localId="204" xsi:type="Case">
                  <caseItem localId="177">
                     <when localId="175" xsi:type="In">
                        <operand localId="170" xsi:type="ToInteger">
                           <operand localId="169" path="code" xsi:type="Property">
                              <source localId="168" name="doseFormCode" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="174" xsi:type="List">
                           <element localId="171" valueType="t:Integer" value="970789" xsi:type="Literal"/>
                           <element localId="172" valueType="t:Integer" value="317007" xsi:type="Literal"/>
                           <element localId="173" valueType="t:Integer" value="316992" xsi:type="Literal"/>
                        </operand>
                     </when>
                     <then localId="176" valueType="t:Decimal" value="0.13" xsi:type="Literal"/>
                  </caseItem>
                  <caseItem localId="184">
                     <when localId="182" xsi:type="Equal">
                        <operand localId="180" xsi:type="ToInteger">
                           <operand localId="179" path="code" xsi:type="Property">
                              <source localId="178" name="doseFormCode" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="181" valueType="t:Integer" value="346163" xsi:type="Literal"/>
                     </when>
                     <then localId="183" valueType="t:Decimal" value="0.18" xsi:type="Literal"/>
                  </caseItem>
                  <caseItem localId="193">
                     <when localId="191" xsi:type="In">
                        <operand localId="187" xsi:type="ToInteger">
                           <operand localId="186" path="code" xsi:type="Property">
                              <source localId="185" name="doseFormCode" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="190" xsi:type="List">
                           <element localId="188" valueType="t:Integer" value="126542" xsi:type="Literal"/>
                           <element localId="189" valueType="t:Integer" value="346163" xsi:type="Literal"/>
                        </operand>
                     </when>
                     <then localId="192" valueType="t:Decimal" value="0.16" xsi:type="Literal"/>
                  </caseItem>
                  <caseItem localId="197">
                     <when localId="195" name="IsPatch" xsi:type="FunctionRef">
                        <operand localId="194" name="doseFormCode" xsi:type="OperandRef"/>
                     </when>
                     <then localId="196" valueType="t:Decimal" value="2.4" xsi:type="Literal"/>
                  </caseItem>
                  <else xsi:type="ToDecimal">
                     <operand localId="203" xsi:type="Message">
                        <source localId="198" valueType="t:Integer" value="1000" xsi:type="Literal"/>
                        <condition localId="199" valueType="t:Boolean" value="true" xsi:type="Literal"/>
                        <code localId="200" valueType="t:String" value="Undefined" xsi:type="Literal"/>
                        <severity localId="201" valueType="t:String" value="Error" xsi:type="Literal"/>
                        <message localId="202" valueType="t:String" value="The dose form is unexpected" xsi:type="Literal"/>
                     </operand>
                  </else>
               </then>
            </caseItem>
            <caseItem localId="208">
               <when localId="206" valueType="t:Integer" value="5032" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="207" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="211">
               <when localId="209" valueType="t:Integer" value="5489" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="210" valueType="t:Integer" value="1" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="214">
               <when localId="212" valueType="t:Integer" value="5640" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="213" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="217">
               <when localId="215" valueType="t:Integer" value="6102" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="216" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="220">
               <when localId="218" valueType="t:Integer" value="6378" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="219" valueType="t:Integer" value="11" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="223">
               <when localId="221" valueType="t:Integer" value="6754" xsi:type="Literal"/>
               <then localId="222" valueType="t:Decimal" value="0.1" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="262">
               <when localId="224" valueType="t:Integer" value="6813" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="261" xsi:type="Case">
                     <caseItem localId="231">
                        <when localId="229" xsi:type="And">
                           <operand xsi:type="GreaterOrEqual">
                              <operand localId="226" path="value" xsi:type="Property">
                                 <source localId="225" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand xsi:type="ToDecimal">
                                 <operand localId="227" valueType="t:Integer" value="1" xsi:type="Literal"/>
                              </operand>
                           </operand>
                           <operand xsi:type="LessOrEqual">
                              <operand localId="226" path="value" xsi:type="Property">
                                 <source localId="225" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand xsi:type="ToDecimal">
                                 <operand localId="228" valueType="t:Integer" value="20" xsi:type="Literal"/>
                              </operand>
                           </operand>
                        </when>
                        <then localId="230" valueType="t:Integer" value="4" xsi:type="Literal"/>
                     </caseItem>
                     <caseItem localId="238">
                        <when localId="236" xsi:type="And">
                           <operand xsi:type="GreaterOrEqual">
                              <operand localId="233" path="value" xsi:type="Property">
                                 <source localId="232" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand xsi:type="ToDecimal">
                                 <operand localId="234" valueType="t:Integer" value="21" xsi:type="Literal"/>
                              </operand>
                           </operand>
                           <operand xsi:type="LessOrEqual">
                              <operand localId="233" path="value" xsi:type="Property">
                                 <source localId="232" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand xsi:type="ToDecimal">
                                 <operand localId="235" valueType="t:Integer" value="40" xsi:type="Literal"/>
                              </operand>
                           </operand>
                        </when>
                        <then localId="237" valueType="t:Integer" value="8" xsi:type="Literal"/>
                     </caseItem>
                     <caseItem localId="245">
                        <when localId="243" xsi:type="And">
                           <operand xsi:type="GreaterOrEqual">
                              <operand localId="240" path="value" xsi:type="Property">
                                 <source localId="239" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand xsi:type="ToDecimal">
                                 <operand localId="241" valueType="t:Integer" value="41" xsi:type="Literal"/>
                              </operand>
                           </operand>
                           <operand xsi:type="LessOrEqual">
                              <operand localId="240" path="value" xsi:type="Property">
                                 <source localId="239" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand xsi:type="ToDecimal">
                                 <operand localId="242" valueType="t:Integer" value="60" xsi:type="Literal"/>
                              </operand>
                           </operand>
                        </when>
                        <then localId="244" valueType="t:Integer" value="10" xsi:type="Literal"/>
                     </caseItem>
                     <caseItem localId="251">
                        <when localId="249" xsi:type="GreaterOrEqual">
                           <operand localId="247" path="value" xsi:type="Property">
                              <source localId="246" name="dailyDose" xsi:type="OperandRef"/>
                           </operand>
                           <operand xsi:type="ToDecimal">
                              <operand localId="248" valueType="t:Integer" value="61" xsi:type="Literal"/>
                           </operand>
                        </when>
                        <then localId="250" valueType="t:Integer" value="12" xsi:type="Literal"/>
                     </caseItem>
                     <else localId="260" xsi:type="Message">
                        <source localId="252" valueType="t:Integer" value="1000" xsi:type="Literal"/>
                        <condition localId="256" xsi:type="Less">
                           <operand localId="254" path="value" xsi:type="Property">
                              <source localId="253" name="dailyDose" xsi:type="OperandRef"/>
                           </operand>
                           <operand xsi:type="ToDecimal">
                              <operand localId="255" valueType="t:Integer" value="1" xsi:type="Literal"/>
                           </operand>
                        </condition>
                        <code localId="257" valueType="t:String" value="Undefined" xsi:type="Literal"/>
                        <severity localId="258" valueType="t:String" value="Error" xsi:type="Literal"/>
                        <message localId="259" valueType="t:String" value="The dose range is unexpected" xsi:type="Literal"/>
                     </else>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="265">
               <when localId="263" valueType="t:Integer" value="7052" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="264" valueType="t:Integer" value="1" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="268">
               <when localId="266" valueType="t:Integer" value="7242" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="267" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="271">
               <when localId="269" valueType="t:Integer" value="7243" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="270" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="274">
               <when localId="272" valueType="t:Integer" value="7804" xsi:type="Literal"/>
               <then localId="273" valueType="t:Decimal" value="1.5" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="277">
               <when localId="275" valueType="t:Integer" value="7814" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="276" valueType="t:Integer" value="3" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="280">
               <when localId="278" valueType="t:Integer" value="8001" xsi:type="Literal"/>
               <then localId="279" valueType="t:Decimal" value="0.37" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="283">
               <when localId="281" valueType="t:Integer" value="8163" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="282" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="286">
               <when localId="284" valueType="t:Integer" value="8175" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="285" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="289">
               <when localId="287" valueType="t:Integer" value="8745" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="288" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="292">
               <when localId="290" valueType="t:Integer" value="8896" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="291" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="295">
               <when localId="293" valueType="t:Integer" value="9009" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="294" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="298">
               <when localId="296" valueType="t:Integer" value="10689" xsi:type="Literal"/>
               <then localId="297" valueType="t:Decimal" value="0.1" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="301">
               <when localId="299" valueType="t:Integer" value="10849" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="300" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="304">
               <when localId="302" valueType="t:Integer" value="19759" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="303" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="307">
               <when localId="305" valueType="t:Integer" value="19860" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="306" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="310">
               <when localId="308" valueType="t:Integer" value="22696" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="309" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="313">
               <when localId="311" valueType="t:Integer" value="22697" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="312" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="316">
               <when localId="314" valueType="t:Integer" value="23088" xsi:type="Literal"/>
               <then localId="315" valueType="t:Decimal" value="0.25" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="319">
               <when localId="317" valueType="t:Integer" value="27084" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="318" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="322">
               <when localId="320" valueType="t:Integer" value="35780" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="321" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="325">
               <when localId="323" valueType="t:Integer" value="237005" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="324" valueType="t:Integer" value="8" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="328">
               <when localId="326" valueType="t:Integer" value="636827" xsi:type="Literal"/>
               <then xsi:type="ToDecimal">
                  <operand localId="327" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="331">
               <when localId="329" valueType="t:Integer" value="787390" xsi:type="Literal"/>
               <then localId="330" valueType="t:Decimal" value="0.4" xsi:type="Literal"/>
            </caseItem>
            <else xsi:type="ToDecimal">
               <operand localId="332" valueType="t:Integer" value="0" xsi:type="Literal"/>
            </else>
         </expression>
         <operand name="ingredientCode">
            <operandTypeSpecifier localId="114" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="dailyDose">
            <operandTypeSpecifier localId="115" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="doseFormCode">
            <operandTypeSpecifier localId="116" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="360" name="EnsureMicrogramQuantity" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="360">
               <a:s>define function EnsureMicrogramQuantity(strength </a:s>
               <a:s r="335">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="359">
                  <a:s r="359">
                     <a:s>if </a:s>
                     <a:s r="346">
                        <a:s r="339">
                           <a:s r="337">
                              <a:s r="336">
                                 <a:s>strength</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="337">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="338"> &lt; 0.1</a:s>
                        </a:s>
                        <a:s>&#xd;
    and </a:s>
                        <a:s r="345">
                           <a:s>( </a:s>
                           <a:s r="345">
                              <a:s r="343">
                                 <a:s>PositionOf(</a:s>
                                 <a:s r="340">
                                    <a:s>'mg'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="342">
                                    <a:s r="341">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="342">
                                       <a:s>unit</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s r="344">= 0</a:s>
                           </a:s>
                           <a:s> )</a:s>
                        </a:s>
                     </a:s>
                     <a:s> then </a:s>
                     <a:s r="357">
                        <a:s>Quantity { </a:s>
                        <a:s>
                           <a:s>value: </a:s>
                           <a:s r="350">
                              <a:s r="348">
                                 <a:s r="347">
                                    <a:s>strength</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="348">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="349"> * 1000</a:s>
                           </a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s>
                           <a:s>unit: </a:s>
                           <a:s r="356">
                              <a:s r="351">
                                 <a:s>'mcg'</a:s>
                              </a:s>
                              <a:s> + </a:s>
                              <a:s r="355">
                                 <a:s>Substring(</a:s>
                                 <a:s r="353">
                                    <a:s r="352">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="353">
                                       <a:s>unit</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="354">, 2)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>}</a:s>
                     </a:s>
                     <a:s> &#xd;
    else </a:s>
                     <a:s r="358">
                        <a:s>strength</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="359" xsi:type="If">
            <condition asType="t:Boolean" xsi:type="As">
               <operand localId="346" xsi:type="And">
                  <operand localId="339" xsi:type="Less">
                     <operand localId="337" path="value" xsi:type="Property">
                        <source localId="336" name="strength" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="338" valueType="t:Decimal" value="0.1" xsi:type="Literal"/>
                  </operand>
                  <operand localId="345" xsi:type="Equal">
                     <operand localId="343" xsi:type="PositionOf">
                        <pattern localId="340" valueType="t:String" value="mg" xsi:type="Literal"/>
                        <string localId="342" path="unit" xsi:type="Property">
                           <source localId="341" name="strength" xsi:type="OperandRef"/>
                        </string>
                     </operand>
                     <operand localId="344" valueType="t:Integer" value="0" xsi:type="Literal"/>
                  </operand>
               </operand>
            </condition>
            <then localId="357" classType="t:Quantity" xsi:type="Instance">
               <element name="value">
                  <value localId="350" xsi:type="Multiply">
                     <operand localId="348" path="value" xsi:type="Property">
                        <source localId="347" name="strength" xsi:type="OperandRef"/>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <operand localId="349" valueType="t:Integer" value="1000" xsi:type="Literal"/>
                     </operand>
                  </value>
               </element>
               <element name="unit">
                  <value localId="356" xsi:type="Concatenate">
                     <operand localId="351" valueType="t:String" value="mcg" xsi:type="Literal"/>
                     <operand localId="355" xsi:type="Substring">
                        <stringToSub localId="353" path="unit" xsi:type="Property">
                           <source localId="352" name="strength" xsi:type="OperandRef"/>
                        </stringToSub>
                        <startIndex localId="354" valueType="t:Integer" value="2" xsi:type="Literal"/>
                     </operand>
                  </value>
               </element>
            </then>
            <else localId="358" name="strength" xsi:type="OperandRef"/>
         </expression>
         <operand name="strength">
            <operandTypeSpecifier localId="335" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="405" name="GetIngredients" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="405">
               <a:s>define function GetIngredients(rxNormCode </a:s>
               <a:s r="361">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="404">
                  <a:s r="404">
                     <a:s>
                        <a:s r="363">
                           <a:s r="362">
                              <a:s>
                                 <a:s>OMTKData.DrugIngredients</a:s>
                              </a:s>
                           </a:s>
                           <a:s> DI</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="369">
                        <a:s>where </a:s>
                        <a:s r="369">
                           <a:s r="365">
                              <a:s r="364">
                                 <a:s>DI</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="365">
                                 <a:s>drugCode</a:s>
                              </a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="368">
                              <a:s>ToInteger(</a:s>
                              <a:s r="367">
                                 <a:s r="366">
                                    <a:s>rxNormCode</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="367">
                                    <a:s>code</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="403">
                        <a:s>return </a:s>
                        <a:s r="402">
                           <a:s>{&#xd;
      </a:s>
                           <a:s>
                              <a:s>rxNormCode: </a:s>
                              <a:s r="376">
                                 <a:s>Code { </a:s>
                                 <a:s>
                                    <a:s>code: </a:s>
                                    <a:s r="372">
                                       <a:s>ToString(</a:s>
                                       <a:s r="371">
                                          <a:s r="370">
                                             <a:s>DI</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="371">
                                             <a:s>drugCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>system: </a:s>
                                    <a:s r="373">
                                       <a:s>'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>display: </a:s>
                                    <a:s r="375">
                                       <a:s r="374">
                                          <a:s>DI</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="375">
                                          <a:s>drugName</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> }</a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>doseFormCode: </a:s>
                              <a:s r="383">
                                 <a:s>Code { </a:s>
                                 <a:s>
                                    <a:s>code: </a:s>
                                    <a:s r="379">
                                       <a:s>ToString(</a:s>
                                       <a:s r="378">
                                          <a:s r="377">
                                             <a:s>DI</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="378">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>system: </a:s>
                                    <a:s r="380">
                                       <a:s>'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>display: </a:s>
                                    <a:s r="382">
                                       <a:s r="381">
                                          <a:s>DI</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="382">
                                          <a:s>doseFormName</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> }</a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>doseFormName: </a:s>
                              <a:s r="385">
                                 <a:s r="384">
                                    <a:s>DI</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="385">
                                    <a:s>doseFormName</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>ingredientCode: </a:s>
                              <a:s r="392">
                                 <a:s>Code { </a:s>
                                 <a:s>
                                    <a:s>code: </a:s>
                                    <a:s r="388">
                                       <a:s>ToString(</a:s>
                                       <a:s r="387">
                                          <a:s r="386">
                                             <a:s>DI</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="387">
                                             <a:s>ingredientCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>system: </a:s>
                                    <a:s r="389">
                                       <a:s>'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>display: </a:s>
                                    <a:s r="391">
                                       <a:s r="390">
                                          <a:s>DI</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="391">
                                          <a:s>ingredientName</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> }</a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>ingredientName: </a:s>
                              <a:s r="394">
                                 <a:s r="393">
                                    <a:s>DI</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="394">
                                    <a:s>ingredientName</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>strength: </a:s>
                              <a:s r="401">
                                 <a:s>EnsureMicrogramQuantity(</a:s>
                                 <a:s r="400">
                                    <a:s>Quantity { </a:s>
                                    <a:s>
                                       <a:s>value: </a:s>
                                       <a:s r="396">
                                          <a:s r="395">
                                             <a:s>DI</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="396">
                                             <a:s>strengthValue</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s>
                                       <a:s>unit: </a:s>
                                       <a:s r="399">
                                          <a:s>ToUCUM(</a:s>
                                          <a:s r="398">
                                             <a:s r="397">
                                                <a:s>DI</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="398">
                                                <a:s>strengthUnit</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>}</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
    }</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="404" xsi:type="Query">
            <source localId="363" alias="DI">
               <expression localId="362" name="DrugIngredients" libraryName="OMTKData" xsi:type="ExpressionRef"/>
            </source>
            <where localId="369" xsi:type="Equal">
               <operand localId="365" path="drugCode" scope="DI" xsi:type="Property"/>
               <operand localId="368" xsi:type="ToInteger">
                  <operand localId="367" path="code" xsi:type="Property">
                     <source localId="366" name="rxNormCode" xsi:type="OperandRef"/>
                  </operand>
               </operand>
            </where>
            <return localId="403">
               <expression localId="402" xsi:type="Tuple">
                  <element name="rxNormCode">
                     <value localId="376" classType="t:Code" xsi:type="Instance">
                        <element name="code">
                           <value localId="372" xsi:type="ToString">
                              <operand localId="371" path="drugCode" scope="DI" xsi:type="Property"/>
                           </value>
                        </element>
                        <element name="system">
                           <value localId="373" valueType="t:String" value="http://www.nlm.nih.gov/research/umls/rxnorm" xsi:type="Literal"/>
                        </element>
                        <element name="display">
                           <value localId="375" path="drugName" scope="DI" xsi:type="Property"/>
                        </element>
                     </value>
                  </element>
                  <element name="doseFormCode">
                     <value localId="383" classType="t:Code" xsi:type="Instance">
                        <element name="code">
                           <value localId="379" xsi:type="ToString">
                              <operand localId="378" path="doseFormCode" scope="DI" xsi:type="Property"/>
                           </value>
                        </element>
                        <element name="system">
                           <value localId="380" valueType="t:String" value="http://www.nlm.nih.gov/research/umls/rxnorm" xsi:type="Literal"/>
                        </element>
                        <element name="display">
                           <value localId="382" path="doseFormName" scope="DI" xsi:type="Property"/>
                        </element>
                     </value>
                  </element>
                  <element name="doseFormName">
                     <value localId="385" path="doseFormName" scope="DI" xsi:type="Property"/>
                  </element>
                  <element name="ingredientCode">
                     <value localId="392" classType="t:Code" xsi:type="Instance">
                        <element name="code">
                           <value localId="388" xsi:type="ToString">
                              <operand localId="387" path="ingredientCode" scope="DI" xsi:type="Property"/>
                           </value>
                        </element>
                        <element name="system">
                           <value localId="389" valueType="t:String" value="http://www.nlm.nih.gov/research/umls/rxnorm" xsi:type="Literal"/>
                        </element>
                        <element name="display">
                           <value localId="391" path="ingredientName" scope="DI" xsi:type="Property"/>
                        </element>
                     </value>
                  </element>
                  <element name="ingredientName">
                     <value localId="394" path="ingredientName" scope="DI" xsi:type="Property"/>
                  </element>
                  <element name="strength">
                     <value localId="401" name="EnsureMicrogramQuantity" xsi:type="FunctionRef">
                        <operand localId="400" classType="t:Quantity" xsi:type="Instance">
                           <element name="value">
                              <value localId="396" path="strengthValue" scope="DI" xsi:type="Property"/>
                           </element>
                           <element name="unit">
                              <value localId="399" name="ToUCUM" xsi:type="FunctionRef">
                                 <operand localId="398" path="strengthUnit" scope="DI" xsi:type="Property"/>
                              </value>
                           </element>
                        </operand>
                     </value>
                  </element>
               </expression>
            </return>
         </expression>
         <operand name="rxNormCode">
            <operandTypeSpecifier localId="361" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="496" name="GetDailyDose" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="496">
               <a:s>define function GetDailyDose(ingredientCode </a:s>
               <a:s r="406">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>, strength </a:s>
               <a:s r="407">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>, doseFormCode </a:s>
               <a:s r="408">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>, doseQuantity </a:s>
               <a:s r="409">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>, dosesPerDay </a:s>
               <a:s r="410">
                  <a:s>Decimal</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="495">
                  <a:s r="495">
                     <a:s>case&#xd;
     /* if patch --> daily dose = dose value (e.g, number patches with doseQuantity unit = &quot;patch&quot;) * per-hour strength */&#xd;
    </a:s>
                     <a:s r="432">
                        <a:s>when </a:s>
                        <a:s r="412">
                           <a:s>IsPatch(</a:s>
                           <a:s r="411">
                              <a:s>doseFormCode</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s>then&#xd;
      /* buprenorphine or fentanyl patch */ </a:s>
                        <a:s r="431">
                           <a:s>if </a:s>
                           <a:s r="419">
                              <a:s r="415">
                                 <a:s>ToInteger(</a:s>
                                 <a:s r="414">
                                    <a:s r="413">
                                       <a:s>ingredientCode</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="414">
                                       <a:s>code</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>in </a:s>
                              <a:s r="418">
                                 <a:s r="416">{ 1819, 4337 }</a:s>
                              </a:s>
                           </a:s>
                           <a:s> then </a:s>
                           <a:s r="429">
                              <a:s>Quantity { </a:s>
                              <a:s>
                                 <a:s>value: </a:s>
                                 <a:s r="426">
                                    <a:s r="423">
                                       <a:s r="420">
                                          <a:s>dosesPerDay</a:s>
                                       </a:s>
                                       <a:s> * </a:s>
                                       <a:s r="422">
                                          <a:s r="421">
                                             <a:s>doseQuantity</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="422">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> * </a:s>
                                    <a:s r="425">
                                       <a:s r="424">
                                          <a:s>strength</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="425">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s>
                                 <a:s>unit: </a:s>
                                 <a:s r="428">
                                    <a:s r="427">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="428">
                                       <a:s>unit</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                           <a:s r="430"> &#xd;
      else null</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
&#xd;
    /* if dose unit in actual mass units (mg or mcg -- when it's a single med) --> daily dose = numTimesPerDay * dose */&#xd;
    </a:s>
                     <a:s r="446">
                        <a:s>when </a:s>
                        <a:s r="438">
                           <a:s r="434">
                              <a:s r="433">
                                 <a:s>doseQuantity</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="434">
                                 <a:s>unit</a:s>
                              </a:s>
                           </a:s>
                           <a:s> in </a:s>
                           <a:s r="437">
                              <a:s>{ </a:s>
                              <a:s r="435">
                                 <a:s>'mg'</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="436">
                                 <a:s>'mcg'</a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="445">
                           <a:s>Quantity { </a:s>
                           <a:s>
                              <a:s>value: </a:s>
                              <a:s r="442">
                                 <a:s r="439">
                                    <a:s>dosesPerDay</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="441">
                                    <a:s r="440">
                                       <a:s>doseQuantity</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="441">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s>
                              <a:s>unit: </a:s>
                              <a:s r="444">
                                 <a:s r="443">
                                    <a:s>doseQuantity</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="444">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s> }</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
&#xd;
    /* if doseQuantity is in actual volume units (mL) --> daily dose = numTimesPerDay * dose * strength */&#xd;
    </a:s>
                     <a:s r="478">
                        <a:s>when </a:s>
                        <a:s r="461">
                           <a:s r="450">
                              <a:s r="448">
                                 <a:s r="447">
                                    <a:s>doseQuantity</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="448">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> = </a:s>
                              <a:s r="449">
                                 <a:s>'mL'</a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
      and </a:s>
                           <a:s r="460">
                              <a:s>( </a:s>
                              <a:s r="460">
                                 <a:s r="454">
                                    <a:s>PositionOf(</a:s>
                                    <a:s r="451">
                                       <a:s>'/mL'</a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s r="453">
                                       <a:s r="452">
                                          <a:s>strength</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="453">
                                          <a:s>unit</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s>= </a:s>
                                 <a:s r="459">
                                    <a:s r="457">
                                       <a:s>Length(</a:s>
                                       <a:s r="456">
                                          <a:s r="455">
                                             <a:s>strength</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="456">
                                             <a:s>unit</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s r="458">- 3</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="477">
                           <a:s>Quantity { </a:s>
                           <a:s>
                              <a:s>value: </a:s>
                              <a:s r="468">
                                 <a:s r="465">
                                    <a:s r="462">
                                       <a:s>dosesPerDay</a:s>
                                    </a:s>
                                    <a:s> * </a:s>
                                    <a:s r="464">
                                       <a:s r="463">
                                          <a:s>doseQuantity</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="464">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="467">
                                    <a:s r="466">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="467">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s>
                              <a:s>unit: </a:s>
                              <a:s r="476">
                                 <a:s>Substring(</a:s>
                                 <a:s r="470">
                                    <a:s r="469">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="470">
                                       <a:s>unit</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="471">, 0, </a:s>
                                 <a:s r="475">
                                    <a:s>PositionOf(</a:s>
                                    <a:s r="472">
                                       <a:s>'/'</a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s r="474">
                                       <a:s r="473">
                                          <a:s>strength</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="474">
                                          <a:s>unit</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s>}</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
&#xd;
      /* if doseQuantity is not in actual units (e.g., 1 tab, 1 spray -- when it's a combo med with a unit of tablet, or it's mg/actuat) -->  daily dose = numTimesPerDay * dose value * strength value */ &#xd;
    else </a:s>
                     <a:s r="494">
                        <a:s>Quantity { </a:s>
                        <a:s>
                           <a:s>value: </a:s>
                           <a:s r="485">
                              <a:s r="482">
                                 <a:s r="479">
                                    <a:s>dosesPerDay</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="481">
                                    <a:s r="480">
                                       <a:s>doseQuantity</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="481">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="484">
                                 <a:s r="483">
                                    <a:s>strength</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="484">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s>
                           <a:s>unit: </a:s>
                           <a:s r="493">
                              <a:s>Substring(</a:s>
                              <a:s r="487">
                                 <a:s r="486">
                                    <a:s>strength</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="487">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="488">, 0, </a:s>
                              <a:s r="492">
                                 <a:s>PositionOf(</a:s>
                                 <a:s r="489">
                                    <a:s>'/'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="491">
                                    <a:s r="490">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="491">
                                       <a:s>unit</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>}</a:s>
                     </a:s>
                     <a:s> &#xd;
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="495" xsi:type="Case">
            <caseItem localId="432">
               <when localId="412" name="IsPatch" xsi:type="FunctionRef">
                  <operand localId="411" name="doseFormCode" xsi:type="OperandRef"/>
               </when>
               <then localId="431" xsi:type="If">
                  <condition asType="t:Boolean" xsi:type="As">
                     <operand localId="419" xsi:type="In">
                        <operand localId="415" xsi:type="ToInteger">
                           <operand localId="414" path="code" xsi:type="Property">
                              <source localId="413" name="ingredientCode" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="418" xsi:type="List">
                           <element localId="416" valueType="t:Integer" value="1819" xsi:type="Literal"/>
                           <element localId="417" valueType="t:Integer" value="4337" xsi:type="Literal"/>
                        </operand>
                     </operand>
                  </condition>
                  <then localId="429" classType="t:Quantity" xsi:type="Instance">
                     <element name="value">
                        <value localId="426" xsi:type="Multiply">
                           <operand localId="423" xsi:type="Multiply">
                              <operand localId="420" name="dosesPerDay" xsi:type="OperandRef"/>
                              <operand localId="422" path="value" xsi:type="Property">
                                 <source localId="421" name="doseQuantity" xsi:type="OperandRef"/>
                              </operand>
                           </operand>
                           <operand localId="425" path="value" xsi:type="Property">
                              <source localId="424" name="strength" xsi:type="OperandRef"/>
                           </operand>
                        </value>
                     </element>
                     <element name="unit">
                        <value localId="428" path="unit" xsi:type="Property">
                           <source localId="427" name="strength" xsi:type="OperandRef"/>
                        </value>
                     </element>
                  </then>
                  <else asType="t:Quantity" xsi:type="As">
                     <operand localId="430" xsi:type="Null"/>
                  </else>
               </then>
            </caseItem>
            <caseItem localId="446">
               <when localId="438" xsi:type="In">
                  <operand localId="434" path="unit" xsi:type="Property">
                     <source localId="433" name="doseQuantity" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="437" xsi:type="List">
                     <element localId="435" valueType="t:String" value="mg" xsi:type="Literal"/>
                     <element localId="436" valueType="t:String" value="mcg" xsi:type="Literal"/>
                  </operand>
               </when>
               <then localId="445" classType="t:Quantity" xsi:type="Instance">
                  <element name="value">
                     <value localId="442" xsi:type="Multiply">
                        <operand localId="439" name="dosesPerDay" xsi:type="OperandRef"/>
                        <operand localId="441" path="value" xsi:type="Property">
                           <source localId="440" name="doseQuantity" xsi:type="OperandRef"/>
                        </operand>
                     </value>
                  </element>
                  <element name="unit">
                     <value localId="444" path="unit" xsi:type="Property">
                        <source localId="443" name="doseQuantity" xsi:type="OperandRef"/>
                     </value>
                  </element>
               </then>
            </caseItem>
            <caseItem localId="478">
               <when localId="461" xsi:type="And">
                  <operand localId="450" xsi:type="Equal">
                     <operand localId="448" path="unit" xsi:type="Property">
                        <source localId="447" name="doseQuantity" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="449" valueType="t:String" value="mL" xsi:type="Literal"/>
                  </operand>
                  <operand localId="460" xsi:type="Equal">
                     <operand localId="454" xsi:type="PositionOf">
                        <pattern localId="451" valueType="t:String" value="/mL" xsi:type="Literal"/>
                        <string localId="453" path="unit" xsi:type="Property">
                           <source localId="452" name="strength" xsi:type="OperandRef"/>
                        </string>
                     </operand>
                     <operand localId="459" xsi:type="Subtract">
                        <operand localId="457" xsi:type="Length">
                           <operand localId="456" path="unit" xsi:type="Property">
                              <source localId="455" name="strength" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="458" valueType="t:Integer" value="3" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </when>
               <then localId="477" classType="t:Quantity" xsi:type="Instance">
                  <element name="value">
                     <value localId="468" xsi:type="Multiply">
                        <operand localId="465" xsi:type="Multiply">
                           <operand localId="462" name="dosesPerDay" xsi:type="OperandRef"/>
                           <operand localId="464" path="value" xsi:type="Property">
                              <source localId="463" name="doseQuantity" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="467" path="value" xsi:type="Property">
                           <source localId="466" name="strength" xsi:type="OperandRef"/>
                        </operand>
                     </value>
                  </element>
                  <element name="unit">
                     <value localId="476" xsi:type="Substring">
                        <stringToSub localId="470" path="unit" xsi:type="Property">
                           <source localId="469" name="strength" xsi:type="OperandRef"/>
                        </stringToSub>
                        <startIndex localId="471" valueType="t:Integer" value="0" xsi:type="Literal"/>
                        <length localId="475" xsi:type="PositionOf">
                           <pattern localId="472" valueType="t:String" value="/" xsi:type="Literal"/>
                           <string localId="474" path="unit" xsi:type="Property">
                              <source localId="473" name="strength" xsi:type="OperandRef"/>
                           </string>
                        </length>
                     </value>
                  </element>
               </then>
            </caseItem>
            <else localId="494" classType="t:Quantity" xsi:type="Instance">
               <element name="value">
                  <value localId="485" xsi:type="Multiply">
                     <operand localId="482" xsi:type="Multiply">
                        <operand localId="479" name="dosesPerDay" xsi:type="OperandRef"/>
                        <operand localId="481" path="value" xsi:type="Property">
                           <source localId="480" name="doseQuantity" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                     <operand localId="484" path="value" xsi:type="Property">
                        <source localId="483" name="strength" xsi:type="OperandRef"/>
                     </operand>
                  </value>
               </element>
               <element name="unit">
                  <value localId="493" xsi:type="Substring">
                     <stringToSub localId="487" path="unit" xsi:type="Property">
                        <source localId="486" name="strength" xsi:type="OperandRef"/>
                     </stringToSub>
                     <startIndex localId="488" valueType="t:Integer" value="0" xsi:type="Literal"/>
                     <length localId="492" xsi:type="PositionOf">
                        <pattern localId="489" valueType="t:String" value="/" xsi:type="Literal"/>
                        <string localId="491" path="unit" xsi:type="Property">
                           <source localId="490" name="strength" xsi:type="OperandRef"/>
                        </string>
                     </length>
                  </value>
               </element>
            </else>
         </expression>
         <operand name="ingredientCode">
            <operandTypeSpecifier localId="406" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="strength">
            <operandTypeSpecifier localId="407" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="doseFormCode">
            <operandTypeSpecifier localId="408" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="doseQuantity">
            <operandTypeSpecifier localId="409" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="dosesPerDay">
            <operandTypeSpecifier localId="410" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="517" name="GetMedicationName" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="517">
               <a:s>define function GetMedicationName(rxNormCode </a:s>
               <a:s r="497">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="516">
                  <a:s r="516">
                     <a:s>if </a:s>
                     <a:s r="500">
                        <a:s r="499">
                           <a:s r="498">
                              <a:s>rxNormCode</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="499">
                              <a:s>display</a:s>
                           </a:s>
                        </a:s>
                        <a:s> is null</a:s>
                     </a:s>
                     <a:s> then </a:s>
                     <a:s r="513">
                        <a:s>SingletonFrom(</a:s>
                        <a:s r="512">
                           <a:s>
                              <a:s r="502">
                                 <a:s r="501">
                                    <a:s>
                                       <a:s>OMTKData.DrugIngredients</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> DI</a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
      </a:s>
                           <a:s r="508">
                              <a:s>where </a:s>
                              <a:s r="508">
                                 <a:s r="504">
                                    <a:s r="503">
                                       <a:s>DI</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="504">
                                       <a:s>drugCode</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="507">
                                    <a:s>ToInteger(</a:s>
                                    <a:s r="506">
                                       <a:s r="505">
                                          <a:s>rxNormCode</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="506">
                                          <a:s>code</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
      </a:s>
                           <a:s r="511">
                              <a:s>return </a:s>
                              <a:s r="510">
                                 <a:s r="509">
                                    <a:s>DI</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="510">
                                    <a:s>drugName</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>&#xd;
  )</a:s>
                     </a:s>
                     <a:s>&#xd;
    else </a:s>
                     <a:s r="515">
                        <a:s r="514">
                           <a:s>rxNormCode</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="515">
                           <a:s>display</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="516" xsi:type="If">
            <condition asType="t:Boolean" xsi:type="As">
               <operand localId="500" xsi:type="IsNull">
                  <operand localId="499" path="display" xsi:type="Property">
                     <source localId="498" name="rxNormCode" xsi:type="OperandRef"/>
                  </operand>
               </operand>
            </condition>
            <then localId="513" xsi:type="SingletonFrom">
               <operand localId="512" xsi:type="Query">
                  <source localId="502" alias="DI">
                     <expression localId="501" name="DrugIngredients" libraryName="OMTKData" xsi:type="ExpressionRef"/>
                  </source>
                  <where localId="508" xsi:type="Equal">
                     <operand localId="504" path="drugCode" scope="DI" xsi:type="Property"/>
                     <operand localId="507" xsi:type="ToInteger">
                        <operand localId="506" path="code" xsi:type="Property">
                           <source localId="505" name="rxNormCode" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </where>
                  <return localId="511">
                     <expression localId="510" path="drugName" scope="DI" xsi:type="Property"/>
                  </return>
               </operand>
            </then>
            <else localId="515" path="display" xsi:type="Property">
               <source localId="514" name="rxNormCode" xsi:type="OperandRef"/>
            </else>
         </expression>
         <operand name="rxNormCode">
            <operandTypeSpecifier localId="497" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="608" name="GetDailyDoseDescription" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="608">
               <a:s>define function GetDailyDoseDescription(ingredientCode </a:s>
               <a:s r="518">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>, ingredientName </a:s>
               <a:s r="519">
                  <a:s>String</a:s>
               </a:s>
               <a:s>, strength </a:s>
               <a:s r="520">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>, doseFormCode </a:s>
               <a:s r="521">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>, doseFormName </a:s>
               <a:s r="522">
                  <a:s>String</a:s>
               </a:s>
               <a:s>, doseQuantity </a:s>
               <a:s r="523">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>, dosesPerDay </a:s>
               <a:s r="524">
                  <a:s>Decimal</a:s>
               </a:s>
               <a:s>, dailyDose </a:s>
               <a:s r="525">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="607">
                  <a:s r="607">
                     <a:s>case&#xd;
    /* if patch */&#xd;
    </a:s>
                     <a:s r="554">
                        <a:s>when </a:s>
                        <a:s r="527">
                           <a:s>IsPatch(</a:s>
                           <a:s r="526">
                              <a:s>doseFormCode</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s>then&#xd;
      /* buprenorphine or fentanyl patch */ </a:s>
                        <a:s r="553">
                           <a:s>if </a:s>
                           <a:s r="534">
                              <a:s r="530">
                                 <a:s>ToInteger(</a:s>
                                 <a:s r="529">
                                    <a:s r="528">
                                       <a:s>ingredientCode</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="529">
                                       <a:s>code</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>in </a:s>
                              <a:s r="533">
                                 <a:s r="531">{ 1819, 4337 }</a:s>
                              </a:s>
                           </a:s>
                           <a:s> then </a:s>
                           <a:s r="551">
                              <a:s r="548">
                                 <a:s r="546">
                                    <a:s r="543">
                                       <a:s r="541">
                                          <a:s r="537">
                                             <a:s r="535">
                                                <a:s>ingredientName</a:s>
                                             </a:s>
                                             <a:s> + </a:s>
                                             <a:s r="536">
                                                <a:s>' patch: '</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> + </a:s>
                                          <a:s r="540">
                                             <a:s>ToString(</a:s>
                                             <a:s r="539">
                                                <a:s r="538">
                                                   <a:s>doseQuantity</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="539">
                                                   <a:s>value</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>+ </a:s>
                                       <a:s r="542">
                                          <a:s>' * '</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> + </a:s>
                                    <a:s r="545">
                                       <a:s>ToString(</a:s>
                                       <a:s r="544">
                                          <a:s>strength</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>+ </a:s>
                                 <a:s r="547">
                                    <a:s>' = '</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> + </a:s>
                              <a:s r="550">
                                 <a:s>ToString(</a:s>
                                 <a:s r="549">
                                    <a:s>dailyDose</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="552">&#xd;
      else null</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
&#xd;
    /* if dose unit in actual mass units (mg or mcg -- when it's a single med) */&#xd;
    </a:s>
                     <a:s r="581">
                        <a:s>when </a:s>
                        <a:s r="560">
                           <a:s r="556">
                              <a:s r="555">
                                 <a:s>doseQuantity</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="556">
                                 <a:s>unit</a:s>
                              </a:s>
                           </a:s>
                           <a:s> in </a:s>
                           <a:s r="559">
                              <a:s>{ </a:s>
                              <a:s r="557">
                                 <a:s>'mg'</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="558">
                                 <a:s>'mcg'</a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="580">
                           <a:s r="577">
                              <a:s r="575">
                                 <a:s r="572">
                                    <a:s r="570">
                                       <a:s r="567">
                                          <a:s r="565">
                                             <a:s r="563">
                                                <a:s r="561">
                                                   <a:s>ingredientName</a:s>
                                                </a:s>
                                                <a:s> + </a:s>
                                                <a:s r="562">
                                                   <a:s>' '</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> + </a:s>
                                             <a:s r="564">
                                                <a:s>doseFormName</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> + </a:s>
                                          <a:s r="566">
                                             <a:s>': '</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> + </a:s>
                                       <a:s r="569">
                                          <a:s>ToString(</a:s>
                                          <a:s r="568">
                                             <a:s>dosesPerDay</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>+ </a:s>
                                    <a:s r="571">
                                       <a:s>'/d * '</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> + </a:s>
                                 <a:s r="574">
                                    <a:s>ToString(</a:s>
                                    <a:s r="573">
                                       <a:s>doseQuantity</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>+ </a:s>
                              <a:s r="576">
                                 <a:s>' = '</a:s>
                              </a:s>
                           </a:s>
                           <a:s> + </a:s>
                           <a:s r="579">
                              <a:s>ToString(</a:s>
                              <a:s r="578">
                                 <a:s>dailyDose</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
&#xd;
    /* if doseQuantity in actual volume units (mL) or not in actual units (e.g. 1 tab, 1 spray) */&#xd;
    else </a:s>
                     <a:s r="606">
                        <a:s r="603">
                           <a:s r="601">
                              <a:s r="598">
                                 <a:s r="596">
                                    <a:s r="593">
                                       <a:s r="591">
                                          <a:s r="588">
                                             <a:s r="586">
                                                <a:s r="584">
                                                   <a:s r="582">
                                                      <a:s>ingredientName</a:s>
                                                   </a:s>
                                                   <a:s> + </a:s>
                                                   <a:s r="583">
                                                      <a:s>' '</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> + </a:s>
                                                <a:s r="585">
                                                   <a:s>doseFormName</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> + </a:s>
                                             <a:s r="587">
                                                <a:s>': '</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> + </a:s>
                                          <a:s r="590">
                                             <a:s>ToString(</a:s>
                                             <a:s r="589">
                                                <a:s>dosesPerDay</a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>+ </a:s>
                                       <a:s r="592">
                                          <a:s>'/d * '</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> + </a:s>
                                    <a:s r="595">
                                       <a:s>ToString(</a:s>
                                       <a:s r="594">
                                          <a:s>doseQuantity</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>+ </a:s>
                                 <a:s r="597">
                                    <a:s>' * '</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> + </a:s>
                              <a:s r="600">
                                 <a:s>ToString(</a:s>
                                 <a:s r="599">
                                    <a:s>strength</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s>+ </a:s>
                           <a:s r="602">
                              <a:s>' = '</a:s>
                           </a:s>
                        </a:s>
                        <a:s> + </a:s>
                        <a:s r="605">
                           <a:s>ToString(</a:s>
                           <a:s r="604">
                              <a:s>dailyDose</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="607" xsi:type="Case">
            <caseItem localId="554">
               <when localId="527" name="IsPatch" xsi:type="FunctionRef">
                  <operand localId="526" name="doseFormCode" xsi:type="OperandRef"/>
               </when>
               <then localId="553" xsi:type="If">
                  <condition asType="t:Boolean" xsi:type="As">
                     <operand localId="534" xsi:type="In">
                        <operand localId="530" xsi:type="ToInteger">
                           <operand localId="529" path="code" xsi:type="Property">
                              <source localId="528" name="ingredientCode" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="533" xsi:type="List">
                           <element localId="531" valueType="t:Integer" value="1819" xsi:type="Literal"/>
                           <element localId="532" valueType="t:Integer" value="4337" xsi:type="Literal"/>
                        </operand>
                     </operand>
                  </condition>
                  <then localId="551" xsi:type="Concatenate">
                     <operand localId="548" xsi:type="Concatenate">
                        <operand localId="546" xsi:type="Concatenate">
                           <operand localId="543" xsi:type="Concatenate">
                              <operand localId="541" xsi:type="Concatenate">
                                 <operand localId="537" xsi:type="Concatenate">
                                    <operand localId="535" name="ingredientName" xsi:type="OperandRef"/>
                                    <operand localId="536" valueType="t:String" value=" patch: " xsi:type="Literal"/>
                                 </operand>
                                 <operand localId="540" xsi:type="ToString">
                                    <operand localId="539" path="value" xsi:type="Property">
                                       <source localId="538" name="doseQuantity" xsi:type="OperandRef"/>
                                    </operand>
                                 </operand>
                              </operand>
                              <operand localId="542" valueType="t:String" value=" * " xsi:type="Literal"/>
                           </operand>
                           <operand localId="545" xsi:type="ToString">
                              <operand localId="544" name="strength" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="547" valueType="t:String" value=" = " xsi:type="Literal"/>
                     </operand>
                     <operand localId="550" xsi:type="ToString">
                        <operand localId="549" name="dailyDose" xsi:type="OperandRef"/>
                     </operand>
                  </then>
                  <else asType="t:String" xsi:type="As">
                     <operand localId="552" xsi:type="Null"/>
                  </else>
               </then>
            </caseItem>
            <caseItem localId="581">
               <when localId="560" xsi:type="In">
                  <operand localId="556" path="unit" xsi:type="Property">
                     <source localId="555" name="doseQuantity" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="559" xsi:type="List">
                     <element localId="557" valueType="t:String" value="mg" xsi:type="Literal"/>
                     <element localId="558" valueType="t:String" value="mcg" xsi:type="Literal"/>
                  </operand>
               </when>
               <then localId="580" xsi:type="Concatenate">
                  <operand localId="577" xsi:type="Concatenate">
                     <operand localId="575" xsi:type="Concatenate">
                        <operand localId="572" xsi:type="Concatenate">
                           <operand localId="570" xsi:type="Concatenate">
                              <operand localId="567" xsi:type="Concatenate">
                                 <operand localId="565" xsi:type="Concatenate">
                                    <operand localId="563" xsi:type="Concatenate">
                                       <operand localId="561" name="ingredientName" xsi:type="OperandRef"/>
                                       <operand localId="562" valueType="t:String" value=" " xsi:type="Literal"/>
                                    </operand>
                                    <operand localId="564" name="doseFormName" xsi:type="OperandRef"/>
                                 </operand>
                                 <operand localId="566" valueType="t:String" value=": " xsi:type="Literal"/>
                              </operand>
                              <operand localId="569" xsi:type="ToString">
                                 <operand localId="568" name="dosesPerDay" xsi:type="OperandRef"/>
                              </operand>
                           </operand>
                           <operand localId="571" valueType="t:String" value="/d * " xsi:type="Literal"/>
                        </operand>
                        <operand localId="574" xsi:type="ToString">
                           <operand localId="573" name="doseQuantity" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                     <operand localId="576" valueType="t:String" value=" = " xsi:type="Literal"/>
                  </operand>
                  <operand localId="579" xsi:type="ToString">
                     <operand localId="578" name="dailyDose" xsi:type="OperandRef"/>
                  </operand>
               </then>
            </caseItem>
            <else localId="606" xsi:type="Concatenate">
               <operand localId="603" xsi:type="Concatenate">
                  <operand localId="601" xsi:type="Concatenate">
                     <operand localId="598" xsi:type="Concatenate">
                        <operand localId="596" xsi:type="Concatenate">
                           <operand localId="593" xsi:type="Concatenate">
                              <operand localId="591" xsi:type="Concatenate">
                                 <operand localId="588" xsi:type="Concatenate">
                                    <operand localId="586" xsi:type="Concatenate">
                                       <operand localId="584" xsi:type="Concatenate">
                                          <operand localId="582" name="ingredientName" xsi:type="OperandRef"/>
                                          <operand localId="583" valueType="t:String" value=" " xsi:type="Literal"/>
                                       </operand>
                                       <operand localId="585" name="doseFormName" xsi:type="OperandRef"/>
                                    </operand>
                                    <operand localId="587" valueType="t:String" value=": " xsi:type="Literal"/>
                                 </operand>
                                 <operand localId="590" xsi:type="ToString">
                                    <operand localId="589" name="dosesPerDay" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                              <operand localId="592" valueType="t:String" value="/d * " xsi:type="Literal"/>
                           </operand>
                           <operand localId="595" xsi:type="ToString">
                              <operand localId="594" name="doseQuantity" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="597" valueType="t:String" value=" * " xsi:type="Literal"/>
                     </operand>
                     <operand localId="600" xsi:type="ToString">
                        <operand localId="599" name="strength" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
                  <operand localId="602" valueType="t:String" value=" = " xsi:type="Literal"/>
               </operand>
               <operand localId="605" xsi:type="ToString">
                  <operand localId="604" name="dailyDose" xsi:type="OperandRef"/>
               </operand>
            </else>
         </expression>
         <operand name="ingredientCode">
            <operandTypeSpecifier localId="518" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="ingredientName">
            <operandTypeSpecifier localId="519" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="strength">
            <operandTypeSpecifier localId="520" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="doseFormCode">
            <operandTypeSpecifier localId="521" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="doseFormName">
            <operandTypeSpecifier localId="522" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="doseQuantity">
            <operandTypeSpecifier localId="523" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="dosesPerDay">
            <operandTypeSpecifier localId="524" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="dailyDose">
            <operandTypeSpecifier localId="525" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="692" name="CalculateMMEs" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="692">
               <a:s>define function CalculateMMEs(medications </a:s>
               <a:s r="616">
                  <a:s>List&lt;</a:s>
                  <a:s r="615">
                     <a:s>Tuple {&#xd;
  </a:s>
                     <a:s r="610">
                        <a:s>rxNormCode </a:s>
                        <a:s r="609">
                           <a:s>Code</a:s>
                        </a:s>
                     </a:s>
                     <a:s>,&#xd;
  </a:s>
                     <a:s r="612">
                        <a:s>doseQuantity </a:s>
                        <a:s r="611">
                           <a:s>Quantity</a:s>
                        </a:s>
                     </a:s>
                     <a:s>,&#xd;
  </a:s>
                     <a:s r="614">
                        <a:s>dosesPerDay </a:s>
                        <a:s r="613">
                           <a:s>Decimal</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
}</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="691">
                  <a:s r="691">
                     <a:s>Flatten(</a:s>
                     <a:s r="690">
                        <a:s>
                           <a:s r="618">
                              <a:s r="617">
                                 <a:s>
                                    <a:s>medications</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> M</a:s>
                           </a:s>
                        </a:s>
                        <a:s>&#xd;
      </a:s>
                        <a:s>
                           <a:s>let </a:s>
                           <a:s r="622">
                              <a:s>Ingredients: </a:s>
                              <a:s r="621">
                                 <a:s>GetIngredients(</a:s>
                                 <a:s r="620">
                                    <a:s r="619">
                                       <a:s>M</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="620">
                                       <a:s>rxNormCode</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>&#xd;
      </a:s>
                        <a:s r="689">
                           <a:s>return </a:s>
                           <a:s r="688">
                              <a:s>
                                 <a:s r="624">
                                    <a:s r="623">
                                       <a:s>
                                          <a:s>Ingredients</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> I</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>&#xd;
        </a:s>
                              <a:s>
                                 <a:s>let </a:s>
                                 <a:s r="628">
                                    <a:s>adjustedDoseQuantity: </a:s>
                                    <a:s r="627">
                                       <a:s>EnsureMicrogramQuantity(</a:s>
                                       <a:s r="626">
                                          <a:s r="625">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="626">
                                             <a:s>doseQuantity</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>,&#xd;
        </a:s>
                                 <a:s r="639">
                                    <a:s>dailyDose: </a:s>
                                    <a:s r="638">
                                       <a:s>GetDailyDose(</a:s>
                                       <a:s r="630">
                                          <a:s r="629">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="630">
                                             <a:s>ingredientCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="632">
                                          <a:s r="631">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="632">
                                             <a:s>strength</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="634">
                                          <a:s r="633">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="634">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="635">
                                          <a:s>adjustedDoseQuantity</a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="637">
                                          <a:s r="636">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="637">
                                             <a:s>dosesPerDay</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>,&#xd;
        </a:s>
                                 <a:s r="646">
                                    <a:s>factor: </a:s>
                                    <a:s r="645">
                                       <a:s>GetConversionFactor(</a:s>
                                       <a:s r="641">
                                          <a:s r="640">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="641">
                                             <a:s>ingredientCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="642">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="644">
                                          <a:s r="643">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="644">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>&#xd;
        </a:s>
                              <a:s r="687">
                                 <a:s>return </a:s>
                                 <a:s r="686">
                                    <a:s>{&#xd;
          </a:s>
                                    <a:s>
                                       <a:s>rxNormCode: </a:s>
                                       <a:s r="648">
                                          <a:s r="647">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="648">
                                             <a:s>rxNormCode</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,&#xd;
          </a:s>
                                    <a:s>
                                       <a:s>doseFormCode: </a:s>
                                       <a:s r="650">
                                          <a:s r="649">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="650">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,&#xd;
          </a:s>
                                    <a:s>
                                       <a:s>doseQuantity: </a:s>
                                       <a:s r="651">
                                          <a:s>adjustedDoseQuantity</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,&#xd;
          </a:s>
                                    <a:s>
                                       <a:s>dosesPerDay: </a:s>
                                       <a:s r="653">
                                          <a:s r="652">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="653">
                                             <a:s>dosesPerDay</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,&#xd;
          </a:s>
                                    <a:s>
                                       <a:s>ingredientCode: </a:s>
                                       <a:s r="655">
                                          <a:s r="654">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="655">
                                             <a:s>ingredientCode</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,&#xd;
          </a:s>
                                    <a:s>
                                       <a:s>ingredientName: </a:s>
                                       <a:s r="657">
                                          <a:s r="656">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="657">
                                             <a:s>ingredientName</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,&#xd;
          </a:s>
                                    <a:s>
                                       <a:s>strength: </a:s>
                                       <a:s r="659">
                                          <a:s r="658">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="659">
                                             <a:s>strength</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,&#xd;
          </a:s>
                                    <a:s>
                                       <a:s>dailyDose: </a:s>
                                       <a:s r="660">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,&#xd;
          </a:s>
                                    <a:s>
                                       <a:s>dailyDoseDescription: </a:s>
                                       <a:s r="675">
                                          <a:s>GetDailyDoseDescription(</a:s>
                                          <a:s r="662">
                                             <a:s r="661">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="662">
                                                <a:s>ingredientCode</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="664">
                                             <a:s r="663">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="664">
                                                <a:s>ingredientName</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="666">
                                             <a:s r="665">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="666">
                                                <a:s>strength</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="668">
                                             <a:s r="667">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="668">
                                                <a:s>doseFormCode</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="670">
                                             <a:s r="669">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="670">
                                                <a:s>doseFormName</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="671">
                                             <a:s>adjustedDoseQuantity</a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="673">
                                             <a:s r="672">
                                                <a:s>M</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="673">
                                                <a:s>dosesPerDay</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="674">
                                             <a:s>dailyDose</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,&#xd;
          </a:s>
                                    <a:s>
                                       <a:s>conversionFactor: </a:s>
                                       <a:s r="676">
                                          <a:s>factor</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,&#xd;
          </a:s>
                                    <a:s>
                                       <a:s>mme: </a:s>
                                       <a:s r="685">
                                          <a:s>Quantity { </a:s>
                                          <a:s>
                                             <a:s>value: </a:s>
                                             <a:s r="680">
                                                <a:s r="678">
                                                   <a:s r="677">
                                                      <a:s>dailyDose</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="678">
                                                      <a:s>value</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> * </a:s>
                                                <a:s r="679">
                                                   <a:s>factor</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s>
                                             <a:s>unit: </a:s>
                                             <a:s r="684">
                                                <a:s r="682">
                                                   <a:s r="681">
                                                      <a:s>dailyDose</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="682">
                                                      <a:s>unit</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> + </a:s>
                                                <a:s r="683">
                                                   <a:s>'/d'</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> }</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>&#xd;
        }</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
  )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="691" xsi:type="Flatten">
            <operand localId="690" xsi:type="Query">
               <source localId="618" alias="M">
                  <expression localId="617" name="medications" xsi:type="OperandRef"/>
               </source>
               <let localId="622" identifier="Ingredients">
                  <expression localId="621" name="GetIngredients" xsi:type="FunctionRef">
                     <operand localId="620" path="rxNormCode" scope="M" xsi:type="Property"/>
                  </expression>
               </let>
               <return localId="689">
                  <expression localId="688" xsi:type="Query">
                     <source localId="624" alias="I">
                        <expression localId="623" name="Ingredients" xsi:type="QueryLetRef"/>
                     </source>
                     <let localId="628" identifier="adjustedDoseQuantity">
                        <expression localId="627" name="EnsureMicrogramQuantity" xsi:type="FunctionRef">
                           <operand localId="626" path="doseQuantity" scope="M" xsi:type="Property"/>
                        </expression>
                     </let>
                     <let localId="639" identifier="dailyDose">
                        <expression localId="638" name="GetDailyDose" xsi:type="FunctionRef">
                           <operand localId="630" path="ingredientCode" scope="I" xsi:type="Property"/>
                           <operand localId="632" path="strength" scope="I" xsi:type="Property"/>
                           <operand localId="634" path="doseFormCode" scope="I" xsi:type="Property"/>
                           <operand localId="635" name="adjustedDoseQuantity" xsi:type="QueryLetRef"/>
                           <operand localId="637" path="dosesPerDay" scope="M" xsi:type="Property"/>
                        </expression>
                     </let>
                     <let localId="646" identifier="factor">
                        <expression localId="645" name="GetConversionFactor" xsi:type="FunctionRef">
                           <operand localId="641" path="ingredientCode" scope="I" xsi:type="Property"/>
                           <operand localId="642" name="dailyDose" xsi:type="QueryLetRef"/>
                           <operand localId="644" path="doseFormCode" scope="I" xsi:type="Property"/>
                        </expression>
                     </let>
                     <return localId="687">
                        <expression localId="686" xsi:type="Tuple">
                           <element name="rxNormCode">
                              <value localId="648" path="rxNormCode" scope="M" xsi:type="Property"/>
                           </element>
                           <element name="doseFormCode">
                              <value localId="650" path="doseFormCode" scope="I" xsi:type="Property"/>
                           </element>
                           <element name="doseQuantity">
                              <value localId="651" name="adjustedDoseQuantity" xsi:type="QueryLetRef"/>
                           </element>
                           <element name="dosesPerDay">
                              <value localId="653" path="dosesPerDay" scope="M" xsi:type="Property"/>
                           </element>
                           <element name="ingredientCode">
                              <value localId="655" path="ingredientCode" scope="I" xsi:type="Property"/>
                           </element>
                           <element name="ingredientName">
                              <value localId="657" path="ingredientName" scope="I" xsi:type="Property"/>
                           </element>
                           <element name="strength">
                              <value localId="659" path="strength" scope="I" xsi:type="Property"/>
                           </element>
                           <element name="dailyDose">
                              <value localId="660" name="dailyDose" xsi:type="QueryLetRef"/>
                           </element>
                           <element name="dailyDoseDescription">
                              <value localId="675" name="GetDailyDoseDescription" xsi:type="FunctionRef">
                                 <operand localId="662" path="ingredientCode" scope="I" xsi:type="Property"/>
                                 <operand localId="664" path="ingredientName" scope="I" xsi:type="Property"/>
                                 <operand localId="666" path="strength" scope="I" xsi:type="Property"/>
                                 <operand localId="668" path="doseFormCode" scope="I" xsi:type="Property"/>
                                 <operand localId="670" path="doseFormName" scope="I" xsi:type="Property"/>
                                 <operand localId="671" name="adjustedDoseQuantity" xsi:type="QueryLetRef"/>
                                 <operand localId="673" path="dosesPerDay" scope="M" xsi:type="Property"/>
                                 <operand localId="674" name="dailyDose" xsi:type="QueryLetRef"/>
                              </value>
                           </element>
                           <element name="conversionFactor">
                              <value localId="676" name="factor" xsi:type="QueryLetRef"/>
                           </element>
                           <element name="mme">
                              <value localId="685" classType="t:Quantity" xsi:type="Instance">
                                 <element name="value">
                                    <value localId="680" xsi:type="Multiply">
                                       <operand localId="678" path="value" xsi:type="Property">
                                          <source localId="677" name="dailyDose" xsi:type="QueryLetRef"/>
                                       </operand>
                                       <operand localId="679" name="factor" xsi:type="QueryLetRef"/>
                                    </value>
                                 </element>
                                 <element name="unit">
                                    <value localId="684" xsi:type="Concatenate">
                                       <operand localId="682" path="unit" xsi:type="Property">
                                          <source localId="681" name="dailyDose" xsi:type="QueryLetRef"/>
                                       </operand>
                                       <operand localId="683" valueType="t:String" value="/d" xsi:type="Literal"/>
                                    </value>
                                 </element>
                              </value>
                           </element>
                        </expression>
                     </return>
                  </expression>
               </return>
            </operand>
         </expression>
         <operand name="medications">
            <operandTypeSpecifier localId="616" xsi:type="ListTypeSpecifier">
               <elementType localId="615" xsi:type="TupleTypeSpecifier">
                  <element localId="610" name="rxNormCode">
                     <elementType localId="609" name="t:Code" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="612" name="doseQuantity">
                     <elementType localId="611" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="614" name="dosesPerDay">
                     <elementType localId="613" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  </element>
               </elementType>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="702" name="TestCalculateMMEs" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="702">
               <a:s>define TestCalculateMMEs:&#xd;
  </a:s>
               <a:s r="701">
                  <a:s>CalculateMMEs(</a:s>
                  <a:s r="700">
                     <a:s>{ </a:s>
                     <a:s r="699">
                        <a:s>{&#xd;
      </a:s>
                        <a:s>
                           <a:s>rxNormCode: </a:s>
                           <a:s r="694">
                              <a:s>Code '388508' from </a:s>
                              <a:s r="693">
                                 <a:s>RxNorm</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s>
                           <a:s>doseQuantity: </a:s>
                           <a:s r="697">
                              <a:s>Quantity { </a:s>
                              <a:s>
                                 <a:s r="695">value: 1</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s>
                                 <a:s>unit: </a:s>
                                 <a:s r="696">
                                    <a:s>'patch'</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s>
                           <a:s r="698">dosesPerDay: 0.33</a:s>
                        </a:s>
                        <a:s>&#xd;
    }</a:s>
                     </a:s>
                     <a:s> }</a:s>
                  </a:s>
                  <a:s>&#xd;
  )</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="701" name="CalculateMMEs" xsi:type="FunctionRef">
            <operand localId="700" xsi:type="List">
               <element localId="699" xsi:type="Tuple">
                  <element name="rxNormCode">
                     <value localId="694" code="388508" xsi:type="Code">
                        <system localId="693" name="RxNorm"/>
                     </value>
                  </element>
                  <element name="doseQuantity">
                     <value localId="697" classType="t:Quantity" xsi:type="Instance">
                        <element name="value">
                           <value xsi:type="ToDecimal">
                              <operand localId="695" valueType="t:Integer" value="1" xsi:type="Literal"/>
                           </value>
                        </element>
                        <element name="unit">
                           <value localId="696" valueType="t:String" value="patch" xsi:type="Literal"/>
                        </element>
                     </value>
                  </element>
                  <element name="dosesPerDay">
                     <value localId="698" valueType="t:Decimal" value="0.33" xsi:type="Literal"/>
                  </element>
               </element>
            </operand>
         </expression>
      </def>
   </statements>
</library>
