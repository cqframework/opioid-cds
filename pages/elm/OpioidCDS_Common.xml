<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation startLine="80" startChar="7" endLine="80" endChar="54" message="Could not resolve membership operator for terminology target of the retrieve." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation startLine="114" startChar="7" endLine="114" endChar="63" message="Could not resolve code path code for the type of the retrieve FHIR.MedicationAdministration." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation startLine="114" startChar="7" endLine="114" endChar="63" message="Could not resolve membership operator for terminology target of the retrieve." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation startLine="119" startChar="7" endLine="119" endChar="57" message="Could not resolve code path code for the type of the retrieve FHIR.MedicationDispense." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation startLine="119" startChar="7" endLine="119" endChar="57" message="Could not resolve membership operator for terminology target of the retrieve." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation startLine="124" startChar="7" endLine="124" endChar="56" message="Could not resolve code path code for the type of the retrieve FHIR.MedicationRequest." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation startLine="124" startChar="7" endLine="124" endChar="56" message="Could not resolve membership operator for terminology target of the retrieve." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation startLine="129" startChar="7" endLine="129" endChar="58" message="Could not resolve code path code for the type of the retrieve FHIR.MedicationStatement." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation startLine="129" startChar="7" endLine="129" endChar="58" message="Could not resolve membership operator for terminology target of the retrieve." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <identifier id="OpioidCDS_STU3_Common" version="0.1.0"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="3.0.0"/>
   </usings>
   <includes>
      <def localId="2" localIdentifier="FHIRHelpers" path="FHIRHelpers" version="3.0.0"/>
      <def localId="3" localIdentifier="OMTKLogic" path="OMTKLogic" version="0.0.1"/>
   </includes>
   <codeSystems>
      <def localId="4" name="SNOMED" id="http://snomed.info/sct" accessLevel="Public"/>
      <def localId="5" name="Medication Request Category Codes" id="http://hl7.org/fhir/medication-request-category" accessLevel="Public"/>
   </codeSystems>
   <valueSets>
      <def localId="6" name="Benzodiazepines" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/benzodiazepines" accessLevel="Public"/>
      <def localId="7" name="End of Life Conditions" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/end-of-life-conditions" accessLevel="Public"/>
      <def localId="8" name="Hospice Disposition" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/hospice-disposition" accessLevel="Public"/>
      <def localId="9" name="Hospice Finding Codes" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/hospice-finding" accessLevel="Public"/>
      <def localId="10" name="Hospice Procedure Codes" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/hospice-procedure" accessLevel="Public"/>
      <def localId="11" name="Illicit Drug Screening" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/illicit-drug-urine-screening" accessLevel="Public"/>
      <def localId="12" name="Limited Life Expectancy Conditions" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/limited-life-expectancy-conditions" accessLevel="Public"/>
      <def localId="13" name="Long Acting Opioids" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/long-acting-opioids" accessLevel="Public"/>
      <def localId="14" name="Naloxone" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/naloxone" accessLevel="Public"/>
      <def localId="15" name="Risk Assessment" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/opioid-abuse-assessment" accessLevel="Public"/>
      <def localId="16" name="Opioid Drug Screening" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/opioid-urine-screening" accessLevel="Public"/>
      <def localId="17" name="Ambulatory Abuse Potential Opioids" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/opioids-abused-in-ambulatory-care" accessLevel="Public"/>
      <def localId="18" name="End Of Life Opioids" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/opioids-indicating-end-of-life" accessLevel="Public"/>
      <def localId="19" name="Substance Abuse" id="http://fhir.org/guides/cdc/opioid-cds/ValueSet/substance-abuse" accessLevel="Public"/>
   </valueSets>
   <codes>
      <def localId="21" name="Referral to Hospice" id="306205009" accessLevel="Public">
         <codeSystem localId="20" name="SNOMED"/>
      </def>
      <def localId="23" name="Outpatient" id="outpatient" accessLevel="Public">
         <codeSystem localId="22" name="Medication Request Category Codes"/>
      </def>
   </codes>
   <statements>
      <def localId="25" name="IsForChronicPain" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="25">
               <a:s r="24">define IsForChronicPain: true</a:s>
            </a:s>
         </annotation>
         <expression localId="24" valueType="t:Boolean" value="true" xsi:type="Literal"/>
      </def>
      <def localId="55" name="ToCode" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="55">
               <a:s>define function ToCode(coding </a:s>
               <a:s r="41">
                  <a:s>FHIR.Coding</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="54">
                  <a:s r="54">
                     <a:s>System.Code {&#xd;
    </a:s>
                     <a:s>
                        <a:s>code: </a:s>
                        <a:s r="44">
                           <a:s r="43">
                              <a:s r="42">
                                 <a:s>coding</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="43">
                                 <a:s>code</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="44">
                              <a:s>value</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>,&#xd;
    </a:s>
                     <a:s>
                        <a:s>system: </a:s>
                        <a:s r="47">
                           <a:s r="46">
                              <a:s r="45">
                                 <a:s>coding</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="46">
                                 <a:s>system</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="47">
                              <a:s>value</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>,&#xd;
    </a:s>
                     <a:s>
                        <a:s>version: </a:s>
                        <a:s r="50">
                           <a:s r="49">
                              <a:s r="48">
                                 <a:s>coding</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="49">
                                 <a:s>version</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="50">
                              <a:s>value</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>,&#xd;
    </a:s>
                     <a:s>
                        <a:s>display: </a:s>
                        <a:s r="53">
                           <a:s r="52">
                              <a:s r="51">
                                 <a:s>coding</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="52">
                                 <a:s>display</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="53">
                              <a:s>value</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
  }</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="54" classType="t:Code" xsi:type="Instance">
            <element name="code">
               <value localId="44" path="value" xsi:type="Property">
                  <source localId="43" path="code" xsi:type="Property">
                     <source localId="42" name="coding" xsi:type="OperandRef"/>
                  </source>
               </value>
            </element>
            <element name="system">
               <value localId="47" path="value" xsi:type="Property">
                  <source localId="46" path="system" xsi:type="Property">
                     <source localId="45" name="coding" xsi:type="OperandRef"/>
                  </source>
               </value>
            </element>
            <element name="version">
               <value localId="50" path="value" xsi:type="Property">
                  <source localId="49" path="version" xsi:type="Property">
                     <source localId="48" name="coding" xsi:type="OperandRef"/>
                  </source>
               </value>
            </element>
            <element name="display">
               <value localId="53" path="value" xsi:type="Property">
                  <source localId="52" path="display" xsi:type="Property">
                     <source localId="51" name="coding" xsi:type="OperandRef"/>
                  </source>
               </value>
            </element>
         </expression>
         <operand name="coding">
            <operandTypeSpecifier localId="41" name="fhir:Coding" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="59" name="ToCodes" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="59">
               <a:s>define function ToCodes(coding </a:s>
               <a:s r="37">
                  <a:s>List&lt;</a:s>
                  <a:s r="36">
                     <a:s>FHIR.Coding</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="58">
                  <a:s r="58">
                     <a:s>
                        <a:s r="39">
                           <a:s r="38">
                              <a:s>
                                 <a:s>coding</a:s>
                              </a:s>
                           </a:s>
                           <a:s> c</a:s>
                        </a:s>
                     </a:s>
                     <a:s> </a:s>
                     <a:s r="57">
                        <a:s>return </a:s>
                        <a:s r="56">
                           <a:s>ToCode(</a:s>
                           <a:s r="40">
                              <a:s>c</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="58" xsi:type="Query">
            <source localId="39" alias="c">
               <expression localId="38" name="coding" xsi:type="OperandRef"/>
            </source>
            <return localId="57">
               <expression localId="56" name="ToCode" xsi:type="FunctionRef">
                  <operand localId="40" name="c" xsi:type="AliasRef"/>
               </expression>
            </return>
         </expression>
         <operand name="coding">
            <operandTypeSpecifier localId="37" xsi:type="ListTypeSpecifier">
               <elementType localId="36" name="fhir:Coding" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="65" name="Active Ambulatory Opioid Rx" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="65">
               <a:s>define &quot;Active Ambulatory Opioid Rx&quot;:&#xd;
  </a:s>
               <a:s r="64">
                  <a:s>
                     <a:s r="27">
                        <a:s r="26">
                           <a:s r="26">
                              <a:s>[MedicationRequest: </a:s>
                              <a:s>
                                 <a:s>&quot;Ambulatory Abuse Potential Opioids&quot;</a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                        <a:s> Rx</a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
    </a:s>
                  <a:s r="63">
                     <a:s>where </a:s>
                     <a:s r="63">
                        <a:s r="32">
                           <a:s r="30">
                              <a:s r="29">
                                 <a:s r="28">
                                    <a:s>Rx</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="29">
                                    <a:s>status</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="30">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="31">
                              <a:s>'active'</a:s>
                           </a:s>
                        </a:s>
                        <a:s>&#xd;
      and </a:s>
                        <a:s r="62">
                           <a:s r="60">
                              <a:s>ToCodes(</a:s>
                              <a:s r="35">
                                 <a:s r="34">
                                    <a:s r="33">
                                       <a:s>Rx</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="34">
                                       <a:s>category</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="35">
                                    <a:s>coding</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s> contains </a:s>
                           <a:s r="61">
                              <a:s>&quot;Outpatient&quot;</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="64" xsi:type="Query">
            <source localId="27" alias="Rx">
               <expression localId="26" dataType="fhir:MedicationRequest" codeProperty="medication" xsi:type="Retrieve">
                  <codes name="Ambulatory Abuse Potential Opioids" xsi:type="ValueSetRef"/>
               </expression>
            </source>
            <where localId="63" xsi:type="And">
               <operand localId="32" xsi:type="Equal">
                  <operand localId="30" path="value" xsi:type="Property">
                     <source localId="29" path="status" scope="Rx" xsi:type="Property"/>
                  </operand>
                  <operand localId="31" valueType="t:String" value="active" xsi:type="Literal"/>
               </operand>
               <operand localId="62" xsi:type="Contains">
                  <operand localId="60" name="ToCodes" xsi:type="FunctionRef">
                     <operand localId="35" path="coding" xsi:type="Property">
                        <source localId="34" path="category" scope="Rx" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand localId="61" name="Outpatient" xsi:type="CodeRef"/>
               </operand>
            </where>
         </expression>
      </def>
      <def localId="81" name="Active Ambulatory Benzodiazepine Rx" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="81">
               <a:s>define &quot;Active Ambulatory Benzodiazepine Rx&quot;:&#xd;
  </a:s>
               <a:s r="80">
                  <a:s>
                     <a:s r="67">
                        <a:s r="66">
                           <a:s r="66">
                              <a:s>[MedicationRequest: </a:s>
                              <a:s>
                                 <a:s>&quot;Benzodiazepines&quot;</a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                        <a:s> Rx</a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
    </a:s>
                  <a:s r="79">
                     <a:s>where </a:s>
                     <a:s r="79">
                        <a:s r="72">
                           <a:s r="70">
                              <a:s r="69">
                                 <a:s r="68">
                                    <a:s>Rx</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="69">
                                    <a:s>status</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="70">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="71">
                              <a:s>'active'</a:s>
                           </a:s>
                        </a:s>
                        <a:s>&#xd;
      and </a:s>
                        <a:s r="78">
                           <a:s r="76">
                              <a:s>ToCodes(</a:s>
                              <a:s r="75">
                                 <a:s r="74">
                                    <a:s r="73">
                                       <a:s>Rx</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="74">
                                       <a:s>category</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="75">
                                    <a:s>coding</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s> contains </a:s>
                           <a:s r="77">
                              <a:s>&quot;Outpatient&quot;</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="80" xsi:type="Query">
            <source localId="67" alias="Rx">
               <expression localId="66" dataType="fhir:MedicationRequest" codeProperty="medication" xsi:type="Retrieve">
                  <codes name="Benzodiazepines" xsi:type="ValueSetRef"/>
               </expression>
            </source>
            <where localId="79" xsi:type="And">
               <operand localId="72" xsi:type="Equal">
                  <operand localId="70" path="value" xsi:type="Property">
                     <source localId="69" path="status" scope="Rx" xsi:type="Property"/>
                  </operand>
                  <operand localId="71" valueType="t:String" value="active" xsi:type="Literal"/>
               </operand>
               <operand localId="78" xsi:type="Contains">
                  <operand localId="76" name="ToCodes" xsi:type="FunctionRef">
                     <operand localId="75" path="coding" xsi:type="Property">
                        <source localId="74" path="category" scope="Rx" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand localId="77" name="Outpatient" xsi:type="CodeRef"/>
               </operand>
            </where>
         </expression>
      </def>
      <def localId="97" name="Active Ambulatory Naloxone Rx" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="97">
               <a:s>define &quot;Active Ambulatory Naloxone Rx&quot;:&#xd;
  </a:s>
               <a:s r="96">
                  <a:s>
                     <a:s r="83">
                        <a:s r="82">
                           <a:s r="82">
                              <a:s>[MedicationRequest: </a:s>
                              <a:s>
                                 <a:s>&quot;Naloxone&quot;</a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                        <a:s> Rx</a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
    </a:s>
                  <a:s r="95">
                     <a:s>where </a:s>
                     <a:s r="95">
                        <a:s r="88">
                           <a:s r="86">
                              <a:s r="85">
                                 <a:s r="84">
                                    <a:s>Rx</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="85">
                                    <a:s>status</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="86">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="87">
                              <a:s>'active'</a:s>
                           </a:s>
                        </a:s>
                        <a:s>&#xd;
      and </a:s>
                        <a:s r="94">
                           <a:s r="92">
                              <a:s>ToCodes(</a:s>
                              <a:s r="91">
                                 <a:s r="90">
                                    <a:s r="89">
                                       <a:s>Rx</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="90">
                                       <a:s>category</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="91">
                                    <a:s>coding</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s> contains </a:s>
                           <a:s r="93">
                              <a:s>&quot;Outpatient&quot;</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="96" xsi:type="Query">
            <source localId="83" alias="Rx">
               <expression localId="82" dataType="fhir:MedicationRequest" codeProperty="medication" xsi:type="Retrieve">
                  <codes name="Naloxone" xsi:type="ValueSetRef"/>
               </expression>
            </source>
            <where localId="95" xsi:type="And">
               <operand localId="88" xsi:type="Equal">
                  <operand localId="86" path="value" xsi:type="Property">
                     <source localId="85" path="status" scope="Rx" xsi:type="Property"/>
                  </operand>
                  <operand localId="87" valueType="t:String" value="active" xsi:type="Literal"/>
               </operand>
               <operand localId="94" xsi:type="Contains">
                  <operand localId="92" name="ToCodes" xsi:type="FunctionRef">
                     <operand localId="91" path="coding" xsi:type="Property">
                        <source localId="90" path="category" scope="Rx" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand localId="93" name="Outpatient" xsi:type="CodeRef"/>
               </operand>
            </where>
         </expression>
      </def>
      <def localId="107" name="Ambulatory Opioid Rx" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="107">
               <a:s>define &quot;Ambulatory Opioid Rx&quot;:&#xd;
  </a:s>
               <a:s r="106">
                  <a:s>
                     <a:s r="99">
                        <a:s r="98">
                           <a:s r="98">
                              <a:s>[MedicationRequest: </a:s>
                              <a:s>
                                 <a:s>&quot;Ambulatory Abuse Potential Opioids&quot;</a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                        <a:s> Rx</a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
      </a:s>
                  <a:s r="105">
                     <a:s>where </a:s>
                     <a:s r="105">
                        <a:s r="103">
                           <a:s>ToCodes(</a:s>
                           <a:s r="102">
                              <a:s r="101">
                                 <a:s r="100">
                                    <a:s>Rx</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="101">
                                    <a:s>category</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="102">
                                 <a:s>coding</a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s> contains </a:s>
                        <a:s r="104">
                           <a:s>&quot;Outpatient&quot;</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="106" xsi:type="Query">
            <source localId="99" alias="Rx">
               <expression localId="98" dataType="fhir:MedicationRequest" codeProperty="medication" xsi:type="Retrieve">
                  <codes name="Ambulatory Abuse Potential Opioids" xsi:type="ValueSetRef"/>
               </expression>
            </source>
            <where localId="105" xsi:type="Contains">
               <operand localId="103" name="ToCodes" xsi:type="FunctionRef">
                  <operand localId="102" path="coding" xsi:type="Property">
                     <source localId="101" path="category" scope="Rx" xsi:type="Property"/>
                  </operand>
               </operand>
               <operand localId="104" name="Outpatient" xsi:type="CodeRef"/>
            </where>
         </expression>
      </def>
      <def localId="118" name="Is Context Prescription End of Life Opioid?" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="118">
               <a:s>define function &quot;Is Context Prescription End of Life Opioid?&quot; (ContextPrescriptions </a:s>
               <a:s r="109">
                  <a:s>List&lt;</a:s>
                  <a:s r="108">
                     <a:s>MedicationRequest</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="117">
                  <a:s r="117">
                     <a:s>exists </a:s>
                     <a:s r="116">
                        <a:s>(&#xd;
    </a:s>
                        <a:s r="116">
                           <a:s>
                              <a:s r="111">
                                 <a:s r="110">
                                    <a:s>
                                       <a:s>ContextPrescriptions</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> Rx</a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
      </a:s>
                           <a:s r="115">
                              <a:s>where </a:s>
                              <a:s r="115">
                                 <a:s r="113">
                                    <a:s r="112">
                                       <a:s>Rx</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="113">
                                       <a:s>medication</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> in </a:s>
                                 <a:s r="114">
                                    <a:s>&quot;End Of Life Opioids&quot;</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>&#xd;
  )</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="117" xsi:type="Exists">
            <operand localId="116" xsi:type="Query">
               <source localId="111" alias="Rx">
                  <expression localId="110" name="ContextPrescriptions" xsi:type="OperandRef"/>
               </source>
               <where localId="115" xsi:type="InValueSet">
                  <code name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand asType="fhir:CodeableConcept" xsi:type="As">
                        <operand localId="113" path="medication" scope="Rx" xsi:type="Property"/>
                     </operand>
                  </code>
                  <valueset localId="114" name="End Of Life Opioids"/>
               </where>
            </operand>
         </expression>
         <operand name="ContextPrescriptions">
            <operandTypeSpecifier localId="109" xsi:type="ListTypeSpecifier">
               <elementType localId="108" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="274" name="End of Life Assessment" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="274">
               <a:s>define &quot;End of Life Assessment&quot;:&#xd;
  // 1. Conditions indicating end of life or with limited life expectancy&#xd;
  </a:s>
               <a:s r="273">
                  <a:s r="224">
                     <a:s r="140">
                        <a:s>exists </a:s>
                        <a:s r="139">
                           <a:s>(&#xd;
    </a:s>
                           <a:s r="139">
                              <a:s r="128">
                                 <a:s>(&#xd;
      </a:s>
                                 <a:s r="128">
                                    <a:s>
                                       <a:s r="120">
                                          <a:s r="119">
                                             <a:s r="119">
                                                <a:s>[Condition: </a:s>
                                                <a:s>
                                                   <a:s>&quot;End of Life Conditions&quot;</a:s>
                                                </a:s>
                                                <a:s>]</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> C</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>&#xd;
        </a:s>
                                    <a:s r="127">
                                       <a:s>where </a:s>
                                       <a:s r="127">
                                          <a:s r="123">
                                             <a:s r="122">
                                                <a:s r="121">
                                                   <a:s>C</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="122">
                                                   <a:s>clinicalStatus</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="123">
                                                <a:s>value</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> in </a:s>
                                          <a:s r="126">
                                             <a:s>{ </a:s>
                                             <a:s r="124">
                                                <a:s>'active'</a:s>
                                             </a:s>
                                             <a:s>, </a:s>
                                             <a:s r="125">
                                                <a:s>'recurrence'</a:s>
                                             </a:s>
                                             <a:s> }</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>&#xd;
    )</a:s>
                              </a:s>
                              <a:s>&#xd;
    union&#xd;
    </a:s>
                              <a:s r="138">
                                 <a:s>(&#xd;
      </a:s>
                                 <a:s r="138">
                                    <a:s>
                                       <a:s r="130">
                                          <a:s r="129">
                                             <a:s r="129">
                                                <a:s>[Condition: code in </a:s>
                                                <a:s>
                                                   <a:s>&quot;Limited Life Expectancy Conditions&quot;</a:s>
                                                </a:s>
                                                <a:s>]</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> C</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>&#xd;
        </a:s>
                                    <a:s r="137">
                                       <a:s>where </a:s>
                                       <a:s r="137">
                                          <a:s r="133">
                                             <a:s r="132">
                                                <a:s r="131">
                                                   <a:s>C</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="132">
                                                   <a:s>clinicalStatus</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="133">
                                                <a:s>value</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> in </a:s>
                                          <a:s r="136">
                                             <a:s>{ </a:s>
                                             <a:s r="134">
                                                <a:s>'active'</a:s>
                                             </a:s>
                                             <a:s>, </a:s>
                                             <a:s r="135">
                                                <a:s>'recurrence'</a:s>
                                             </a:s>
                                             <a:s> }</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>&#xd;
    )</a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
  )</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
  // 2. Admitted/referred/discharged to hospice care&#xd;
  or </a:s>
                     <a:s r="223">
                        <a:s>exists </a:s>
                        <a:s r="222">
                           <a:s>(&#xd;
    </a:s>
                           <a:s r="222">
                              <a:s r="188">
                                 <a:s r="175">
                                    <a:s r="161">
                                       <a:s r="150">
                                          <a:s>(&#xd;
      </a:s>
                                          <a:s r="150">
                                             <a:s>
                                                <a:s r="142">
                                                   <a:s r="141">
                                                      <a:s r="141">
                                                         <a:s>[ReferralRequest: type in </a:s>
                                                         <a:s>
                                                            <a:s>&quot;Referral to Hospice&quot;</a:s>
                                                         </a:s>
                                                         <a:s>]</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> RR</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>&#xd;
        </a:s>
                                             <a:s r="149">
                                                <a:s>where </a:s>
                                                <a:s r="149">
                                                   <a:s r="145">
                                                      <a:s r="144">
                                                         <a:s r="143">
                                                            <a:s>RR</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="144">
                                                            <a:s>status</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="145">
                                                         <a:s>value</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> in </a:s>
                                                   <a:s r="148">
                                                      <a:s>{ </a:s>
                                                      <a:s r="146">
                                                         <a:s>'active'</a:s>
                                                      </a:s>
                                                      <a:s>, </a:s>
                                                      <a:s r="147">
                                                         <a:s>'completed'</a:s>
                                                      </a:s>
                                                      <a:s> }</a:s>
                                                   </a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>&#xd;
    )</a:s>
                                       </a:s>
                                       <a:s>&#xd;
    union&#xd;
    </a:s>
                                       <a:s r="160">
                                          <a:s>(&#xd;
      </a:s>
                                          <a:s r="160">
                                             <a:s>
                                                <a:s r="152">
                                                   <a:s r="151">
                                                      <a:s r="151">
                                                         <a:s>[Procedure: code in </a:s>
                                                         <a:s>
                                                            <a:s>&quot;Hospice Procedure Codes&quot;</a:s>
                                                         </a:s>
                                                         <a:s>]</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> P</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>&#xd;
        </a:s>
                                             <a:s r="159">
                                                <a:s>where </a:s>
                                                <a:s r="159">
                                                   <a:s r="155">
                                                      <a:s r="154">
                                                         <a:s r="153">
                                                            <a:s>P</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="154">
                                                            <a:s>status</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="155">
                                                         <a:s>value</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> in </a:s>
                                                   <a:s r="158">
                                                      <a:s>{ </a:s>
                                                      <a:s r="156">
                                                         <a:s>'in-progress'</a:s>
                                                      </a:s>
                                                      <a:s>, </a:s>
                                                      <a:s r="157">
                                                         <a:s>'completed'</a:s>
                                                      </a:s>
                                                      <a:s> }</a:s>
                                                   </a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>&#xd;
    )</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>&#xd;
    union&#xd;
    </a:s>
                                    <a:s r="174">
                                       <a:s>(&#xd;
      </a:s>
                                       <a:s r="174">
                                          <a:s>
                                             <a:s r="163">
                                                <a:s r="162">
                                                   <a:s r="162">
                                                      <a:s>[ProcedureRequest: code in </a:s>
                                                      <a:s>
                                                         <a:s>&quot;Hospice Procedure Codes&quot;</a:s>
                                                      </a:s>
                                                      <a:s>]</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> E</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>&#xd;
        </a:s>
                                          <a:s r="173">
                                             <a:s>where </a:s>
                                             <a:s r="173">
                                                <a:s r="166">
                                                   <a:s r="165">
                                                      <a:s r="164">
                                                         <a:s>E</a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="165">
                                                         <a:s>status</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="166">
                                                      <a:s>value</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> in </a:s>
                                                <a:s r="172">
                                                   <a:s>{ </a:s>
                                                   <a:s r="167">
                                                      <a:s>'planned'</a:s>
                                                   </a:s>
                                                   <a:s>, </a:s>
                                                   <a:s r="168">
                                                      <a:s>'arrived'</a:s>
                                                   </a:s>
                                                   <a:s>, </a:s>
                                                   <a:s r="169">
                                                      <a:s>'in-progress'</a:s>
                                                   </a:s>
                                                   <a:s>, </a:s>
                                                   <a:s r="170">
                                                      <a:s>'finished'</a:s>
                                                   </a:s>
                                                   <a:s>, </a:s>
                                                   <a:s r="171">
                                                      <a:s>'onleave'</a:s>
                                                   </a:s>
                                                   <a:s> }</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>&#xd;
    )</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>&#xd;
    union&#xd;
    </a:s>
                                 <a:s r="187">
                                    <a:s>(&#xd;
      </a:s>
                                    <a:s r="187">
                                       <a:s>
                                          <a:s r="177">
                                             <a:s r="176">
                                                <a:s r="176">
                                                   <a:s>[Observation: code in </a:s>
                                                   <a:s>
                                                      <a:s>&quot;Hospice Finding Codes&quot;</a:s>
                                                   </a:s>
                                                   <a:s>]</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> O</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>&#xd;
        </a:s>
                                       <a:s r="186">
                                          <a:s>where </a:s>
                                          <a:s r="186">
                                             <a:s>not </a:s>
                                             <a:s r="185">
                                                <a:s>(</a:s>
                                                <a:s r="185">
                                                   <a:s r="180">
                                                      <a:s r="179">
                                                         <a:s r="178">
                                                            <a:s>O</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="179">
                                                            <a:s>status</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="180">
                                                         <a:s>value</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> in </a:s>
                                                   <a:s r="184">
                                                      <a:s>{ </a:s>
                                                      <a:s r="181">
                                                         <a:s>'unknown'</a:s>
                                                      </a:s>
                                                      <a:s>, </a:s>
                                                      <a:s r="182">
                                                         <a:s>'entered-in-error'</a:s>
                                                      </a:s>
                                                      <a:s>, </a:s>
                                                      <a:s r="183">
                                                         <a:s>'cancelled'</a:s>
                                                      </a:s>
                                                      <a:s> }</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>&#xd;
    )</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>&#xd;
    union&#xd;
    </a:s>
                              <a:s r="221">
                                 <a:s>(&#xd;
      </a:s>
                                 <a:s r="221">
                                    <a:s>
                                       <a:s r="190">
                                          <a:s r="189">
                                             <a:s r="189">
                                                <a:s>[Encounter]</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> E</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>&#xd;
        </a:s>
                                    <a:s r="220">
                                       <a:s>where&#xd;
          </a:s>
                                       <a:s r="220">
                                          <a:s r="209">
                                             <a:s>(&#xd;
            </a:s>
                                             <a:s r="209">
                                                <a:s>if </a:s>
                                                <a:s r="202">
                                                   <a:s r="195">
                                                      <a:s r="194">
                                                         <a:s r="193">
                                                            <a:s r="192">
                                                               <a:s r="191">
                                                                  <a:s>E</a:s>
                                                               </a:s>
                                                               <a:s>.</a:s>
                                                               <a:s r="192">
                                                                  <a:s>hospitalization</a:s>
                                                               </a:s>
                                                            </a:s>
                                                            <a:s>.</a:s>
                                                            <a:s r="193">
                                                               <a:s>dischargeDisposition</a:s>
                                                            </a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="194">
                                                            <a:s>coding</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> is null</a:s>
                                                   </a:s>
                                                   <a:s>&#xd;
                or </a:s>
                                                   <a:s r="201">
                                                      <a:s>not </a:s>
                                                      <a:s r="200">
                                                         <a:s>exists </a:s>
                                                         <a:s r="199">
                                                            <a:s>(</a:s>
                                                            <a:s r="199">
                                                               <a:s r="198">
                                                                  <a:s r="197">
                                                                     <a:s r="196">
                                                                        <a:s>E</a:s>
                                                                     </a:s>
                                                                     <a:s>.</a:s>
                                                                     <a:s r="197">
                                                                        <a:s>hospitalization</a:s>
                                                                     </a:s>
                                                                  </a:s>
                                                                  <a:s>.</a:s>
                                                                  <a:s r="198">
                                                                     <a:s>dischargeDisposition</a:s>
                                                                  </a:s>
                                                               </a:s>
                                                               <a:s>.</a:s>
                                                               <a:s r="199">
                                                                  <a:s>coding</a:s>
                                                               </a:s>
                                                            </a:s>
                                                            <a:s>)</a:s>
                                                         </a:s>
                                                      </a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s r="203">&#xd;
              then false&#xd;
            else </a:s>
                                                <a:s r="208">
                                                   <a:s r="206">
                                                      <a:s r="205">
                                                         <a:s r="204">
                                                            <a:s>E</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="205">
                                                            <a:s>hospitalization</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="206">
                                                         <a:s>dischargeDisposition</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> in </a:s>
                                                   <a:s r="207">
                                                      <a:s>&quot;Hospice Disposition&quot;</a:s>
                                                   </a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>&#xd;
          )</a:s>
                                          </a:s>
                                          <a:s>&#xd;
          and </a:s>
                                          <a:s r="219">
                                             <a:s r="212">
                                                <a:s r="211">
                                                   <a:s r="210">
                                                      <a:s>E</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="211">
                                                      <a:s>status</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="212">
                                                   <a:s>value</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> in </a:s>
                                             <a:s r="218">
                                                <a:s>{ </a:s>
                                                <a:s r="213">
                                                   <a:s>'planned'</a:s>
                                                </a:s>
                                                <a:s>, </a:s>
                                                <a:s r="214">
                                                   <a:s>'arrived'</a:s>
                                                </a:s>
                                                <a:s>, </a:s>
                                                <a:s r="215">
                                                   <a:s>'in-progress'</a:s>
                                                </a:s>
                                                <a:s>, </a:s>
                                                <a:s r="216">
                                                   <a:s>'finished'</a:s>
                                                </a:s>
                                                <a:s>, </a:s>
                                                <a:s r="217">
                                                   <a:s>'onleave'</a:s>
                                                </a:s>
                                                <a:s> }</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>&#xd;
    )</a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
  )</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
  // 3. Medications indicating end of life&#xd;
  or </a:s>
                  <a:s r="272">
                     <a:s>exists </a:s>
                     <a:s r="271">
                        <a:s>(&#xd;
    </a:s>
                        <a:s r="271">
                           <a:s r="259">
                              <a:s r="248">
                                 <a:s r="235">
                                    <a:s>(&#xd;
      </a:s>
                                    <a:s r="235">
                                       <a:s>
                                          <a:s r="226">
                                             <a:s r="225">
                                                <a:s r="225">
                                                   <a:s>[MedicationAdministration: code in </a:s>
                                                   <a:s>
                                                      <a:s>&quot;End Of Life Opioids&quot;</a:s>
                                                   </a:s>
                                                   <a:s>]</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> MA</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>&#xd;
        </a:s>
                                       <a:s r="234">
                                          <a:s>where </a:s>
                                          <a:s r="234">
                                             <a:s r="229">
                                                <a:s r="228">
                                                   <a:s r="227">
                                                      <a:s>MA</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="228">
                                                      <a:s>status</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="229">
                                                   <a:s>value</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> in </a:s>
                                             <a:s r="233">
                                                <a:s>{ </a:s>
                                                <a:s r="230">
                                                   <a:s>'in-progress'</a:s>
                                                </a:s>
                                                <a:s>, </a:s>
                                                <a:s r="231">
                                                   <a:s>'on-hold'</a:s>
                                                </a:s>
                                                <a:s>, </a:s>
                                                <a:s r="232">
                                                   <a:s>'completed'</a:s>
                                                </a:s>
                                                <a:s> }</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>&#xd;
    )</a:s>
                                 </a:s>
                                 <a:s>&#xd;
    union&#xd;
    </a:s>
                                 <a:s r="247">
                                    <a:s>(&#xd;
      </a:s>
                                    <a:s r="247">
                                       <a:s>
                                          <a:s r="237">
                                             <a:s r="236">
                                                <a:s r="236">
                                                   <a:s>[MedicationDispense: code in </a:s>
                                                   <a:s>
                                                      <a:s>&quot;End Of Life Opioids&quot;</a:s>
                                                   </a:s>
                                                   <a:s>]</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> MD</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>&#xd;
        </a:s>
                                       <a:s r="246">
                                          <a:s>where </a:s>
                                          <a:s r="246">
                                             <a:s r="240">
                                                <a:s r="239">
                                                   <a:s r="238">
                                                      <a:s>MD</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="239">
                                                      <a:s>status</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="240">
                                                   <a:s>value</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> in </a:s>
                                             <a:s r="245">
                                                <a:s>{ </a:s>
                                                <a:s r="241">
                                                   <a:s>'preparation'</a:s>
                                                </a:s>
                                                <a:s>, </a:s>
                                                <a:s r="242">
                                                   <a:s>'in-progress'</a:s>
                                                </a:s>
                                                <a:s>, </a:s>
                                                <a:s r="243">
                                                   <a:s>'on-hold'</a:s>
                                                </a:s>
                                                <a:s>, </a:s>
                                                <a:s r="244">
                                                   <a:s>'completed'</a:s>
                                                </a:s>
                                                <a:s> }</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>&#xd;
    )</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>&#xd;
    union&#xd;
    </a:s>
                              <a:s r="258">
                                 <a:s>(&#xd;
      </a:s>
                                 <a:s r="258">
                                    <a:s>
                                       <a:s r="250">
                                          <a:s r="249">
                                             <a:s r="249">
                                                <a:s>[MedicationRequest: code in </a:s>
                                                <a:s>
                                                   <a:s>&quot;End Of Life Opioids&quot;</a:s>
                                                </a:s>
                                                <a:s>]</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> MR</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>&#xd;
        </a:s>
                                    <a:s r="257">
                                       <a:s>where </a:s>
                                       <a:s r="257">
                                          <a:s r="253">
                                             <a:s r="252">
                                                <a:s r="251">
                                                   <a:s>MR</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="252">
                                                   <a:s>status</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="253">
                                                <a:s>value</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> in </a:s>
                                          <a:s r="256">
                                             <a:s>{ </a:s>
                                             <a:s r="254">
                                                <a:s>'active'</a:s>
                                             </a:s>
                                             <a:s>, </a:s>
                                             <a:s r="255">
                                                <a:s>'completed'</a:s>
                                             </a:s>
                                             <a:s> }</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>&#xd;
    )</a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
    union&#xd;
    </a:s>
                           <a:s r="270">
                              <a:s>(&#xd;
      </a:s>
                              <a:s r="270">
                                 <a:s>
                                    <a:s r="261">
                                       <a:s r="260">
                                          <a:s r="260">
                                             <a:s>[MedicationStatement: code in </a:s>
                                             <a:s>
                                                <a:s>&quot;End Of Life Opioids&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> MS</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>&#xd;
        </a:s>
                                 <a:s r="269">
                                    <a:s>where </a:s>
                                    <a:s r="269">
                                       <a:s r="264">
                                          <a:s r="263">
                                             <a:s r="262">
                                                <a:s>MS</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="263">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="264">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> in </a:s>
                                       <a:s r="268">
                                          <a:s>{ </a:s>
                                          <a:s r="265">
                                             <a:s>'active'</a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="266">
                                             <a:s>'completed'</a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="267">
                                             <a:s>'intended'</a:s>
                                          </a:s>
                                          <a:s> }</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>&#xd;
    )</a:s>
                           </a:s>
                        </a:s>
                        <a:s>&#xd;
  )</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="273" xsi:type="Or">
            <operand localId="224" xsi:type="Or">
               <operand localId="140" xsi:type="Exists">
                  <operand localId="139" xsi:type="Union">
                     <operand localId="128" xsi:type="Query">
                        <source localId="120" alias="C">
                           <expression localId="119" dataType="fhir:Condition" codeProperty="code" xsi:type="Retrieve">
                              <codes name="End of Life Conditions" xsi:type="ValueSetRef"/>
                           </expression>
                        </source>
                        <where localId="127" xsi:type="In">
                           <operand localId="123" path="value" xsi:type="Property">
                              <source localId="122" path="clinicalStatus" scope="C" xsi:type="Property"/>
                           </operand>
                           <operand localId="126" xsi:type="List">
                              <element localId="124" valueType="t:String" value="active" xsi:type="Literal"/>
                              <element localId="125" valueType="t:String" value="recurrence" xsi:type="Literal"/>
                           </operand>
                        </where>
                     </operand>
                     <operand localId="138" xsi:type="Query">
                        <source localId="130" alias="C">
                           <expression localId="129" dataType="fhir:Condition" codeProperty="code" xsi:type="Retrieve">
                              <codes name="Limited Life Expectancy Conditions" xsi:type="ValueSetRef"/>
                           </expression>
                        </source>
                        <where localId="137" xsi:type="In">
                           <operand localId="133" path="value" xsi:type="Property">
                              <source localId="132" path="clinicalStatus" scope="C" xsi:type="Property"/>
                           </operand>
                           <operand localId="136" xsi:type="List">
                              <element localId="134" valueType="t:String" value="active" xsi:type="Literal"/>
                              <element localId="135" valueType="t:String" value="recurrence" xsi:type="Literal"/>
                           </operand>
                        </where>
                     </operand>
                  </operand>
               </operand>
               <operand localId="223" xsi:type="Exists">
                  <operand localId="222" xsi:type="Union">
                     <operand xsi:type="As">
                        <operand localId="188" xsi:type="Union">
                           <operand xsi:type="As">
                              <operand localId="175" xsi:type="Union">
                                 <operand xsi:type="As">
                                    <operand localId="161" xsi:type="Union">
                                       <operand xsi:type="As">
                                          <operand localId="150" xsi:type="Query">
                                             <source localId="142" alias="RR">
                                                <expression localId="141" dataType="fhir:ReferralRequest" codeProperty="type" xsi:type="Retrieve">
                                                   <codes xsi:type="ToList">
                                                      <operand name="Referral to Hospice" xsi:type="CodeRef"/>
                                                   </codes>
                                                </expression>
                                             </source>
                                             <where localId="149" xsi:type="In">
                                                <operand localId="145" path="value" xsi:type="Property">
                                                   <source localId="144" path="status" scope="RR" xsi:type="Property"/>
                                                </operand>
                                                <operand localId="148" xsi:type="List">
                                                   <element localId="146" valueType="t:String" value="active" xsi:type="Literal"/>
                                                   <element localId="147" valueType="t:String" value="completed" xsi:type="Literal"/>
                                                </operand>
                                             </where>
                                          </operand>
                                          <asTypeSpecifier xsi:type="ListTypeSpecifier">
                                             <elementType xsi:type="ChoiceTypeSpecifier">
                                                <choice name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
                                                <choice name="fhir:ReferralRequest" xsi:type="NamedTypeSpecifier"/>
                                             </elementType>
                                          </asTypeSpecifier>
                                       </operand>
                                       <operand xsi:type="As">
                                          <operand localId="160" xsi:type="Query">
                                             <source localId="152" alias="P">
                                                <expression localId="151" dataType="fhir:Procedure" codeProperty="code" xsi:type="Retrieve">
                                                   <codes name="Hospice Procedure Codes" xsi:type="ValueSetRef"/>
                                                </expression>
                                             </source>
                                             <where localId="159" xsi:type="In">
                                                <operand localId="155" path="value" xsi:type="Property">
                                                   <source localId="154" path="status" scope="P" xsi:type="Property"/>
                                                </operand>
                                                <operand localId="158" xsi:type="List">
                                                   <element localId="156" valueType="t:String" value="in-progress" xsi:type="Literal"/>
                                                   <element localId="157" valueType="t:String" value="completed" xsi:type="Literal"/>
                                                </operand>
                                             </where>
                                          </operand>
                                          <asTypeSpecifier xsi:type="ListTypeSpecifier">
                                             <elementType xsi:type="ChoiceTypeSpecifier">
                                                <choice name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
                                                <choice name="fhir:ReferralRequest" xsi:type="NamedTypeSpecifier"/>
                                             </elementType>
                                          </asTypeSpecifier>
                                       </operand>
                                    </operand>
                                    <asTypeSpecifier xsi:type="ListTypeSpecifier">
                                       <elementType xsi:type="ChoiceTypeSpecifier">
                                          <choice name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
                                          <choice name="fhir:ReferralRequest" xsi:type="NamedTypeSpecifier"/>
                                          <choice name="fhir:ProcedureRequest" xsi:type="NamedTypeSpecifier"/>
                                       </elementType>
                                    </asTypeSpecifier>
                                 </operand>
                                 <operand xsi:type="As">
                                    <operand localId="174" xsi:type="Query">
                                       <source localId="163" alias="E">
                                          <expression localId="162" dataType="fhir:ProcedureRequest" codeProperty="code" xsi:type="Retrieve">
                                             <codes name="Hospice Procedure Codes" xsi:type="ValueSetRef"/>
                                          </expression>
                                       </source>
                                       <where localId="173" xsi:type="In">
                                          <operand localId="166" path="value" xsi:type="Property">
                                             <source localId="165" path="status" scope="E" xsi:type="Property"/>
                                          </operand>
                                          <operand localId="172" xsi:type="List">
                                             <element localId="167" valueType="t:String" value="planned" xsi:type="Literal"/>
                                             <element localId="168" valueType="t:String" value="arrived" xsi:type="Literal"/>
                                             <element localId="169" valueType="t:String" value="in-progress" xsi:type="Literal"/>
                                             <element localId="170" valueType="t:String" value="finished" xsi:type="Literal"/>
                                             <element localId="171" valueType="t:String" value="onleave" xsi:type="Literal"/>
                                          </operand>
                                       </where>
                                    </operand>
                                    <asTypeSpecifier xsi:type="ListTypeSpecifier">
                                       <elementType xsi:type="ChoiceTypeSpecifier">
                                          <choice name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
                                          <choice name="fhir:ReferralRequest" xsi:type="NamedTypeSpecifier"/>
                                          <choice name="fhir:ProcedureRequest" xsi:type="NamedTypeSpecifier"/>
                                       </elementType>
                                    </asTypeSpecifier>
                                 </operand>
                              </operand>
                              <asTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType xsi:type="ChoiceTypeSpecifier">
                                    <choice name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
                                    <choice name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
                                    <choice name="fhir:ReferralRequest" xsi:type="NamedTypeSpecifier"/>
                                    <choice name="fhir:ProcedureRequest" xsi:type="NamedTypeSpecifier"/>
                                 </elementType>
                              </asTypeSpecifier>
                           </operand>
                           <operand xsi:type="As">
                              <operand localId="187" xsi:type="Query">
                                 <source localId="177" alias="O">
                                    <expression localId="176" dataType="fhir:Observation" codeProperty="code" xsi:type="Retrieve">
                                       <codes name="Hospice Finding Codes" xsi:type="ValueSetRef"/>
                                    </expression>
                                 </source>
                                 <where localId="186" xsi:type="Not">
                                    <operand localId="185" xsi:type="In">
                                       <operand localId="180" path="value" xsi:type="Property">
                                          <source localId="179" path="status" scope="O" xsi:type="Property"/>
                                       </operand>
                                       <operand localId="184" xsi:type="List">
                                          <element localId="181" valueType="t:String" value="unknown" xsi:type="Literal"/>
                                          <element localId="182" valueType="t:String" value="entered-in-error" xsi:type="Literal"/>
                                          <element localId="183" valueType="t:String" value="cancelled" xsi:type="Literal"/>
                                       </operand>
                                    </operand>
                                 </where>
                              </operand>
                              <asTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType xsi:type="ChoiceTypeSpecifier">
                                    <choice name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
                                    <choice name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
                                    <choice name="fhir:ReferralRequest" xsi:type="NamedTypeSpecifier"/>
                                    <choice name="fhir:ProcedureRequest" xsi:type="NamedTypeSpecifier"/>
                                 </elementType>
                              </asTypeSpecifier>
                           </operand>
                        </operand>
                        <asTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType xsi:type="ChoiceTypeSpecifier">
                              <choice name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:ReferralRequest" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:ProcedureRequest" xsi:type="NamedTypeSpecifier"/>
                           </elementType>
                        </asTypeSpecifier>
                     </operand>
                     <operand xsi:type="As">
                        <operand localId="221" xsi:type="Query">
                           <source localId="190" alias="E">
                              <expression localId="189" dataType="fhir:Encounter" xsi:type="Retrieve"/>
                           </source>
                           <where localId="220" xsi:type="And">
                              <operand localId="209" xsi:type="If">
                                 <condition asType="t:Boolean" xsi:type="As">
                                    <operand localId="202" xsi:type="Or">
                                       <operand localId="195" xsi:type="IsNull">
                                          <operand localId="194" path="coding" xsi:type="Property">
                                             <source localId="193" path="dischargeDisposition" xsi:type="Property">
                                                <source localId="192" path="hospitalization" scope="E" xsi:type="Property"/>
                                             </source>
                                          </operand>
                                       </operand>
                                       <operand localId="201" xsi:type="Not">
                                          <operand localId="200" xsi:type="Exists">
                                             <operand localId="199" path="coding" xsi:type="Property">
                                                <source localId="198" path="dischargeDisposition" xsi:type="Property">
                                                   <source localId="197" path="hospitalization" scope="E" xsi:type="Property"/>
                                                </source>
                                             </operand>
                                          </operand>
                                       </operand>
                                    </operand>
                                 </condition>
                                 <then localId="203" valueType="t:Boolean" value="false" xsi:type="Literal"/>
                                 <else localId="208" xsi:type="InValueSet">
                                    <code name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <operand localId="206" path="dischargeDisposition" xsi:type="Property">
                                          <source localId="205" path="hospitalization" scope="E" xsi:type="Property"/>
                                       </operand>
                                    </code>
                                    <valueset localId="207" name="Hospice Disposition"/>
                                 </else>
                              </operand>
                              <operand localId="219" xsi:type="In">
                                 <operand localId="212" path="value" xsi:type="Property">
                                    <source localId="211" path="status" scope="E" xsi:type="Property"/>
                                 </operand>
                                 <operand localId="218" xsi:type="List">
                                    <element localId="213" valueType="t:String" value="planned" xsi:type="Literal"/>
                                    <element localId="214" valueType="t:String" value="arrived" xsi:type="Literal"/>
                                    <element localId="215" valueType="t:String" value="in-progress" xsi:type="Literal"/>
                                    <element localId="216" valueType="t:String" value="finished" xsi:type="Literal"/>
                                    <element localId="217" valueType="t:String" value="onleave" xsi:type="Literal"/>
                                 </operand>
                              </operand>
                           </where>
                        </operand>
                        <asTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType xsi:type="ChoiceTypeSpecifier">
                              <choice name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:ReferralRequest" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:ProcedureRequest" xsi:type="NamedTypeSpecifier"/>
                           </elementType>
                        </asTypeSpecifier>
                     </operand>
                  </operand>
               </operand>
            </operand>
            <operand localId="272" xsi:type="Exists">
               <operand localId="271" xsi:type="Union">
                  <operand xsi:type="As">
                     <operand localId="259" xsi:type="Union">
                        <operand xsi:type="As">
                           <operand localId="248" xsi:type="Union">
                              <operand xsi:type="As">
                                 <operand localId="235" xsi:type="Query">
                                    <source localId="226" alias="MA">
                                       <expression localId="225" dataType="fhir:MedicationAdministration" codeProperty="code" xsi:type="Retrieve">
                                          <codes name="End Of Life Opioids" xsi:type="ValueSetRef"/>
                                       </expression>
                                    </source>
                                    <where localId="234" xsi:type="In">
                                       <operand localId="229" path="value" xsi:type="Property">
                                          <source localId="228" path="status" scope="MA" xsi:type="Property"/>
                                       </operand>
                                       <operand localId="233" xsi:type="List">
                                          <element localId="230" valueType="t:String" value="in-progress" xsi:type="Literal"/>
                                          <element localId="231" valueType="t:String" value="on-hold" xsi:type="Literal"/>
                                          <element localId="232" valueType="t:String" value="completed" xsi:type="Literal"/>
                                       </operand>
                                    </where>
                                 </operand>
                                 <asTypeSpecifier xsi:type="ListTypeSpecifier">
                                    <elementType xsi:type="ChoiceTypeSpecifier">
                                       <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                                       <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                                    </elementType>
                                 </asTypeSpecifier>
                              </operand>
                              <operand xsi:type="As">
                                 <operand localId="247" xsi:type="Query">
                                    <source localId="237" alias="MD">
                                       <expression localId="236" dataType="fhir:MedicationDispense" codeProperty="code" xsi:type="Retrieve">
                                          <codes name="End Of Life Opioids" xsi:type="ValueSetRef"/>
                                       </expression>
                                    </source>
                                    <where localId="246" xsi:type="In">
                                       <operand localId="240" path="value" xsi:type="Property">
                                          <source localId="239" path="status" scope="MD" xsi:type="Property"/>
                                       </operand>
                                       <operand localId="245" xsi:type="List">
                                          <element localId="241" valueType="t:String" value="preparation" xsi:type="Literal"/>
                                          <element localId="242" valueType="t:String" value="in-progress" xsi:type="Literal"/>
                                          <element localId="243" valueType="t:String" value="on-hold" xsi:type="Literal"/>
                                          <element localId="244" valueType="t:String" value="completed" xsi:type="Literal"/>
                                       </operand>
                                    </where>
                                 </operand>
                                 <asTypeSpecifier xsi:type="ListTypeSpecifier">
                                    <elementType xsi:type="ChoiceTypeSpecifier">
                                       <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                                       <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                                    </elementType>
                                 </asTypeSpecifier>
                              </operand>
                           </operand>
                           <asTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType xsi:type="ChoiceTypeSpecifier">
                                 <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                              </elementType>
                           </asTypeSpecifier>
                        </operand>
                        <operand xsi:type="As">
                           <operand localId="258" xsi:type="Query">
                              <source localId="250" alias="MR">
                                 <expression localId="249" dataType="fhir:MedicationRequest" codeProperty="code" xsi:type="Retrieve">
                                    <codes name="End Of Life Opioids" xsi:type="ValueSetRef"/>
                                 </expression>
                              </source>
                              <where localId="257" xsi:type="In">
                                 <operand localId="253" path="value" xsi:type="Property">
                                    <source localId="252" path="status" scope="MR" xsi:type="Property"/>
                                 </operand>
                                 <operand localId="256" xsi:type="List">
                                    <element localId="254" valueType="t:String" value="active" xsi:type="Literal"/>
                                    <element localId="255" valueType="t:String" value="completed" xsi:type="Literal"/>
                                 </operand>
                              </where>
                           </operand>
                           <asTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType xsi:type="ChoiceTypeSpecifier">
                                 <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                                 <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                              </elementType>
                           </asTypeSpecifier>
                        </operand>
                     </operand>
                     <asTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="ChoiceTypeSpecifier">
                           <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationStatement" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </asTypeSpecifier>
                  </operand>
                  <operand xsi:type="As">
                     <operand localId="270" xsi:type="Query">
                        <source localId="261" alias="MS">
                           <expression localId="260" dataType="fhir:MedicationStatement" codeProperty="code" xsi:type="Retrieve">
                              <codes name="End Of Life Opioids" xsi:type="ValueSetRef"/>
                           </expression>
                        </source>
                        <where localId="269" xsi:type="In">
                           <operand localId="264" path="value" xsi:type="Property">
                              <source localId="263" path="status" scope="MS" xsi:type="Property"/>
                           </operand>
                           <operand localId="268" xsi:type="List">
                              <element localId="265" valueType="t:String" value="active" xsi:type="Literal"/>
                              <element localId="266" valueType="t:String" value="completed" xsi:type="Literal"/>
                              <element localId="267" valueType="t:String" value="intended" xsi:type="Literal"/>
                           </operand>
                        </where>
                     </operand>
                     <asTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="ChoiceTypeSpecifier">
                           <choice name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationDispense" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationAdministration" xsi:type="NamedTypeSpecifier"/>
                           <choice name="fhir:MedicationStatement" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </asTypeSpecifier>
                  </operand>
               </operand>
            </operand>
         </expression>
      </def>
      <def localId="330" name="ToQuantity" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="330">
               <a:s>define function ToQuantity(quantity </a:s>
               <a:s r="322">
                  <a:s>FHIR.Quantity</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="329">
                  <a:s r="329">
                     <a:s>System.Quantity { </a:s>
                     <a:s>
                        <a:s>value: </a:s>
                        <a:s r="325">
                           <a:s r="324">
                              <a:s r="323">
                                 <a:s>quantity</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="324">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="325">
                              <a:s>value</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>, </a:s>
                     <a:s>
                        <a:s>unit: </a:s>
                        <a:s r="328">
                           <a:s r="327">
                              <a:s r="326">
                                 <a:s>quantity</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="327">
                                 <a:s>unit</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="328">
                              <a:s>value</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> }</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="329" classType="t:Quantity" xsi:type="Instance">
            <element name="value">
               <value localId="325" path="value" xsi:type="Property">
                  <source localId="324" path="value" xsi:type="Property">
                     <source localId="323" name="quantity" xsi:type="OperandRef"/>
                  </source>
               </value>
            </element>
            <element name="unit">
               <value localId="328" path="value" xsi:type="Property">
                  <source localId="327" path="unit" xsi:type="Property">
                     <source localId="326" name="quantity" xsi:type="OperandRef"/>
                  </source>
               </value>
            </element>
         </expression>
         <operand name="quantity">
            <operandTypeSpecifier localId="322" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="430" name="Prescriptions" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="430">
               <a:s>define function Prescriptions(Orders </a:s>
               <a:s r="276">
                  <a:s>List&lt;</a:s>
                  <a:s r="275">
                     <a:s>MedicationRequest</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="429">
                  <a:s r="429">
                     <a:s>
                        <a:s r="278">
                           <a:s r="277">
                              <a:s>
                                 <a:s>Orders</a:s>
                              </a:s>
                           </a:s>
                           <a:s> O</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s>
                        <a:s>let&#xd;
      // NOTE: Assuming medication is specified as a CodeableConcept with a single RxNorm code&#xd;
      </a:s>
                        <a:s r="285">
                           <a:s>rxNormCode: </a:s>
                           <a:s r="284">
                              <a:s>ToCode(</a:s>
                              <a:s r="283">
                                 <a:s r="281">
                                    <a:s r="280">
                                       <a:s r="279">
                                          <a:s>O</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="280">
                                          <a:s>medication</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="281">
                                       <a:s>coding</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="282">[0]</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="289">
                           <a:s>medicationName: </a:s>
                           <a:s r="288">
                              <a:s r="286">
                                 <a:s>OMTKLogic</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="288">
                                 <a:s>GetMedicationName(</a:s>
                                 <a:s r="287">
                                    <a:s>rxNormCode</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      // NOTE: Assuming a single dosage instruction element&#xd;
      </a:s>
                        <a:s r="294">
                           <a:s>dosageInstruction: </a:s>
                           <a:s r="293">
                              <a:s r="291">
                                 <a:s r="290">
                                    <a:s>O</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="291">
                                    <a:s>dosageInstruction</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="292">[0]</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="298">
                           <a:s>repeat: </a:s>
                           <a:s r="297">
                              <a:s r="296">
                                 <a:s r="295">
                                    <a:s>dosageInstruction</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="296">
                                    <a:s>timing</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="297">
                                 <a:s>repeat</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="306">
                           <a:s>frequency: </a:s>
                           <a:s r="305">
                              <a:s>Coalesce(</a:s>
                              <a:s r="301">
                                 <a:s r="300">
                                    <a:s r="299">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="300">
                                       <a:s>frequencyMax</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="301">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="304">
                                 <a:s r="303">
                                    <a:s r="302">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="303">
                                       <a:s>frequency</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="304">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="314">
                           <a:s>period: </a:s>
                           <a:s r="313">
                              <a:s>System.Quantity { </a:s>
                              <a:s>
                                 <a:s>value: </a:s>
                                 <a:s r="309">
                                    <a:s r="308">
                                       <a:s r="307">
                                          <a:s>repeat</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="308">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="309">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s>
                                 <a:s>unit: </a:s>
                                 <a:s r="312">
                                    <a:s r="311">
                                       <a:s r="310">
                                          <a:s>repeat</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="311">
                                          <a:s>periodUnit</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="312">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="354">
                           <a:s>doseDescription:&#xd;
        </a:s>
                           <a:s r="353">
                              <a:s>Coalesce(&#xd;
          // There should be a conversion from FHIR.SimpleQuantity to System.Quantity&#xd;
          </a:s>
                              <a:s r="351">
                                 <a:s>if </a:s>
                                 <a:s r="318">
                                    <a:s r="316">
                                       <a:s r="315">
                                          <a:s>dosageInstruction</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="316">
                                          <a:s>dose</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> is </a:s>
                                    <a:s r="317">
                                       <a:s>FHIR.Range</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>&#xd;
            then </a:s>
                                 <a:s r="346">
                                    <a:s r="340">
                                       <a:s r="334">
                                          <a:s r="332">
                                             <a:s>ToString(</a:s>
                                             <a:s r="331">
                                                <a:s>ToQuantity(</a:s>
                                                <a:s r="321">
                                                   <a:s r="320">
                                                      <a:s r="319">
                                                         <a:s>dosageInstruction</a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="320">
                                                         <a:s>dose</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="321">
                                                      <a:s>low</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                          <a:s>&#xd;
                          + </a:s>
                                          <a:s r="333">
                                             <a:s>'-'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> + </a:s>
                                       <a:s r="339">
                                          <a:s>ToString(</a:s>
                                          <a:s r="338">
                                             <a:s>ToQuantity(</a:s>
                                             <a:s r="337">
                                                <a:s r="336">
                                                   <a:s r="335">
                                                      <a:s>dosageInstruction</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="336">
                                                      <a:s>dose</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="337">
                                                   <a:s>high</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>&#xd;
                          + </a:s>
                                    <a:s r="345">
                                       <a:s r="344">
                                          <a:s r="343">
                                             <a:s r="342">
                                                <a:s r="341">
                                                   <a:s>dosageInstruction</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="342">
                                                   <a:s>dose</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="343">
                                                <a:s>high</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="344">
                                             <a:s>unit</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="345">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>&#xd;
            else </a:s>
                                 <a:s r="350">
                                    <a:s>ToString(</a:s>
                                    <a:s r="349">
                                       <a:s>ToQuantity(</a:s>
                                       <a:s r="348">
                                          <a:s r="347">
                                             <a:s>dosageInstruction</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="348">
                                             <a:s>dose</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,&#xd;
            </a:s>
                              <a:s r="352">
                                 <a:s>''</a:s>
                              </a:s>
                              <a:s>&#xd;
        )</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="372">
                           <a:s>frequencyDescription:&#xd;
        </a:s>
                           <a:s r="371">
                              <a:s r="360">
                                 <a:s>ToString(</a:s>
                                 <a:s r="359">
                                    <a:s r="358">
                                       <a:s r="357">
                                          <a:s r="356">
                                             <a:s r="355">
                                                <a:s>dosageInstruction</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="356">
                                                <a:s>timing</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="357">
                                             <a:s>repeat</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="358">
                                          <a:s>frequency</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="359">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> +&#xd;
          </a:s>
                              <a:s r="370">
                                 <a:s>Coalesce(&#xd;
            </a:s>
                                 <a:s r="368">
                                    <a:s r="361">
                                       <a:s>'-'</a:s>
                                    </a:s>
                                    <a:s> + </a:s>
                                    <a:s r="367">
                                       <a:s>ToString(</a:s>
                                       <a:s r="366">
                                          <a:s r="365">
                                             <a:s r="364">
                                                <a:s r="363">
                                                   <a:s r="362">
                                                      <a:s>dosageInstruction</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="363">
                                                      <a:s>timing</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="364">
                                                   <a:s>repeat</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="365">
                                                <a:s>frequencyMax</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="366">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>,&#xd;
            </a:s>
                                 <a:s r="369">
                                    <a:s>''</a:s>
                                 </a:s>
                                 <a:s>&#xd;
          )</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="428">
                        <a:s>return </a:s>
                        <a:s r="427">
                           <a:s>{&#xd;
      </a:s>
                           <a:s>
                              <a:s>rxNormCode: </a:s>
                              <a:s r="373">
                                 <a:s>rxNormCode</a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>isDraft: </a:s>
                              <a:s r="378">
                                 <a:s r="376">
                                    <a:s r="375">
                                       <a:s r="374">
                                          <a:s>O</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="375">
                                          <a:s>status</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="376">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="377">
                                    <a:s>'draft'</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      // NOTE: Assuming asNeeded is expressed as a boolean&#xd;
      </a:s>
                           <a:s>
                              <a:s>isPRN: </a:s>
                              <a:s r="381">
                                 <a:s r="380">
                                    <a:s r="379">
                                       <a:s>dosageInstruction</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="380">
                                       <a:s>asNeeded</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="381">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>prescription:&#xd;
        </a:s>
                              <a:s r="408">
                                 <a:s>if </a:s>
                                 <a:s r="384">
                                    <a:s r="383">
                                       <a:s r="382">
                                          <a:s>dosageInstruction</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="383">
                                          <a:s>text</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> is not null</a:s>
                                 </a:s>
                                 <a:s> then&#xd;
          </a:s>
                                 <a:s r="391">
                                    <a:s r="387">
                                       <a:s r="385">
                                          <a:s>medicationName</a:s>
                                       </a:s>
                                       <a:s> + </a:s>
                                       <a:s r="386">
                                          <a:s>' '</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> + </a:s>
                                    <a:s r="390">
                                       <a:s r="389">
                                          <a:s r="388">
                                             <a:s>dosageInstruction</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="389">
                                             <a:s>text</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="390">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>&#xd;
        else&#xd;
          // TODO: Shouldn't need the .value here on asNeededBoolean&#xd;
          </a:s>
                                 <a:s r="407">
                                    <a:s r="400">
                                       <a:s r="398">
                                          <a:s r="396">
                                             <a:s r="394">
                                                <a:s r="392">
                                                   <a:s>medicationName</a:s>
                                                </a:s>
                                                <a:s> + </a:s>
                                                <a:s r="393">
                                                   <a:s>' '</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> + </a:s>
                                             <a:s r="395">
                                                <a:s>doseDescription</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> + </a:s>
                                          <a:s r="397">
                                             <a:s>' q'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> + </a:s>
                                       <a:s r="399">
                                          <a:s>frequencyDescription</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> + </a:s>
                                    <a:s r="406">
                                       <a:s>(</a:s>
                                       <a:s r="406">
                                          <a:s>if </a:s>
                                          <a:s r="403">
                                             <a:s r="402">
                                                <a:s r="401">
                                                   <a:s>dosageInstruction</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="402">
                                                   <a:s>asNeeded</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="403">
                                                <a:s>value</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> then </a:s>
                                          <a:s r="404">
                                             <a:s>' PRN'</a:s>
                                          </a:s>
                                          <a:s> else </a:s>
                                          <a:s r="405">
                                             <a:s>''</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      // TODO: Shouldn't need the ToQuantity here...&#xd;
      </a:s>
                           <a:s>
                              <a:s>dose: </a:s>
                              <a:s r="420">
                                 <a:s>if </a:s>
                                 <a:s r="412">
                                    <a:s r="410">
                                       <a:s r="409">
                                          <a:s>dosageInstruction</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="410">
                                          <a:s>dose</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> is </a:s>
                                    <a:s r="411">
                                       <a:s>FHIR.Range</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>&#xd;
            then </a:s>
                                 <a:s r="416">
                                    <a:s>ToQuantity(</a:s>
                                    <a:s r="415">
                                       <a:s r="414">
                                          <a:s r="413">
                                             <a:s>dosageInstruction</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="414">
                                             <a:s>dose</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="415">
                                          <a:s>high</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s>&#xd;
            else </a:s>
                                 <a:s r="419">
                                    <a:s>ToQuantity(</a:s>
                                    <a:s r="418">
                                       <a:s r="417">
                                          <a:s>dosageInstruction</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="418">
                                          <a:s>dose</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>dosesPerDay: </a:s>
                              <a:s r="426">
                                 <a:s>Coalesce(</a:s>
                                 <a:s r="424">
                                    <a:s r="421">
                                       <a:s>OMTKLogic</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="424">
                                       <a:s>ToDaily(</a:s>
                                       <a:s r="422">
                                          <a:s>frequency</a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="423">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="425">, 1.0)</a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
    }</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="429" xsi:type="Query">
            <source localId="278" alias="O">
               <expression localId="277" name="Orders" xsi:type="OperandRef"/>
            </source>
            <let localId="285" identifier="rxNormCode">
               <expression localId="284" name="ToCode" xsi:type="FunctionRef">
                  <operand localId="283" xsi:type="Indexer">
                     <operand localId="281" path="coding" xsi:type="Property">
                        <source localId="280" path="medication" scope="O" xsi:type="Property"/>
                     </operand>
                     <operand localId="282" valueType="t:Integer" value="0" xsi:type="Literal"/>
                  </operand>
               </expression>
            </let>
            <let localId="289" identifier="medicationName">
               <expression localId="288" name="GetMedicationName" libraryName="OMTKLogic" xsi:type="FunctionRef">
                  <operand localId="287" name="rxNormCode" xsi:type="QueryLetRef"/>
               </expression>
            </let>
            <let localId="294" identifier="dosageInstruction">
               <expression localId="293" xsi:type="Indexer">
                  <operand localId="291" path="dosageInstruction" scope="O" xsi:type="Property"/>
                  <operand localId="292" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </expression>
            </let>
            <let localId="298" identifier="repeat">
               <expression localId="297" path="repeat" xsi:type="Property">
                  <source localId="296" path="timing" xsi:type="Property">
                     <source localId="295" name="dosageInstruction" xsi:type="QueryLetRef"/>
                  </source>
               </expression>
            </let>
            <let localId="306" identifier="frequency">
               <expression localId="305" xsi:type="Coalesce">
                  <operand localId="301" path="value" xsi:type="Property">
                     <source localId="300" path="frequencyMax" xsi:type="Property">
                        <source localId="299" name="repeat" xsi:type="QueryLetRef"/>
                     </source>
                  </operand>
                  <operand localId="304" path="value" xsi:type="Property">
                     <source localId="303" path="frequency" xsi:type="Property">
                        <source localId="302" name="repeat" xsi:type="QueryLetRef"/>
                     </source>
                  </operand>
               </expression>
            </let>
            <let localId="314" identifier="period">
               <expression localId="313" classType="t:Quantity" xsi:type="Instance">
                  <element name="value">
                     <value localId="309" path="value" xsi:type="Property">
                        <source localId="308" path="period" xsi:type="Property">
                           <source localId="307" name="repeat" xsi:type="QueryLetRef"/>
                        </source>
                     </value>
                  </element>
                  <element name="unit">
                     <value localId="312" path="value" xsi:type="Property">
                        <source localId="311" path="periodUnit" xsi:type="Property">
                           <source localId="310" name="repeat" xsi:type="QueryLetRef"/>
                        </source>
                     </value>
                  </element>
               </expression>
            </let>
            <let localId="354" identifier="doseDescription">
               <expression localId="353" xsi:type="Coalesce">
                  <operand localId="351" xsi:type="If">
                     <condition asType="t:Boolean" xsi:type="As">
                        <operand localId="318" xsi:type="Is">
                           <operand localId="316" path="dose" xsi:type="Property">
                              <source localId="315" name="dosageInstruction" xsi:type="QueryLetRef"/>
                           </operand>
                           <isTypeSpecifier localId="317" name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                     </condition>
                     <then localId="346" xsi:type="Concatenate">
                        <operand localId="340" xsi:type="Concatenate">
                           <operand localId="334" xsi:type="Concatenate">
                              <operand localId="332" xsi:type="ToString">
                                 <operand localId="331" name="ToQuantity" xsi:type="FunctionRef">
                                    <operand localId="321" path="low" xsi:type="Property">
                                       <source localId="320" path="dose" xsi:type="Property">
                                          <source localId="319" name="dosageInstruction" xsi:type="QueryLetRef"/>
                                       </source>
                                    </operand>
                                 </operand>
                              </operand>
                              <operand localId="333" valueType="t:String" value="-" xsi:type="Literal"/>
                           </operand>
                           <operand localId="339" xsi:type="ToString">
                              <operand localId="338" name="ToQuantity" xsi:type="FunctionRef">
                                 <operand localId="337" path="high" xsi:type="Property">
                                    <source localId="336" path="dose" xsi:type="Property">
                                       <source localId="335" name="dosageInstruction" xsi:type="QueryLetRef"/>
                                    </source>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                        <operand localId="345" path="value" xsi:type="Property">
                           <source localId="344" path="unit" xsi:type="Property">
                              <source localId="343" path="high" xsi:type="Property">
                                 <source localId="342" path="dose" xsi:type="Property">
                                    <source localId="341" name="dosageInstruction" xsi:type="QueryLetRef"/>
                                 </source>
                              </source>
                           </source>
                        </operand>
                     </then>
                     <else localId="350" xsi:type="ToString">
                        <operand localId="349" name="ToQuantity" xsi:type="FunctionRef">
                           <operand asType="fhir:Quantity" xsi:type="As">
                              <operand localId="348" path="dose" xsi:type="Property">
                                 <source localId="347" name="dosageInstruction" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                     </else>
                  </operand>
                  <operand localId="352" valueType="t:String" value="" xsi:type="Literal"/>
               </expression>
            </let>
            <let localId="372" identifier="frequencyDescription">
               <expression localId="371" xsi:type="Concatenate">
                  <operand localId="360" xsi:type="ToString">
                     <operand localId="359" path="value" xsi:type="Property">
                        <source localId="358" path="frequency" xsi:type="Property">
                           <source localId="357" path="repeat" xsi:type="Property">
                              <source localId="356" path="timing" xsi:type="Property">
                                 <source localId="355" name="dosageInstruction" xsi:type="QueryLetRef"/>
                              </source>
                           </source>
                        </source>
                     </operand>
                  </operand>
                  <operand localId="370" xsi:type="Coalesce">
                     <operand localId="368" xsi:type="Concatenate">
                        <operand localId="361" valueType="t:String" value="-" xsi:type="Literal"/>
                        <operand localId="367" xsi:type="ToString">
                           <operand localId="366" path="value" xsi:type="Property">
                              <source localId="365" path="frequencyMax" xsi:type="Property">
                                 <source localId="364" path="repeat" xsi:type="Property">
                                    <source localId="363" path="timing" xsi:type="Property">
                                       <source localId="362" name="dosageInstruction" xsi:type="QueryLetRef"/>
                                    </source>
                                 </source>
                              </source>
                           </operand>
                        </operand>
                     </operand>
                     <operand localId="369" valueType="t:String" value="" xsi:type="Literal"/>
                  </operand>
               </expression>
            </let>
            <return localId="428">
               <expression localId="427" xsi:type="Tuple">
                  <element name="rxNormCode">
                     <value localId="373" name="rxNormCode" xsi:type="QueryLetRef"/>
                  </element>
                  <element name="isDraft">
                     <value localId="378" xsi:type="Equal">
                        <operand localId="376" path="value" xsi:type="Property">
                           <source localId="375" path="status" scope="O" xsi:type="Property"/>
                        </operand>
                        <operand localId="377" valueType="t:String" value="draft" xsi:type="Literal"/>
                     </value>
                  </element>
                  <element name="isPRN">
                     <value localId="381" path="value" xsi:type="Property">
                        <source localId="380" path="asNeeded" xsi:type="Property">
                           <source localId="379" name="dosageInstruction" xsi:type="QueryLetRef"/>
                        </source>
                     </value>
                  </element>
                  <element name="prescription">
                     <value localId="408" xsi:type="If">
                        <condition asType="t:Boolean" xsi:type="As">
                           <operand localId="384" xsi:type="Not">
                              <operand xsi:type="IsNull">
                                 <operand localId="383" path="text" xsi:type="Property">
                                    <source localId="382" name="dosageInstruction" xsi:type="QueryLetRef"/>
                                 </operand>
                              </operand>
                           </operand>
                        </condition>
                        <then localId="391" xsi:type="Concatenate">
                           <operand localId="387" xsi:type="Concatenate">
                              <operand localId="385" name="medicationName" xsi:type="QueryLetRef"/>
                              <operand localId="386" valueType="t:String" value=" " xsi:type="Literal"/>
                           </operand>
                           <operand localId="390" path="value" xsi:type="Property">
                              <source localId="389" path="text" xsi:type="Property">
                                 <source localId="388" name="dosageInstruction" xsi:type="QueryLetRef"/>
                              </source>
                           </operand>
                        </then>
                        <else localId="407" xsi:type="Concatenate">
                           <operand localId="400" xsi:type="Concatenate">
                              <operand localId="398" xsi:type="Concatenate">
                                 <operand localId="396" xsi:type="Concatenate">
                                    <operand localId="394" xsi:type="Concatenate">
                                       <operand localId="392" name="medicationName" xsi:type="QueryLetRef"/>
                                       <operand localId="393" valueType="t:String" value=" " xsi:type="Literal"/>
                                    </operand>
                                    <operand localId="395" name="doseDescription" xsi:type="QueryLetRef"/>
                                 </operand>
                                 <operand localId="397" valueType="t:String" value=" q" xsi:type="Literal"/>
                              </operand>
                              <operand localId="399" name="frequencyDescription" xsi:type="QueryLetRef"/>
                           </operand>
                           <operand localId="406" xsi:type="If">
                              <condition asType="t:Boolean" xsi:type="As">
                                 <operand localId="403" path="value" xsi:type="Property">
                                    <source localId="402" path="asNeeded" xsi:type="Property">
                                       <source localId="401" name="dosageInstruction" xsi:type="QueryLetRef"/>
                                    </source>
                                 </operand>
                              </condition>
                              <then localId="404" valueType="t:String" value=" PRN" xsi:type="Literal"/>
                              <else localId="405" valueType="t:String" value="" xsi:type="Literal"/>
                           </operand>
                        </else>
                     </value>
                  </element>
                  <element name="dose">
                     <value localId="420" xsi:type="If">
                        <condition asType="t:Boolean" xsi:type="As">
                           <operand localId="412" xsi:type="Is">
                              <operand localId="410" path="dose" xsi:type="Property">
                                 <source localId="409" name="dosageInstruction" xsi:type="QueryLetRef"/>
                              </operand>
                              <isTypeSpecifier localId="411" name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
                           </operand>
                        </condition>
                        <then localId="416" name="ToQuantity" xsi:type="FunctionRef">
                           <operand localId="415" path="high" xsi:type="Property">
                              <source localId="414" path="dose" xsi:type="Property">
                                 <source localId="413" name="dosageInstruction" xsi:type="QueryLetRef"/>
                              </source>
                           </operand>
                        </then>
                        <else localId="419" name="ToQuantity" xsi:type="FunctionRef">
                           <operand asType="fhir:Quantity" xsi:type="As">
                              <operand localId="418" path="dose" xsi:type="Property">
                                 <source localId="417" name="dosageInstruction" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </else>
                     </value>
                  </element>
                  <element name="dosesPerDay">
                     <value localId="426" xsi:type="Coalesce">
                        <operand localId="424" name="ToDaily" libraryName="OMTKLogic" xsi:type="FunctionRef">
                           <operand localId="422" name="frequency" xsi:type="QueryLetRef"/>
                           <operand localId="423" name="period" xsi:type="QueryLetRef"/>
                        </operand>
                        <operand localId="425" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
                     </value>
                  </element>
               </expression>
            </return>
         </expression>
         <operand name="Orders">
            <operandTypeSpecifier localId="276" xsi:type="ListTypeSpecifier">
               <elementType localId="275" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="465" name="MME" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="465">
               <a:s>define function MME(prescriptions </a:s>
               <a:s r="432">
                  <a:s>List&lt;</a:s>
                  <a:s r="431">
                     <a:s>MedicationRequest</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="464">
                  <a:s r="464">
                     <a:s>
                        <a:s r="435">
                           <a:s r="434">
                              <a:s>(</a:s>
                              <a:s r="434">
                                 <a:s>Prescriptions(</a:s>
                                 <a:s r="433">
                                    <a:s>prescriptions</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s> P</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="447">
                           <a:s>mme: </a:s>
                           <a:s r="446">
                              <a:s>SingletonFrom(</a:s>
                              <a:s r="445">
                                 <a:s r="436">
                                    <a:s>OMTKLogic</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="445">
                                    <a:s>CalculateMMEs(</a:s>
                                    <a:s r="444">
                                       <a:s>{ </a:s>
                                       <a:s r="443">
                                          <a:s>{ </a:s>
                                          <a:s>
                                             <a:s>rxNormCode: </a:s>
                                             <a:s r="438">
                                                <a:s r="437">
                                                   <a:s>P</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="438">
                                                   <a:s>rxNormCode</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s>
                                             <a:s>doseQuantity: </a:s>
                                             <a:s r="440">
                                                <a:s r="439">
                                                   <a:s>P</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="440">
                                                   <a:s>dose</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s>
                                             <a:s>dosesPerDay: </a:s>
                                             <a:s r="442">
                                                <a:s r="441">
                                                   <a:s>P</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="442">
                                                   <a:s>dosesPerDay</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> }</a:s>
                                       </a:s>
                                       <a:s> }</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="463">
                        <a:s>return </a:s>
                        <a:s r="462">
                           <a:s>{&#xd;
      </a:s>
                           <a:s>
                              <a:s>rxNormCode: </a:s>
                              <a:s r="449">
                                 <a:s r="448">
                                    <a:s>P</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="449">
                                    <a:s>rxNormCode</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>isDraft: </a:s>
                              <a:s r="451">
                                 <a:s r="450">
                                    <a:s>P</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="451">
                                    <a:s>isDraft</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>isPRN: </a:s>
                              <a:s r="453">
                                 <a:s r="452">
                                    <a:s>P</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="453">
                                    <a:s>isPRN</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>prescription: </a:s>
                              <a:s r="455">
                                 <a:s r="454">
                                    <a:s>P</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="455">
                                    <a:s>prescription</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>dailyDose: </a:s>
                              <a:s r="457">
                                 <a:s r="456">
                                    <a:s>mme</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="457">
                                    <a:s>dailyDoseDescription</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>conversionFactor: </a:s>
                              <a:s r="459">
                                 <a:s r="458">
                                    <a:s>mme</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="459">
                                    <a:s>conversionFactor</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,&#xd;
      </a:s>
                           <a:s>
                              <a:s>mme: </a:s>
                              <a:s r="461">
                                 <a:s r="460">
                                    <a:s>mme</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="461">
                                    <a:s>mme</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
    }</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="464" xsi:type="Query">
            <source localId="435" alias="P">
               <expression localId="434" name="Prescriptions" xsi:type="FunctionRef">
                  <operand localId="433" name="prescriptions" xsi:type="OperandRef"/>
               </expression>
            </source>
            <let localId="447" identifier="mme">
               <expression localId="446" xsi:type="SingletonFrom">
                  <operand localId="445" name="CalculateMMEs" libraryName="OMTKLogic" xsi:type="FunctionRef">
                     <operand localId="444" xsi:type="List">
                        <element localId="443" xsi:type="Tuple">
                           <element name="rxNormCode">
                              <value localId="438" path="rxNormCode" scope="P" xsi:type="Property"/>
                           </element>
                           <element name="doseQuantity">
                              <value localId="440" path="dose" scope="P" xsi:type="Property"/>
                           </element>
                           <element name="dosesPerDay">
                              <value localId="442" path="dosesPerDay" scope="P" xsi:type="Property"/>
                           </element>
                        </element>
                     </operand>
                  </operand>
               </expression>
            </let>
            <return localId="463">
               <expression localId="462" xsi:type="Tuple">
                  <element name="rxNormCode">
                     <value localId="449" path="rxNormCode" scope="P" xsi:type="Property"/>
                  </element>
                  <element name="isDraft">
                     <value localId="451" path="isDraft" scope="P" xsi:type="Property"/>
                  </element>
                  <element name="isPRN">
                     <value localId="453" path="isPRN" scope="P" xsi:type="Property"/>
                  </element>
                  <element name="prescription">
                     <value localId="455" path="prescription" scope="P" xsi:type="Property"/>
                  </element>
                  <element name="dailyDose">
                     <value localId="457" path="dailyDoseDescription" xsi:type="Property">
                        <source localId="456" name="mme" xsi:type="QueryLetRef"/>
                     </value>
                  </element>
                  <element name="conversionFactor">
                     <value localId="459" path="conversionFactor" xsi:type="Property">
                        <source localId="458" name="mme" xsi:type="QueryLetRef"/>
                     </value>
                  </element>
                  <element name="mme">
                     <value localId="461" path="mme" xsi:type="Property">
                        <source localId="460" name="mme" xsi:type="QueryLetRef"/>
                     </value>
                  </element>
               </expression>
            </return>
         </expression>
         <operand name="prescriptions">
            <operandTypeSpecifier localId="432" xsi:type="ListTypeSpecifier">
               <elementType localId="431" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="479" name="TotalMME" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="479">
               <a:s>define function TotalMME(prescriptions </a:s>
               <a:s r="467">
                  <a:s>List&lt;</a:s>
                  <a:s r="466">
                     <a:s>MedicationRequest</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="478">
                  <a:s r="478">
                     <a:s>System.Quantity {&#xd;
    </a:s>
                     <a:s>
                        <a:s>value: </a:s>
                        <a:s r="476">
                           <a:s>Sum(</a:s>
                           <a:s r="475">
                              <a:s>
                                 <a:s r="470">
                                    <a:s r="469">
                                       <a:s>(</a:s>
                                       <a:s r="469">
                                          <a:s>MME(</a:s>
                                          <a:s r="468">
                                             <a:s>prescriptions</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s> M</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> </a:s>
                              <a:s r="474">
                                 <a:s>return </a:s>
                                 <a:s r="473">
                                    <a:s r="472">
                                       <a:s r="471">
                                          <a:s>M</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="472">
                                          <a:s>mme</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="473">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s>,&#xd;
    </a:s>
                     <a:s>
                        <a:s>unit: </a:s>
                        <a:s r="477">
                           <a:s>'mg/d'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
  }</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="478" classType="t:Quantity" xsi:type="Instance">
            <element name="value">
               <value localId="476" xsi:type="Sum">
                  <source localId="475" xsi:type="Query">
                     <source localId="470" alias="M">
                        <expression localId="469" name="MME" xsi:type="FunctionRef">
                           <operand localId="468" name="prescriptions" xsi:type="OperandRef"/>
                        </expression>
                     </source>
                     <return localId="474">
                        <expression localId="473" path="value" xsi:type="Property">
                           <source localId="472" path="mme" scope="M" xsi:type="Property"/>
                        </expression>
                     </return>
                  </source>
               </value>
            </element>
            <element name="unit">
               <value localId="477" valueType="t:String" value="mg/d" xsi:type="Literal"/>
            </element>
         </expression>
         <operand name="prescriptions">
            <operandTypeSpecifier localId="467" xsi:type="ListTypeSpecifier">
               <elementType localId="466" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="565" name="GetPeriodDays" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="565">
               <a:s>define function GetPeriodDays(value </a:s>
               <a:s r="512">
                  <a:s>System.String</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="564">
                  <a:s r="564">
                     <a:s>case&#xd;
    </a:s>
                     <a:s r="517">
                        <a:s>when </a:s>
                        <a:s r="515">
                           <a:s r="513">
                              <a:s>value</a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="514">
                              <a:s>'a'</a:s>
                           </a:s>
                        </a:s>
                        <a:s r="516"> then 365.0</a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="522">
                        <a:s>when </a:s>
                        <a:s r="520">
                           <a:s r="518">
                              <a:s>value</a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="519">
                              <a:s>'mo'</a:s>
                           </a:s>
                        </a:s>
                        <a:s r="521"> then 30.0</a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="529">
                        <a:s>when </a:s>
                        <a:s r="525">
                           <a:s r="523">
                              <a:s>value</a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="524">
                              <a:s>'h'</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="528">
                           <a:s r="526">1.0/24.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="538">
                        <a:s>when </a:s>
                        <a:s r="532">
                           <a:s r="530">
                              <a:s>value</a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="531">
                              <a:s>'min'</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="537">
                           <a:s r="535">
                              <a:s r="533">1.0/24.0</a:s>
                           </a:s>
                           <a:s r="536">*60.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="549">
                        <a:s>when </a:s>
                        <a:s r="541">
                           <a:s r="539">
                              <a:s>value</a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="540">
                              <a:s>'s'</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="548">
                           <a:s r="546">
                              <a:s r="544">
                                 <a:s r="542">1.0/24.0</a:s>
                              </a:s>
                              <a:s r="545">*60.0</a:s>
                           </a:s>
                           <a:s r="547">*60.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="562">
                        <a:s>when </a:s>
                        <a:s r="552">
                           <a:s r="550">
                              <a:s>value</a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="551">
                              <a:s>'ms'</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="561">
                           <a:s r="559">
                              <a:s r="557">
                                 <a:s r="555">
                                    <a:s r="553">1.0/24.0</a:s>
                                 </a:s>
                                 <a:s r="556">*60.0</a:s>
                              </a:s>
                              <a:s r="558">*60.0</a:s>
                           </a:s>
                           <a:s r="560">*1000.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s r="563">&#xd;
    else 1.0&#xd;
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="564" xsi:type="Case">
            <caseItem localId="517">
               <when localId="515" xsi:type="Equal">
                  <operand localId="513" name="value" xsi:type="OperandRef"/>
                  <operand localId="514" valueType="t:String" value="a" xsi:type="Literal"/>
               </when>
               <then localId="516" valueType="t:Decimal" value="365.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="522">
               <when localId="520" xsi:type="Equal">
                  <operand localId="518" name="value" xsi:type="OperandRef"/>
                  <operand localId="519" valueType="t:String" value="mo" xsi:type="Literal"/>
               </when>
               <then localId="521" valueType="t:Decimal" value="30.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="529">
               <when localId="525" xsi:type="Equal">
                  <operand localId="523" name="value" xsi:type="OperandRef"/>
                  <operand localId="524" valueType="t:String" value="h" xsi:type="Literal"/>
               </when>
               <then localId="528" xsi:type="Divide">
                  <operand localId="526" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
                  <operand localId="527" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="538">
               <when localId="532" xsi:type="Equal">
                  <operand localId="530" name="value" xsi:type="OperandRef"/>
                  <operand localId="531" valueType="t:String" value="min" xsi:type="Literal"/>
               </when>
               <then localId="537" xsi:type="Multiply">
                  <operand localId="535" xsi:type="Divide">
                     <operand localId="533" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
                     <operand localId="534" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                  </operand>
                  <operand localId="536" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="549">
               <when localId="541" xsi:type="Equal">
                  <operand localId="539" name="value" xsi:type="OperandRef"/>
                  <operand localId="540" valueType="t:String" value="s" xsi:type="Literal"/>
               </when>
               <then localId="548" xsi:type="Multiply">
                  <operand localId="546" xsi:type="Multiply">
                     <operand localId="544" xsi:type="Divide">
                        <operand localId="542" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
                        <operand localId="543" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     </operand>
                     <operand localId="545" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                  </operand>
                  <operand localId="547" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="562">
               <when localId="552" xsi:type="Equal">
                  <operand localId="550" name="value" xsi:type="OperandRef"/>
                  <operand localId="551" valueType="t:String" value="ms" xsi:type="Literal"/>
               </when>
               <then localId="561" xsi:type="Multiply">
                  <operand localId="559" xsi:type="Multiply">
                     <operand localId="557" xsi:type="Multiply">
                        <operand localId="555" xsi:type="Divide">
                           <operand localId="553" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
                           <operand localId="554" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        </operand>
                        <operand localId="556" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                     </operand>
                     <operand localId="558" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                  </operand>
                  <operand localId="560" valueType="t:Decimal" value="1000.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <else localId="563" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
         </expression>
         <operand name="value">
            <operandTypeSpecifier localId="512" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="697" name="GetDurationInDays" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="697">
               <a:s>define function GetDurationInDays(value </a:s>
               <a:s r="591">
                  <a:s>FHIR.Duration</a:s>
               </a:s>
               <a:s>):&#xd;
    </a:s>
               <a:s r="696">
                  <a:s r="696">
                     <a:s>case&#xd;
      </a:s>
                     <a:s r="602">
                        <a:s>when </a:s>
                        <a:s r="596">
                           <a:s>StartsWith(</a:s>
                           <a:s r="594">
                              <a:s r="593">
                                 <a:s r="592">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="593">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="594">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="595">
                              <a:s>'a'</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="601">
                           <a:s r="599">
                              <a:s r="598">
                                 <a:s r="597">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="598">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="599">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="600"> * 365.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
      </a:s>
                     <a:s r="613">
                        <a:s>when </a:s>
                        <a:s r="607">
                           <a:s>StartsWith(</a:s>
                           <a:s r="605">
                              <a:s r="604">
                                 <a:s r="603">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="604">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="605">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="606">
                              <a:s>'mo'</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="612">
                           <a:s r="610">
                              <a:s r="609">
                                 <a:s r="608">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="609">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="610">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="611"> * 30.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
      </a:s>
                     <a:s r="624">
                        <a:s>when </a:s>
                        <a:s r="618">
                           <a:s>StartsWith(</a:s>
                           <a:s r="616">
                              <a:s r="615">
                                 <a:s r="614">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="615">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="616">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="617">
                              <a:s>'wk'</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="623">
                           <a:s r="621">
                              <a:s r="620">
                                 <a:s r="619">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="620">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="621">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="622"> * 7.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
      </a:s>
                     <a:s r="633">
                        <a:s>when </a:s>
                        <a:s r="629">
                           <a:s>StartsWith(</a:s>
                           <a:s r="627">
                              <a:s r="626">
                                 <a:s r="625">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="626">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="627">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="628">
                              <a:s>'d'</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="632">
                           <a:s r="631">
                              <a:s r="630">
                                 <a:s>value</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="631">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="632">
                              <a:s>value</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
      </a:s>
                     <a:s r="644">
                        <a:s>when </a:s>
                        <a:s r="638">
                           <a:s>StartsWith(</a:s>
                           <a:s r="636">
                              <a:s r="635">
                                 <a:s r="634">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="635">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="636">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="637">
                              <a:s>'h'</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="643">
                           <a:s r="641">
                              <a:s r="640">
                                 <a:s r="639">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="640">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="641">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="642"> / 24.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
      </a:s>
                     <a:s r="657">
                        <a:s>when </a:s>
                        <a:s r="649">
                           <a:s>StartsWith(</a:s>
                           <a:s r="647">
                              <a:s r="646">
                                 <a:s r="645">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="646">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="647">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="648">
                              <a:s>'min'</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="656">
                           <a:s r="654">
                              <a:s r="652">
                                 <a:s r="651">
                                    <a:s r="650">
                                       <a:s>value</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="651">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="652">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="653"> / 60.0</a:s>
                           </a:s>
                           <a:s r="655"> / 24.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
      </a:s>
                     <a:s r="672">
                        <a:s>when </a:s>
                        <a:s r="662">
                           <a:s>StartsWith(</a:s>
                           <a:s r="660">
                              <a:s r="659">
                                 <a:s r="658">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="659">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="660">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="661">
                              <a:s>'s'</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="671">
                           <a:s r="669">
                              <a:s r="667">
                                 <a:s r="665">
                                    <a:s r="664">
                                       <a:s r="663">
                                          <a:s>value</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="664">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="665">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="666"> / 60.0</a:s>
                              </a:s>
                              <a:s r="668"> / 60.0</a:s>
                           </a:s>
                           <a:s r="670"> / 24.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
      </a:s>
                     <a:s r="689">
                        <a:s>when </a:s>
                        <a:s r="677">
                           <a:s>StartsWith(</a:s>
                           <a:s r="675">
                              <a:s r="674">
                                 <a:s r="673">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="674">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="675">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="676">
                              <a:s>'ms'</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="688">
                           <a:s r="686">
                              <a:s r="684">
                                 <a:s r="682">
                                    <a:s r="680">
                                       <a:s r="679">
                                          <a:s r="678">
                                             <a:s>value</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="679">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="680">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="681"> / 60.0</a:s>
                                 </a:s>
                                 <a:s r="683"> / 60.0</a:s>
                              </a:s>
                              <a:s r="685"> / 24.0</a:s>
                           </a:s>
                           <a:s r="687"> / 1000.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
      else </a:s>
                     <a:s r="695">
                        <a:s r="690">Message(1000, true, </a:s>
                        <a:s r="692">
                           <a:s>'Undefined'</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="693">
                           <a:s>'Error'</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="694">
                           <a:s>'Unsupported duration unit'</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>&#xd;
    end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="696" xsi:type="Case">
            <caseItem localId="602">
               <when localId="596" xsi:type="StartsWith">
                  <operand localId="594" path="value" xsi:type="Property">
                     <source localId="593" path="unit" xsi:type="Property">
                        <source localId="592" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="595" valueType="t:String" value="a" xsi:type="Literal"/>
               </when>
               <then localId="601" xsi:type="Multiply">
                  <operand localId="599" path="value" xsi:type="Property">
                     <source localId="598" path="value" xsi:type="Property">
                        <source localId="597" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="600" valueType="t:Decimal" value="365.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="613">
               <when localId="607" xsi:type="StartsWith">
                  <operand localId="605" path="value" xsi:type="Property">
                     <source localId="604" path="unit" xsi:type="Property">
                        <source localId="603" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="606" valueType="t:String" value="mo" xsi:type="Literal"/>
               </when>
               <then localId="612" xsi:type="Multiply">
                  <operand localId="610" path="value" xsi:type="Property">
                     <source localId="609" path="value" xsi:type="Property">
                        <source localId="608" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="611" valueType="t:Decimal" value="30.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="624">
               <when localId="618" xsi:type="StartsWith">
                  <operand localId="616" path="value" xsi:type="Property">
                     <source localId="615" path="unit" xsi:type="Property">
                        <source localId="614" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="617" valueType="t:String" value="wk" xsi:type="Literal"/>
               </when>
               <then localId="623" xsi:type="Multiply">
                  <operand localId="621" path="value" xsi:type="Property">
                     <source localId="620" path="value" xsi:type="Property">
                        <source localId="619" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="622" valueType="t:Decimal" value="7.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="633">
               <when localId="629" xsi:type="StartsWith">
                  <operand localId="627" path="value" xsi:type="Property">
                     <source localId="626" path="unit" xsi:type="Property">
                        <source localId="625" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="628" valueType="t:String" value="d" xsi:type="Literal"/>
               </when>
               <then localId="632" path="value" xsi:type="Property">
                  <source localId="631" path="value" xsi:type="Property">
                     <source localId="630" name="value" xsi:type="OperandRef"/>
                  </source>
               </then>
            </caseItem>
            <caseItem localId="644">
               <when localId="638" xsi:type="StartsWith">
                  <operand localId="636" path="value" xsi:type="Property">
                     <source localId="635" path="unit" xsi:type="Property">
                        <source localId="634" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="637" valueType="t:String" value="h" xsi:type="Literal"/>
               </when>
               <then localId="643" xsi:type="Divide">
                  <operand localId="641" path="value" xsi:type="Property">
                     <source localId="640" path="value" xsi:type="Property">
                        <source localId="639" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="642" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="657">
               <when localId="649" xsi:type="StartsWith">
                  <operand localId="647" path="value" xsi:type="Property">
                     <source localId="646" path="unit" xsi:type="Property">
                        <source localId="645" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="648" valueType="t:String" value="min" xsi:type="Literal"/>
               </when>
               <then localId="656" xsi:type="Divide">
                  <operand localId="654" xsi:type="Divide">
                     <operand localId="652" path="value" xsi:type="Property">
                        <source localId="651" path="value" xsi:type="Property">
                           <source localId="650" name="value" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                     <operand localId="653" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                  </operand>
                  <operand localId="655" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="672">
               <when localId="662" xsi:type="StartsWith">
                  <operand localId="660" path="value" xsi:type="Property">
                     <source localId="659" path="unit" xsi:type="Property">
                        <source localId="658" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="661" valueType="t:String" value="s" xsi:type="Literal"/>
               </when>
               <then localId="671" xsi:type="Divide">
                  <operand localId="669" xsi:type="Divide">
                     <operand localId="667" xsi:type="Divide">
                        <operand localId="665" path="value" xsi:type="Property">
                           <source localId="664" path="value" xsi:type="Property">
                              <source localId="663" name="value" xsi:type="OperandRef"/>
                           </source>
                        </operand>
                        <operand localId="666" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                     </operand>
                     <operand localId="668" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                  </operand>
                  <operand localId="670" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="689">
               <when localId="677" xsi:type="StartsWith">
                  <operand localId="675" path="value" xsi:type="Property">
                     <source localId="674" path="unit" xsi:type="Property">
                        <source localId="673" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="676" valueType="t:String" value="ms" xsi:type="Literal"/>
               </when>
               <then localId="688" xsi:type="Divide">
                  <operand localId="686" xsi:type="Divide">
                     <operand localId="684" xsi:type="Divide">
                        <operand localId="682" xsi:type="Divide">
                           <operand localId="680" path="value" xsi:type="Property">
                              <source localId="679" path="value" xsi:type="Property">
                                 <source localId="678" name="value" xsi:type="OperandRef"/>
                              </source>
                           </operand>
                           <operand localId="681" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                        </operand>
                        <operand localId="683" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                     </operand>
                     <operand localId="685" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                  </operand>
                  <operand localId="687" valueType="t:Decimal" value="1000.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <else xsi:type="ToDecimal">
               <operand localId="695" xsi:type="Message">
                  <source localId="690" valueType="t:Integer" value="1000" xsi:type="Literal"/>
                  <condition localId="691" valueType="t:Boolean" value="true" xsi:type="Literal"/>
                  <code localId="692" valueType="t:String" value="Undefined" xsi:type="Literal"/>
                  <severity localId="693" valueType="t:String" value="Error" xsi:type="Literal"/>
                  <message localId="694" valueType="t:String" value="Unsupported duration unit" xsi:type="Literal"/>
               </operand>
            </else>
         </expression>
         <operand name="value">
            <operandTypeSpecifier localId="591" name="fhir:Duration" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="747" name="ProbableDaysInRange" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="747">
               <a:s>define function ProbableDaysInRange(Orders </a:s>
               <a:s r="481">
                  <a:s>List&lt;</a:s>
                  <a:s r="480">
                     <a:s>MedicationRequest</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>, daysPast </a:s>
               <a:s r="482">
                  <a:s>Integer</a:s>
               </a:s>
               <a:s>, numDaysInDaysPast </a:s>
               <a:s r="483">
                  <a:s>Integer</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="746">
                  <a:s r="746">
                     <a:s>
                        <a:s r="485">
                           <a:s r="484">
                              <a:s>
                                 <a:s>Orders</a:s>
                              </a:s>
                           </a:s>
                           <a:s> orders</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s>
                        <a:s>let&#xd;
      </a:s>
                        <a:s r="494">
                           <a:s>frequency: </a:s>
                           <a:s r="493">
                              <a:s r="492">
                                 <a:s r="491">
                                    <a:s r="490">
                                       <a:s r="489">
                                          <a:s r="487">
                                             <a:s r="486">
                                                <a:s>orders</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="487">
                                                <a:s>dosageInstruction</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s r="488">[0]</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="490">
                                          <a:s>timing</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="491">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="492">
                                    <a:s>frequency</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="493">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="503">
                           <a:s>period: </a:s>
                           <a:s r="502">
                              <a:s r="501">
                                 <a:s r="500">
                                    <a:s r="499">
                                       <a:s r="498">
                                          <a:s r="496">
                                             <a:s r="495">
                                                <a:s>orders</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="496">
                                                <a:s>dosageInstruction</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s r="497">[0]</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="499">
                                          <a:s>timing</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="500">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="501">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="502">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="567">
                           <a:s>periodDays: </a:s>
                           <a:s r="566">
                              <a:s>GetPeriodDays(</a:s>
                              <a:s r="511">
                                 <a:s r="510">
                                    <a:s r="509">
                                       <a:s r="508">
                                          <a:s r="507">
                                             <a:s r="505">
                                                <a:s r="504">
                                                   <a:s>orders</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="505">
                                                   <a:s>dosageInstruction</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s r="506">[0]</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="508">
                                             <a:s>timing</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="509">
                                          <a:s>repeat</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="510">
                                       <a:s>periodUnit</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="511">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="582">
                           <a:s>dosesPerDay:&#xd;
        </a:s>
                           <a:s r="581">
                              <a:s>if </a:s>
                              <a:s r="574">
                                 <a:s r="572">
                                    <a:s>(</a:s>
                                    <a:s r="572">
                                       <a:s r="568">
                                          <a:s>frequency</a:s>
                                       </a:s>
                                       <a:s> / </a:s>
                                       <a:s r="571">
                                          <a:s>(</a:s>
                                          <a:s r="571">
                                             <a:s r="569">
                                                <a:s>period</a:s>
                                             </a:s>
                                             <a:s> * </a:s>
                                             <a:s r="570">
                                                <a:s>periodDays</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s r="573"> >= 1.0</a:s>
                              </a:s>
                              <a:s r="575">&#xd;
        then 1.0&#xd;
        else </a:s>
                              <a:s r="580">
                                 <a:s r="576">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> / </a:s>
                                 <a:s r="579">
                                    <a:s>(</a:s>
                                    <a:s r="579">
                                       <a:s r="577">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s> * </a:s>
                                       <a:s r="578">
                                          <a:s>periodDays</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="587">
                           <a:s>repeat: </a:s>
                           <a:s r="586">
                              <a:s r="585">
                                 <a:s r="584">
                                    <a:s r="583">
                                       <a:s>orders</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="584">
                                       <a:s>dispenseRequest</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="585">
                                    <a:s>numberOfRepeatsAllowed</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="586">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="699">
                           <a:s>supplyDuration: </a:s>
                           <a:s r="698">
                              <a:s>GetDurationInDays(</a:s>
                              <a:s r="590">
                                 <a:s r="589">
                                    <a:s r="588">
                                       <a:s>orders</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="589">
                                       <a:s>dispenseRequest</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="590">
                                    <a:s>expectedSupplyDuration</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="707">
                           <a:s>validityPeriod: </a:s>
                           <a:s r="706">
                              <a:s>days between </a:s>
                              <a:s r="704">
                                 <a:s r="703">
                                    <a:s r="702">
                                       <a:s r="701">
                                          <a:s r="700">
                                             <a:s>orders</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="701">
                                             <a:s>dispenseRequest</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="702">
                                          <a:s>validityPeriod</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="703">
                                       <a:s>&quot;start&quot;</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="704">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> and </a:s>
                              <a:s r="705">
                                 <a:s>Today()</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,&#xd;
      </a:s>
                        <a:s r="724">
                           <a:s>endDifference:&#xd;
        </a:s>
                           <a:s r="723">
                              <a:s>if </a:s>
                              <a:s r="714">
                                 <a:s r="712">
                                    <a:s r="711">
                                       <a:s r="710">
                                          <a:s r="709">
                                             <a:s r="708">
                                                <a:s>orders</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="709">
                                                <a:s>dispenseRequest</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="710">
                                             <a:s>validityPeriod</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="711">
                                          <a:s>&quot;end&quot;</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="712">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> &lt; </a:s>
                                 <a:s r="713">
                                    <a:s>Today()</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>&#xd;
        then </a:s>
                              <a:s r="721">
                                 <a:s>days between </a:s>
                                 <a:s r="719">
                                    <a:s r="718">
                                       <a:s r="717">
                                          <a:s r="716">
                                             <a:s r="715">
                                                <a:s>orders</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="716">
                                                <a:s>dispenseRequest</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="717">
                                             <a:s>validityPeriod</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="718">
                                          <a:s>&quot;end&quot;</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="719">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> and </a:s>
                                 <a:s r="720">
                                    <a:s>Today()</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="722">&#xd;
        else 0</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="745">
                        <a:s>return&#xd;
      </a:s>
                        <a:s r="744">
                           <a:s>if </a:s>
                           <a:s r="729">
                              <a:s r="727">
                                 <a:s>(</a:s>
                                 <a:s r="727">
                                    <a:s r="725">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                    <a:s> * </a:s>
                                    <a:s r="726">
                                       <a:s>supplyDuration</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> &lt; </a:s>
                              <a:s r="728">
                                 <a:s>numDaysInDaysPast</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="730"> then false&#xd;
      else&#xd;
        </a:s>
                           <a:s r="743">
                              <a:s r="741">
                                 <a:s>(</a:s>
                                 <a:s r="741">
                                    <a:s r="737">
                                       <a:s r="731">
                                          <a:s>dosesPerDay</a:s>
                                       </a:s>
                                       <a:s> * </a:s>
                                       <a:s r="736">
                                          <a:s>(</a:s>
                                          <a:s r="736">
                                             <a:s r="734">
                                                <a:s>(</a:s>
                                                <a:s r="734">
                                                   <a:s r="732">
                                                      <a:s>repeat</a:s>
                                                   </a:s>
                                                   <a:s> * </a:s>
                                                   <a:s r="733">
                                                      <a:s>supplyDuration</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s> / </a:s>
                                             <a:s r="735">
                                                <a:s>validityPeriod</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> * </a:s>
                                    <a:s r="740">
                                       <a:s>(</a:s>
                                       <a:s r="740">
                                          <a:s r="738">
                                             <a:s>daysPast</a:s>
                                          </a:s>
                                          <a:s> - </a:s>
                                          <a:s r="739">
                                             <a:s>endDifference</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> >= </a:s>
                              <a:s r="742">
                                 <a:s>numDaysInDaysPast</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="746" xsi:type="Query">
            <source localId="485" alias="orders">
               <expression localId="484" name="Orders" xsi:type="OperandRef"/>
            </source>
            <let localId="494" identifier="frequency">
               <expression localId="493" path="value" xsi:type="Property">
                  <source localId="492" path="frequency" xsi:type="Property">
                     <source localId="491" path="repeat" xsi:type="Property">
                        <source localId="490" path="timing" xsi:type="Property">
                           <source localId="489" xsi:type="Indexer">
                              <operand localId="487" path="dosageInstruction" scope="orders" xsi:type="Property"/>
                              <operand localId="488" valueType="t:Integer" value="0" xsi:type="Literal"/>
                           </source>
                        </source>
                     </source>
                  </source>
               </expression>
            </let>
            <let localId="503" identifier="period">
               <expression localId="502" path="value" xsi:type="Property">
                  <source localId="501" path="period" xsi:type="Property">
                     <source localId="500" path="repeat" xsi:type="Property">
                        <source localId="499" path="timing" xsi:type="Property">
                           <source localId="498" xsi:type="Indexer">
                              <operand localId="496" path="dosageInstruction" scope="orders" xsi:type="Property"/>
                              <operand localId="497" valueType="t:Integer" value="0" xsi:type="Literal"/>
                           </source>
                        </source>
                     </source>
                  </source>
               </expression>
            </let>
            <let localId="567" identifier="periodDays">
               <expression localId="566" name="GetPeriodDays" xsi:type="FunctionRef">
                  <operand localId="511" path="value" xsi:type="Property">
                     <source localId="510" path="periodUnit" xsi:type="Property">
                        <source localId="509" path="repeat" xsi:type="Property">
                           <source localId="508" path="timing" xsi:type="Property">
                              <source localId="507" xsi:type="Indexer">
                                 <operand localId="505" path="dosageInstruction" scope="orders" xsi:type="Property"/>
                                 <operand localId="506" valueType="t:Integer" value="0" xsi:type="Literal"/>
                              </source>
                           </source>
                        </source>
                     </source>
                  </operand>
               </expression>
            </let>
            <let localId="582" identifier="dosesPerDay">
               <expression localId="581" xsi:type="If">
                  <condition asType="t:Boolean" xsi:type="As">
                     <operand localId="574" xsi:type="GreaterOrEqual">
                        <operand localId="572" xsi:type="Divide">
                           <operand xsi:type="ToDecimal">
                              <operand localId="568" name="frequency" xsi:type="QueryLetRef"/>
                           </operand>
                           <operand localId="571" xsi:type="Multiply">
                              <operand localId="569" name="period" xsi:type="QueryLetRef"/>
                              <operand localId="570" name="periodDays" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                        <operand localId="573" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
                     </operand>
                  </condition>
                  <then localId="575" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
                  <else localId="580" xsi:type="Divide">
                     <operand xsi:type="ToDecimal">
                        <operand localId="576" name="frequency" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand localId="579" xsi:type="Multiply">
                        <operand localId="577" name="period" xsi:type="QueryLetRef"/>
                        <operand localId="578" name="periodDays" xsi:type="QueryLetRef"/>
                     </operand>
                  </else>
               </expression>
            </let>
            <let localId="587" identifier="repeat">
               <expression localId="586" path="value" xsi:type="Property">
                  <source localId="585" path="numberOfRepeatsAllowed" xsi:type="Property">
                     <source localId="584" path="dispenseRequest" scope="orders" xsi:type="Property"/>
                  </source>
               </expression>
            </let>
            <let localId="699" identifier="supplyDuration">
               <expression localId="698" name="GetDurationInDays" xsi:type="FunctionRef">
                  <operand localId="590" path="expectedSupplyDuration" xsi:type="Property">
                     <source localId="589" path="dispenseRequest" scope="orders" xsi:type="Property"/>
                  </operand>
               </expression>
            </let>
            <let localId="707" identifier="validityPeriod">
               <expression localId="706" precision="Day" xsi:type="DurationBetween">
                  <operand localId="704" path="value" xsi:type="Property">
                     <source localId="703" path="start" xsi:type="Property">
                        <source localId="702" path="validityPeriod" xsi:type="Property">
                           <source localId="701" path="dispenseRequest" scope="orders" xsi:type="Property"/>
                        </source>
                     </source>
                  </operand>
                  <operand xsi:type="ToDateTime">
                     <operand localId="705" xsi:type="Today"/>
                  </operand>
               </expression>
            </let>
            <let localId="724" identifier="endDifference">
               <expression localId="723" xsi:type="If">
                  <condition asType="t:Boolean" xsi:type="As">
                     <operand localId="714" xsi:type="Less">
                        <operand localId="712" path="value" xsi:type="Property">
                           <source localId="711" path="end" xsi:type="Property">
                              <source localId="710" path="validityPeriod" xsi:type="Property">
                                 <source localId="709" path="dispenseRequest" scope="orders" xsi:type="Property"/>
                              </source>
                           </source>
                        </operand>
                        <operand xsi:type="ToDateTime">
                           <operand localId="713" xsi:type="Today"/>
                        </operand>
                     </operand>
                  </condition>
                  <then localId="721" precision="Day" xsi:type="DurationBetween">
                     <operand localId="719" path="value" xsi:type="Property">
                        <source localId="718" path="end" xsi:type="Property">
                           <source localId="717" path="validityPeriod" xsi:type="Property">
                              <source localId="716" path="dispenseRequest" scope="orders" xsi:type="Property"/>
                           </source>
                        </source>
                     </operand>
                     <operand xsi:type="ToDateTime">
                        <operand localId="720" xsi:type="Today"/>
                     </operand>
                  </then>
                  <else localId="722" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </expression>
            </let>
            <return localId="745">
               <expression localId="744" xsi:type="If">
                  <condition asType="t:Boolean" xsi:type="As">
                     <operand localId="729" xsi:type="Less">
                        <operand localId="727" xsi:type="Multiply">
                           <operand xsi:type="ToDecimal">
                              <operand localId="725" name="repeat" xsi:type="QueryLetRef"/>
                           </operand>
                           <operand localId="726" name="supplyDuration" xsi:type="QueryLetRef"/>
                        </operand>
                        <operand xsi:type="ToDecimal">
                           <operand localId="728" name="numDaysInDaysPast" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </condition>
                  <then localId="730" valueType="t:Boolean" value="false" xsi:type="Literal"/>
                  <else localId="743" xsi:type="GreaterOrEqual">
                     <operand localId="741" xsi:type="Multiply">
                        <operand localId="737" xsi:type="Multiply">
                           <operand localId="731" name="dosesPerDay" xsi:type="QueryLetRef"/>
                           <operand localId="736" xsi:type="Divide">
                              <operand localId="734" xsi:type="Multiply">
                                 <operand xsi:type="ToDecimal">
                                    <operand localId="732" name="repeat" xsi:type="QueryLetRef"/>
                                 </operand>
                                 <operand localId="733" name="supplyDuration" xsi:type="QueryLetRef"/>
                              </operand>
                              <operand xsi:type="ToDecimal">
                                 <operand localId="735" name="validityPeriod" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                        <operand xsi:type="ToDecimal">
                           <operand localId="740" xsi:type="Subtract">
                              <operand localId="738" name="daysPast" xsi:type="OperandRef"/>
                              <operand localId="739" name="endDifference" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <operand localId="742" name="numDaysInDaysPast" xsi:type="OperandRef"/>
                     </operand>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="Orders">
            <operandTypeSpecifier localId="481" xsi:type="ListTypeSpecifier">
               <elementType localId="480" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="daysPast">
            <operandTypeSpecifier localId="482" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="numDaysInDaysPast">
            <operandTypeSpecifier localId="483" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="757" name="GetIngredient" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="757">
               <a:s>define function GetIngredient(rxNormCode </a:s>
               <a:s r="752">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="756">
                  <a:s r="756">
                     <a:s r="755">
                        <a:s r="753">
                           <a:s>OMTKLogic</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="755">
                           <a:s>GetIngredients(</a:s>
                           <a:s r="754">
                              <a:s>rxNormCode</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="756">
                        <a:s>ingredientName</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="756" xsi:type="Query">
            <source alias="$this">
               <expression localId="755" name="GetIngredients" libraryName="OMTKLogic" xsi:type="FunctionRef">
                  <operand localId="754" name="rxNormCode" xsi:type="OperandRef"/>
               </expression>
            </source>
            <where xsi:type="Not">
               <operand xsi:type="IsNull">
                  <operand path="ingredientName" xsi:type="Property">
                     <source name="$this" xsi:type="AliasRef"/>
                  </operand>
               </operand>
            </where>
            <return>
               <expression path="ingredientName" xsi:type="Property">
                  <source name="$this" xsi:type="AliasRef"/>
               </expression>
            </return>
         </expression>
         <operand name="rxNormCode">
            <operandTypeSpecifier localId="752" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="766" name="GetIngredients" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="766">
               <a:s>define function GetIngredients(rxNormCodes </a:s>
               <a:s r="759">
                  <a:s>List&lt;</a:s>
                  <a:s r="758">
                     <a:s>Code</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="765">
                  <a:s r="765">
                     <a:s>
                        <a:s r="761">
                           <a:s r="760">
                              <a:s>
                                 <a:s>rxNormCodes</a:s>
                              </a:s>
                           </a:s>
                           <a:s> rnc</a:s>
                        </a:s>
                     </a:s>
                     <a:s> </a:s>
                     <a:s r="764">
                        <a:s>return </a:s>
                        <a:s r="763">
                           <a:s>GetIngredient(</a:s>
                           <a:s r="762">
                              <a:s>rnc</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="765" xsi:type="Query">
            <source localId="761" alias="rnc">
               <expression localId="760" name="rxNormCodes" xsi:type="OperandRef"/>
            </source>
            <return localId="764">
               <expression localId="763" name="GetIngredient" xsi:type="FunctionRef">
                  <operand localId="762" name="rnc" xsi:type="AliasRef"/>
               </expression>
            </return>
         </expression>
         <operand name="rxNormCodes">
            <operandTypeSpecifier localId="759" xsi:type="ListTypeSpecifier">
               <elementType localId="758" name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="785" name="ToRxNormCode" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="785">
               <a:s>define function ToRxNormCode(coding </a:s>
               <a:s r="776">
                  <a:s>List&lt;</a:s>
                  <a:s r="775">
                     <a:s>FHIR.Coding</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="784">
                  <a:s r="784">
                     <a:s>singleton from </a:s>
                     <a:s r="783">
                        <a:s>(&#xd;
    </a:s>
                        <a:s r="783">
                           <a:s>
                              <a:s r="778">
                                 <a:s r="777">
                                    <a:s>
                                       <a:s>coding</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> C</a:s>
                              </a:s>
                           </a:s>
                           <a:s> </a:s>
                           <a:s r="782">
                              <a:s>where </a:s>
                              <a:s r="782">
                                 <a:s r="780">
                                    <a:s r="779">
                                       <a:s>C</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="780">
                                       <a:s>system</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="781">
                                    <a:s>'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>&#xd;
  )</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="784" xsi:type="SingletonFrom">
            <operand localId="783" xsi:type="Query">
               <source localId="778" alias="C">
                  <expression localId="777" name="coding" xsi:type="OperandRef"/>
               </source>
               <where localId="782" xsi:type="Equal">
                  <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="780" path="system" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand localId="781" valueType="t:String" value="http://www.nlm.nih.gov/research/umls/rxnorm" xsi:type="Literal"/>
               </where>
            </operand>
         </expression>
         <operand name="coding">
            <operandTypeSpecifier localId="776" xsi:type="ListTypeSpecifier">
               <elementType localId="775" name="fhir:Coding" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="792" name="GetMedicationNames" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="792">
               <a:s>define function GetMedicationNames(medications </a:s>
               <a:s r="768">
                  <a:s>List&lt;</a:s>
                  <a:s r="767">
                     <a:s>MedicationRequest</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):&#xd;
  </a:s>
               <a:s r="791">
                  <a:s r="791">
                     <a:s>
                        <a:s r="770">
                           <a:s r="769">
                              <a:s>
                                 <a:s>medications</a:s>
                              </a:s>
                           </a:s>
                           <a:s> M</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
    </a:s>
                     <a:s r="790">
                        <a:s>return </a:s>
                        <a:s r="789">
                           <a:s r="788">
                              <a:s r="787">
                                 <a:s r="771">
                                    <a:s>OMTKLogic</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="787">
                                    <a:s>GetIngredients(</a:s>
                                    <a:s r="786">
                                       <a:s>ToRxNormCode(</a:s>
                                       <a:s r="774">
                                          <a:s r="773">
                                             <a:s r="772">
                                                <a:s>M</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="773">
                                                <a:s>medication</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="774">
                                             <a:s>coding</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="788">
                                 <a:s>rxNormCode</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="789">
                              <a:s>display</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="791" xsi:type="Query">
            <source localId="770" alias="M">
               <expression localId="769" name="medications" xsi:type="OperandRef"/>
            </source>
            <return localId="790">
               <expression localId="789" xsi:type="Query">
                  <source alias="$this">
                     <expression localId="788" xsi:type="Query">
                        <source alias="$this">
                           <expression localId="787" name="GetIngredients" libraryName="OMTKLogic" xsi:type="FunctionRef">
                              <operand name="ToCode" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <operand localId="786" name="ToRxNormCode" xsi:type="FunctionRef">
                                    <operand localId="774" path="coding" xsi:type="Property">
                                       <source localId="773" path="medication" scope="M" xsi:type="Property"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </expression>
                        </source>
                        <where xsi:type="Not">
                           <operand xsi:type="IsNull">
                              <operand path="rxNormCode" xsi:type="Property">
                                 <source name="$this" xsi:type="AliasRef"/>
                              </operand>
                           </operand>
                        </where>
                        <return>
                           <expression path="rxNormCode" xsi:type="Property">
                              <source name="$this" xsi:type="AliasRef"/>
                           </expression>
                        </return>
                     </expression>
                  </source>
                  <where xsi:type="Not">
                     <operand xsi:type="IsNull">
                        <operand path="display" xsi:type="Property">
                           <source name="$this" xsi:type="AliasRef"/>
                        </operand>
                     </operand>
                  </where>
                  <return>
                     <expression path="display" xsi:type="Property">
                        <source name="$this" xsi:type="AliasRef"/>
                     </expression>
                  </return>
               </expression>
            </return>
         </expression>
         <operand name="medications">
            <operandTypeSpecifier localId="768" xsi:type="ListTypeSpecifier">
               <elementType localId="767" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
   </statements>
</library>
