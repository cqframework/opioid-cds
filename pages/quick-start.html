---
# jekyll header
---
{% include header.html %}

<!-- ============BreadCrumb=============== -->

{% include container-start.html %}

<!-- ============CONTENT CONTENT=============== -->

<a name="quick-start"> </a>
<h2><span class="sectioncount">8.1.0</span> CDC Opioid Prescribing Guideline - Quick Start <a href="quick-start.html#quick-start" title="link to here" class="self-link"><img src="target.png" width="20" class="self-link" height="20"/></a></h2>

<p>This section provides a quick start guide to getting up and running quickly with the Clinical Quality Framework reference 
  implementation functioning as a CDS Hooks service. This quick start focuses on recommendations #10 and #11, both slightly
  modified to work on a "patient-view" hook.</p>
  
<a name="approach"> </a>
<h3><span class="sectioncount">8.2.1</span> Overall Approach <a href="quick-start.html#integration" title="link to here" class="self-link"><img src="target.png" width="20" class="self-link" height="20"/></a></h3>

<p>This quick start will focus on standing up an instance of a CDS Hooks service that can run the
  guidance artifacts published in this implementation guide. In other words, the "Clinical Reasoning Implementation"
  depicted in the diagram below:</p>

<img src="assets/images/ClinicalReasoningApproach.png"/>

<a name="service"> </a>
<h3><span class="sectioncount">8.2.2</span> CDS Hooks Service <a href="quick-start.html#service" title="link to here" class="self-link"><img src="target.png" width="20" class="self-link" height="20"/></a></h3>

<p>The first step is to stand up an instance of the CQF Ruler, a reference implementation of the FHIR
  Clinical Reasoning module and CDS Hooks. Follow the instructions on the 
  <a href="https://github.com/DBCG/cqf-ruler/wiki/Deployment">Deployment</a> page 
  of the CQF Ruler wiki to start a local CQF Ruler service.</p>
  
<p>This service is a HAPI FHIR Server with some additional plug-ins to support the Clinical Reasoning module. To verify
  the service is running, issue a couple basic queries:</p>
  
<div class="example">
  <pre class="http">
GET http://localhost:8080/cqf-ruler/baseDstu3/Library

GET http://localhost:8080/cqf-ruler/baseDstu3/PlanDefinition
  </pre>
</div>

<p>For a newly instantiated CQF Ruler, both of these queries should return 0 results, indicating there is no content
  currently loaded.</p>
  
<p>In addition to the FHIR Server functionality, the CQF Ruler implements a CDS Hooks service. To view the discovery endpoint,
  issue the following query:</p>
  
<div class="example">
  <pre class="http">
GET http://localhost:8080/cqf-ruler/cds-services
  </pre>
</div>

<p>For a newly instantiated CQF Ruler, this will also return an empty list, indicating there are no services
  configured.</p>

<div class="example">
  <pre class="json">
{
    "services": []
}
  </pre>
</div>
  
<a name="content-load"> </a>
<h3><span class="sectioncount">8.2.3</span> Loading Content <a href="quick-start.html#content-load" title="link to here" class="self-link"><img src="target.png" width="20" class="self-link" height="20"/></a></h3>

<p>The next step is to load the _content_, i.e., the artifacts published in this implementation guide that
  describe the service behavior for the recommendations. For recommendations #10 and #11, patient-view, these
  artifacts are:</p>
  
<table class="list">
  <thead>
    <tr><th>Resource</th><th>Type</th><th>Description</th></tr>
  </thead>
  <tbody>
    <tr><td><a href="Library-omtkdata-0-0-2.html">OMTKData (v0.0.2)</a></td><td>Library</td><td>Opioid Management Terminology Knowledge (OMTK) Data Library</td></tr>
    <tr><td><a href="Library-omtklogic-0-0-1.html">OMTKLogic (v0.0.1)</a></td><td>Library</td><td>Opioid Management Terminology Knowledge (OMTK) Logic Library</td></tr>
    <tr><td><a href="Library-opioidcds-stu3-common-0-1-0.html">OpioidCDS_STU3_Common (v0.1.0)</a></td><td>Library</td><td>Opioid Common Library</td></tr>
    <tr><td><a href="Library-opioidcds-stu3-rec-10-patient-view-0-1-0.html">OpioidCDS_STU3_REC_10_Patient_View (v0.1.0)</a></td><td>Library</td><td>Opioid Recommendation #10 (Patient View Version) Library</td></tr>
    <tr><td><a href="Library-opioidcds-stu3-rec-11-patient-view-0-1-0.html">OpioidCDS_STU3_REC_11_Patient_View (v0.1.0)</a></td><td>Library</td><td>Opioid Recommendation #11 (Patient View Version) Library</td></tr>
    <tr><td><a href="PlanDefinition-opioidcds-10-patient-view.html">PlanDefinition_Recommendation_10_Patient_View (v0.1.0)</a></td><td>PlanDefinition</td><td>Opioid Recommendation #10 (Patient View Version) PlanDefinition</td></tr>
    <tr><td><a href="PlanDefinition-opioidcds-11-patient-view.html">PlanDefinition_Recommendation_11_Patient_view (v0.1.0)</a></td><td>PlanDefinition</td><td>Opioid Recommendation #11 (Patient View Version) PlanDefinition</td></tr>
    <tr><td><a href="terminology.html">Terminologies</a></td><td>ValueSet</td><td>Value sets referenced by the CQL in the Opioid Logic recommendations</td></tr>
  </tbody>
</table>

<p>Because this content is published as FHIR resources, these can be loaded by POSTing or PUTing them to the 
  FHIR server, just like any other FHIR resource:</p>
  
<div class="example">
  <pre class="http">
PUT http://localhost:8080/cqf-ruler/baseDstu3/Library/library-omtkdata-0-0-2
  </pre>
</div>

<p>With the body of the PUT as the XML (or JSON) for the resource.</p>

<p>For convenience, these resources have all been added to a single transaction bundle, quick-start-content,
  that can be POSTed to the base URL of the server:</p>
	
<table class="list">
	<thead>
		<tr><th>Resource</th><th>Type</th><th>Description</th></tr>
	</thead>
	<tbody>
		<tr><td><a href="quick-start-bundles/opioid-cds-terminology-bundle.json">opioid-cds-terminology-bundle</a></td><td>Bundle</td><td>All Value Sets Referenced by the Opioid Content</td></tr>
		<tr><td><a href="quick-start-bundles/opioid-cds-content-bundle.json">opioid-cds-content-bundle</a></td><td>Bundle</td><td>All Required Content for Recommendations #10 and #11</td></tr>
	</tbody>
</table>
  
<div class="example">
  <pre class="http">
POST http://localhost:8080/cqf-ruler/baseDstu3
  </pre>
</div>

<p>Following normal FHIR server transaction processing, this will post all the content resources as
  a single transaction.</p>
  
<p>Once the content has been loaded, the CDS Hooks discovery endpoint will list the recommendations as
  available services to be called:</p>
  
<div class="example">
  <pre class="http">
GET http://localhost:8080/cqf-ruler/cds-services
  </pre>
</div>

<div class="example">
  <pre class="json">
{
    "services": [
        {
            "hook": "patient-view",
            "name": "PlanDefinition_Recommendation_10_Patient_View",
            "title": "PlanDefinition - CDC Opioid Prescribing Guideline Recommendation #10 (patient-view)",
            "description": "When prescribing opioids for chronic pain, providers should use urine drug testing before starting opioid therapy and consider urine drug testing at least annually to assess for prescribed medications as well as other controlled prescription drugs and illicit drugs.",
            "id": "opioidcds-10-patient-view",
            "prefetch": {
                "item1": "Patient?_id={{context.patientId}}",
                "item2": "MedicationRequest?patient={{context.patientId}}&medication=http%3A%2F%2Fwww.nlm.nih.gov%2Fresearch%2Fumls%2Frxnorm|1010600,snipped for brevity",
                "item3": "Observation?patient={{context.patientId}}&code=http%3A%2F%2Floinc.org|12478-4,http%3A%2F%2Floinc.org|78813-3,snipped for brevity",
                "item4": "Observation?patient={{context.patientId}}&component-code=http%3A%2F%2Floinc.org|12478-4,http%3A%2F%2Floinc.org|78813-3,snipped for brevity",
                "item5": "Observation?patient={{context.patientId}}&code=http%3A%2F%2Floinc.org|50542-0,http%3A%2F%2Floinc.org|19487-8,snipped for brevity",
                "item6": "Observation?patient={{context.patientId}}&component-code=http%3A%2F%2Floinc.org|50542-0,http%3A%2F%2Floinc.org|19487-8,snipped for brevity"
            }
        },
        {
            "hook": "patient-view",
            "name": "PlanDefinition_Recommendation_11_Patient_View",
            "title": "PlanDefinition - CDC Opioid Prescribing Guideline Recommendation #11 (patient-view)",
            "description": "Concurrently prescribing opioid medications with benzodiazepines increases the risk of harm for the patient.",
            "id": "opioidcds-11-patient-view",
            "prefetch": {
                "item1": "Patient?_id={{context.patientId}}",
                "item2": "MedicationRequest?patient={{context.patientId}}&medication=http%3A%2F%2Fwww.nlm.nih.gov%2Fresearch%2Fumls%2Frxnorm|141927,snipped for brevity",
                "item3": "MedicationRequest?patient={{context.patientId}}&medication=http%3A%2F%2Fwww.nlm.nih.gov%2Fresearch%2Fumls%2Frxnorm|1010600,snipped for brevity"
            }
        }
    ]
}  </pre>
</div>

<a name="request-and-response"> </a>
<h3><span class="sectioncount">8.2.4</span> Request and Response <a href="quick-start.html#request-and-response" title="link to here" class="self-link"><img src="target.png" width="20" class="self-link" height="20"/></a></h3>

<p>Now that the content is loaded, the service will respond to CDS Hooks requests. For example, POST the following request to the recommendation #10 service:</p>

<div class="example">
  <pre class="http">
POST http://localhost:8080/cqf-ruler/cds-services/opioidcds-10-patient-view
  </pre>
</div>

<a href="requests/request-example-rec-10-patient-view-illicit-drugs.json">request-example-rec-10-patient-view-illicit-drugs.json</a>

<div class="example">
  <pre class="json">
{
  "hookInstance": "31c74cfc-747c-4afc-82e4-bdd3b7a0a58c",
  "fhirServer": "http://localhost:8080/cqf-ruler/baseDstu3",
  "hook": "patient-view",
  "applyCql": true,
  "context": {
    "user": "Practitioner/example",
    "patientId": "Patient/example-rec-10-illicit-drugs",
    "encounterId": "Encounter/example-rec-10-illicit-drugs-context"
  },
  "prefetch": {
    "item1": "snipped for brevity, see the full example at the above link",
    "item2": "snipped for brevity, see the full example at the above link"
  }
}  </pre>
</div>

<p>This POST results in the following CDS Hooks response:</p>

<div class="example">
  <pre class="json">
{
    "cards": [
        {
            "summary": "Illicit Drugs Found In Urine Screening",
            "indicator": "warning",
            "source": {
                "label": "CDC guideline for prescribing opioids for chronic pain",
                "url": "https://www.cdc.gov/mmwr/volumes/65/rr/rr6501e1.htm?CDC_AA_refVal=https%3A%2F%2Fwww.cdc.gov%2Fmmwr%2Fvolumes%2F65%2Frr%2Frr6501e1er.htm"
            }
        }
    ]
}  </pre>
</div>

<!-- ==============END CONTENT END CONTENT=================== -->

{% include container-end.html %}

{% include footer.html %}
